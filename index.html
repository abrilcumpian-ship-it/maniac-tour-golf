<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a472a">
  <title>Maniac Tour Golf</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAVHl66ZzQWk0zloHpU7Hpt4M00w9vwdTw",
      authDomain: "maniac-tour-2026.firebaseapp.com",
      databaseURL: "https://maniac-tour-2026-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "maniac-tour-2026",
      storageBucket: "maniac-tour-2026.firebasestorage.app",
      messagingSenderId: "491634663138",
      appId: "1:491634663138:web:e16b194af29e51082888bb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
  <style>
:root{--pri:#1a472a;--pri-l:#2d5a3f;--sec:#c9a227;--danger:#c62828;--bg:#f5f5f0;--gold:#c9a227;--silver:#a8a8a8;--bronze:#cd7f32}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:#e0e0e0}
.app{max-width:430px;margin:0 auto;min-height:100vh;background:var(--bg);position:relative;box-shadow:0 0 40px rgba(0,0,0,.2)}
.hdr{background:linear-gradient(135deg,var(--pri),var(--pri-l));padding:16px;color:#fff;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:50}
.hdr-back{background:rgba(255,255,255,.2);border:none;color:#fff;width:36px;height:36px;border-radius:8px;cursor:pointer;font-size:18px}
.hdr h1{font-family:Georgia,serif;font-size:18px;flex:1}
.hdr p{font-size:11px;opacity:.8}
.sec{padding:16px}.scroll{padding-bottom:90px}
.card{background:#fff;border-radius:12px;padding:14px;margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,.06);cursor:pointer}
.live-card{background:linear-gradient(135deg,var(--sec),#d4af37);border-radius:14px;padding:18px;color:#1a1a1a;cursor:pointer;margin-bottom:12px}
.live-card.danger{background:linear-gradient(135deg,var(--danger),#b71c1c);color:#fff}
.live-card.active{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(198,40,40,.4)}50%{box-shadow:0 0 0 10px rgba(198,40,40,0)}}
@keyframes fadeIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
.live-badge{font-size:11px;text-transform:uppercase;letter-spacing:2px;display:flex;align-items:center;gap:6px}
.live-dot{width:8px;height:8px;background:#fff;border-radius:50%;animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.live-card h2{font-family:Georgia,serif;font-size:20px;margin:6px 0}
.menu-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.menu-item{background:#fff;border:none;border-radius:14px;padding:18px 10px;cursor:pointer;box-shadow:0 3px 12px rgba(0,0,0,.08);display:flex;flex-direction:column;align-items:center;gap:6px}
.menu-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
.menu-label{font-size:11px;font-weight:600}
.tabs{display:flex;background:#fff;padding:8px;gap:6px;position:sticky;top:68px;z-index:40}
.tab{flex:1;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:12px;background:#f0f0f0;color:#666}
.tab.active{background:var(--pri);color:#fff}.tab.liv{background:var(--danger);color:#fff}
.rank-item{background:#fff;border-radius:10px;padding:12px;margin-bottom:8px;display:flex;align-items:center;cursor:pointer}
.rank-item.gold{border-left:4px solid var(--gold)}.rank-item.silver{border-left:4px solid var(--silver)}.rank-item.bronze{border-left:4px solid var(--bronze)}
.rank-pos{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;margin-right:10px;background:#f0f0f0;color:#666}
.rank-pos.gold{background:var(--gold);color:#fff}.rank-pos.silver{background:var(--silver);color:#fff}.rank-pos.bronze{background:var(--bronze);color:#fff}
.rank-info{flex:1}.rank-name{font-weight:700;font-size:14px}.rank-det{font-size:11px;color:#888;margin-top:2px}
.rank-total{font-weight:700;font-size:17px;color:var(--pri)}.rank-total.liv{color:var(--danger)}
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:#fff;border-top:1px solid #eee;display:flex;justify-content:space-around;padding:8px 0 20px;z-index:100}
.nav-btn{background:none;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 12px;opacity:.5}
.nav-btn.active{opacity:1}.nav-icon{font-size:20px}.nav-label{font-size:9px;color:#666}
.section-title{font-size:13px;color:#666;margin-bottom:10px;font-weight:600}
.btn{padding:12px 18px;border:none;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;width:100%}
.btn-pri{background:linear-gradient(135deg,var(--pri),var(--pri-l));color:#fff}
.btn-danger{background:linear-gradient(135deg,var(--danger),#b71c1c);color:#fff}
.btn-sec{background:#f0f0f0;color:#333}
.btn-outline{background:#fff;border:2px solid var(--pri);color:var(--pri)}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:200;padding:16px}
.modal{background:#fff;border-radius:14px;width:100%;max-width:380px;max-height:85vh;overflow-y:auto}
.modal-hdr{padding:14px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
.modal-title{font-weight:700;font-size:15px}
.modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:#888}
.modal-body{padding:14px}.modal-footer{padding:14px;border-top:1px solid #eee;display:flex;gap:10px}
.form-group{margin-bottom:14px}.form-label{font-size:12px;font-weight:600;color:#333;margin-bottom:5px;display:block}
.form-input,.form-select{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:#fff}
.toggle-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
.toggle{position:relative;width:50px;height:28px;background:#ccc;border-radius:14px;cursor:pointer}
.toggle.on{background:var(--pri)}.toggle::after{content:'';position:absolute;top:3px;left:3px;width:22px;height:22px;background:#fff;border-radius:50%;transition:.2s}
.toggle.on::after{left:25px}
.admin-tag{background:var(--danger);color:#fff;padding:3px 8px;border-radius:8px;font-size:10px;font-weight:700}
.admin-menu-item{background:#fff;border-radius:12px;padding:16px;margin-bottom:10px;display:flex;align-items:center;gap:14px;cursor:pointer}
.admin-menu-icon{width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px}
.admin-menu-info{flex:1}.admin-menu-title{font-weight:700;font-size:15px}.admin-menu-desc{font-size:11px;color:#888;margin-top:2px}
.checkbox-item{display:flex;align-items:center;padding:12px;background:#fff;border-radius:10px;margin-bottom:8px;cursor:pointer}
.checkbox-item.selected{background:#e8f5e9}
.checkbox{width:24px;height:24px;border:2px solid var(--pri);border-radius:6px;margin-right:12px;display:flex;align-items:center;justify-content:center;font-size:14px}
.checkbox.checked{background:var(--pri);color:#fff}
.inscrito-row{display:flex;align-items:center;padding:10px;background:#fff;border-radius:8px;margin-bottom:6px}
.inscrito-avatar{width:32px;height:32px;border-radius:50%;background:var(--pri);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;margin-right:10px;font-size:12px}
.inscrito-name{flex:1;font-weight:600}.inscrito-hcp{font-size:12px;color:#888}.inscrito-remove{color:var(--danger);cursor:pointer;padding:4px 8px;font-size:18px}
.grupo-card{background:#fff;border-radius:10px;padding:14px;margin-bottom:10px;border:2px solid #e0e0e0}
.grupo-card.has-admin{border-color:var(--pri)}
.grupo-title{font-weight:700;color:var(--pri);margin-bottom:8px;display:flex;align-items:center;gap:8px}
.grupo-admin{background:#e8f5e9;padding:8px 12px;border-radius:8px;margin-bottom:10px;font-size:12px}
.grupo-admin-code{font-family:monospace;font-size:16px;font-weight:700;color:var(--pri);background:#fff;padding:4px 8px;border-radius:4px;margin-left:8px}
.grupo-jugadores{display:flex;flex-wrap:wrap;gap:6px}
.jugador-chip{background:#f0f0f0;padding:6px 12px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:4px}
.jugador-chip.is-admin{background:#e8f5e9;border:1px solid var(--pri)}
.jugador-chip .remove{color:#c62828;cursor:pointer;font-weight:700}
.liv-pair{background:#fff;border-radius:10px;padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:10px}
.liv-pair-num{width:30px;height:30px;background:var(--danger);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700}
.liv-pair-players{flex:1;display:flex;gap:8px;flex-wrap:wrap}
.liv-player{background:#ffebee;padding:6px 12px;border-radius:20px;font-size:12px;color:var(--danger);font-weight:600}
.jug-header{background:linear-gradient(135deg,var(--pri),var(--pri-l));padding:30px 20px;text-align:center;color:#fff}
.jug-avatar{width:80px;height:80px;background:rgba(255,255,255,.2);border-radius:50%;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:700}
.jug-nombre{font-size:28px;font-family:Georgia,serif}.jug-hcp{font-size:14px;opacity:.9;margin-top:5px}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);background:#fff;margin:-20px 16px 0;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.1);position:relative;z-index:10}
.stat-item{padding:15px;text-align:center;border-right:1px solid #eee}.stat-item:last-child{border-right:none}
.stat-value{font-size:24px;font-weight:700;color:var(--pri)}.stat-value.liv{color:var(--danger)}
.stat-label{font-size:10px;color:#888;margin-top:3px}
.hist-item{background:#fff;border-radius:12px;padding:15px;margin-bottom:10px;display:flex;align-items:center}
.hist-fecha{min-width:50px;text-align:center;margin-right:15px}.hist-dia{font-size:18px;font-weight:700;color:var(--pri)}
.hist-mes{font-size:10px;color:#888;text-transform:uppercase}.hist-info{flex:1}.hist-nombre{font-weight:700;font-size:15px}
.hist-campo{font-size:11px;color:#888;margin-top:2px}.hist-res{text-align:right}
.hist-pos{display:inline-block;padding:4px 10px;border-radius:15px;font-size:12px;font-weight:700;margin-bottom:3px}
.hist-pos.p1{background:var(--gold);color:#fff}.hist-pos.p2{background:var(--silver);color:#fff}.hist-pos.p3{background:var(--bronze);color:#fff}.hist-pos.def{background:#f0f0f0;color:#666}
.hist-pts{font-size:12px;color:#666}.hist-stb{font-weight:700;color:var(--pri)}.no-part{opacity:.5}
.liv-hist-item{background:#fff;border-radius:10px;padding:12px;margin-bottom:8px;display:flex;align-items:center}
.liv-hist-prueba{flex:1}.liv-hist-name{font-weight:700;font-size:14px}.liv-hist-date{font-size:11px;color:#888}
.liv-hist-team{font-size:12px;color:#666;margin-top:4px}.liv-hist-pts{text-align:right}
.liv-hist-pos{font-size:12px;color:#888}.liv-hist-val{font-size:20px;font-weight:700;color:var(--danger)}
.prueba-card{background:#fff;border-radius:12px;overflow:hidden;margin-bottom:12px;cursor:pointer}
.prueba-hdr{background:linear-gradient(135deg,var(--pri),var(--pri-l));color:#fff;padding:14px;display:flex;justify-content:space-between}
.prueba-name{font-weight:700;font-size:16px}
.prueba-winner{padding:12px 14px;display:flex;align-items:center;gap:10px}.winner-name{font-weight:700;color:var(--gold)}
.resultado-row{display:flex;padding:10px 14px;border-bottom:1px solid #f0f0f0;align-items:center}
.resultado-pos{width:28px;font-weight:700;font-size:13px}.resultado-pos.p1{color:var(--gold)}.resultado-pos.p2{color:var(--silver)}.resultado-pos.p3{color:var(--bronze)}
.resultado-name{flex:1;font-size:14px}.resultado-stb{width:40px;text-align:center;font-weight:700;color:var(--pri)}.resultado-pts{width:50px;text-align:right;font-size:13px;color:#666}
.detail-hdr{background:linear-gradient(135deg,var(--pri),var(--pri-l));color:#fff;padding:20px;text-align:center}
.detail-name{font-family:Georgia,serif;font-size:24px}.detail-campo{font-size:13px;opacity:.9;margin-top:4px}.detail-date{font-size:12px;opacity:.8;margin-top:4px}
.equipo-card{background:#fff;border-radius:10px;padding:12px;margin-bottom:8px}.equipo-card.gold{border-left:4px solid var(--gold)}
.equipo-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.equipo-pts-liv{background:var(--danger);color:#fff;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700}
.hole-hdr{background:var(--pri);color:#fff;padding:16px;display:flex;justify-content:space-between;align-items:center}
.hole-nav-btn{background:rgba(255,255,255,.2);border:none;color:#fff;width:44px;height:44px;border-radius:50%;font-size:20px;cursor:pointer}
.hole-nav-btn:disabled{opacity:.3}.hole-center{text-align:center}.hole-num{font-size:14px;opacity:.8}.hole-big{font-size:48px;font-weight:700}.hole-details{font-size:13px;margin-top:4px}
.player-score{background:#fff;border-radius:10px;padding:14px;margin-bottom:10px}
.player-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.player-name{font-weight:700;font-size:15px}.player-extra{font-size:10px;color:var(--pri);background:#e8f5e9;padding:2px 6px;border-radius:4px;margin-left:6px}
.player-total{background:var(--pri);color:#fff;padding:5px 12px;border-radius:20px;font-weight:700}
.stroke-row{display:flex;align-items:center;justify-content:center;gap:15px}
.stroke-btn{width:56px;height:56px;border-radius:50%;border:none;font-size:28px;font-weight:700;cursor:pointer}
.stroke-btn.minus{background:#ffebee;color:#c62828}.stroke-btn.plus{background:#e8f5e9;color:#2e7d32}
.stroke-val{width:70px;height:70px;border-radius:12px;background:#f5f5f5;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:var(--pri);margin:0 auto}
.stroke-pts{font-size:12px;color:#888;margin-top:6px;text-align:center}.stroke-pts b{color:var(--pri);font-size:14px}
.lb{background:#1a1a1a;border-radius:12px;overflow:hidden;margin-bottom:12px}
.lb-hdr{background:var(--danger);color:#fff;padding:12px 14px;display:flex;justify-content:space-between;align-items:center}
.lb-title{font-weight:700;font-size:13px;display:flex;align-items:center;gap:6px}
.lb-row{display:flex;padding:10px 14px;border-bottom:1px solid #333;color:#fff;font-size:13px}.lb-row:last-child{border:none}
.lb-pos{width:25px;font-weight:700}.lb-pos.p1{color:var(--gold)}.lb-pos.p2{color:var(--silver)}.lb-pos.p3{color:var(--bronze)}
.lb-name{flex:1}.lb-thru{width:30px;text-align:center;color:#888;font-size:11px}.lb-score{width:40px;text-align:right;font-weight:700}
.empty-state{text-align:center;padding:40px 20px;color:#888}.empty-icon{font-size:48px;margin-bottom:10px}
.code-display{background:var(--pri);color:#fff;padding:15px;border-radius:10px;text-align:center;margin:10px 0}
.code-display-label{font-size:11px;opacity:.8;margin-bottom:5px}
.code-display-value{font-family:monospace;font-size:28px;font-weight:700;letter-spacing:4px}
.partida-access{background:#fff;border-radius:12px;padding:20px;margin-bottom:15px;text-align:center}
.partida-access h3{color:var(--pri);margin-bottom:10px}
.toast{position:fixed;top:80px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 20px;border-radius:25px;font-size:13px;font-weight:600;z-index:999;animation:toastIn .3s ease,toastOut .3s ease 2s forwards;pointer-events:none;box-shadow:0 4px 15px rgba(0,0,0,.3)}
.toast.success{background:#2e7d32}.toast.error{background:#c62828}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes toastOut{from{opacity:1}to{opacity:0}}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useMemo,useEffect,useCallback,useRef}=React;

const CAMPOS=[
{id:'alcaidesa',nombre:'Alcaidesa Links',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:3,i:15},{n:3,p:4,i:3},{n:4,p:5,i:11},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'brisas',nombre:'Las Brisas',par:72,hoyos:[{n:1,p:4,i:13},{n:2,p:5,i:9},{n:3,p:4,i:1},{n:4,p:3,i:15},{n:5,p:4,i:5},{n:6,p:5,i:11},{n:7,p:3,i:17},{n:8,p:4,i:3},{n:9,p:4,i:7},{n:10,p:5,i:10},{n:11,p:4,i:4},{n:12,p:4,i:2},{n:13,p:3,i:16},{n:14,p:4,i:8},{n:15,p:5,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'zagaleta',nombre:'La Zagaleta',par:72,hoyos:[{n:1,p:4,i:11},{n:2,p:4,i:3},{n:3,p:3,i:17},{n:4,p:5,i:7},{n:5,p:4,i:1},{n:6,p:4,i:13},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:9},{n:10,p:4,i:10},{n:11,p:5,i:4},{n:12,p:3,i:18},{n:13,p:4,i:2},{n:14,p:4,i:8},{n:15,p:5,i:12},{n:16,p:3,i:16},{n:17,p:4,i:6},{n:18,p:4,i:14}]},
{id:'sanroque',nombre:'San Roque Club',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:5,i:5},{n:3,p:4,i:1},{n:4,p:3,i:17},{n:5,p:4,i:11},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:3},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:18},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:16},{n:18,p:5,i:14}]},
{id:'marbella',nombre:'Marbella Club Golf',par:72,hoyos:[{n:1,p:5,i:9},{n:2,p:4,i:5},{n:3,p:3,i:17},{n:4,p:4,i:1},{n:5,p:4,i:11},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:3},{n:9,p:4,i:13},{n:10,p:4,i:10},{n:11,p:5,i:4},{n:12,p:3,i:18},{n:13,p:4,i:2},{n:14,p:4,i:8},{n:15,p:4,i:12},{n:16,p:3,i:16},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'rioreal',nombre:'R√≠o Real Golf',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:5,i:11},{n:3,p:4,i:3},{n:4,p:3,i:15},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'hacienda',nombre:'La Hacienda Links',par:72,hoyos:[{n:1,p:5,i:18},{n:2,p:3,i:7},{n:3,p:4,i:1},{n:4,p:4,i:3},{n:5,p:5,i:11},{n:6,p:3,i:17},{n:7,p:5,i:13},{n:8,p:3,i:5},{n:9,p:4,i:9},{n:10,p:4,i:14},{n:11,p:4,i:8},{n:12,p:3,i:4},{n:13,p:4,i:2},{n:14,p:4,i:10},{n:15,p:4,i:6},{n:16,p:5,i:12},{n:17,p:3,i:15},{n:18,p:5,i:16}]},
{id:'baviera',nombre:'Baviera Golf',par:71,hoyos:[{n:1,p:4,i:17},{n:2,p:4,i:12},{n:3,p:4,i:18},{n:4,p:5,i:2},{n:5,p:3,i:6},{n:6,p:5,i:5},{n:7,p:4,i:13},{n:8,p:3,i:16},{n:9,p:4,i:4},{n:10,p:3,i:11},{n:11,p:4,i:8},{n:12,p:5,i:1},{n:13,p:4,i:9},{n:14,p:4,i:7},{n:15,p:3,i:14},{n:16,p:4,i:10},{n:17,p:4,i:3},{n:18,p:4,i:15}]},
{id:'arcos',nombre:'Arcos Gardens',par:72,hoyos:[{n:1,p:4,i:12},{n:2,p:3,i:18},{n:3,p:4,i:14},{n:4,p:5,i:6},{n:5,p:4,i:4},{n:6,p:4,i:10},{n:7,p:3,i:16},{n:8,p:5,i:2},{n:9,p:4,i:8},{n:10,p:4,i:9},{n:11,p:5,i:11},{n:12,p:4,i:5},{n:13,p:4,i:1},{n:14,p:4,i:15},{n:15,p:3,i:17},{n:16,p:5,i:7},{n:17,p:3,i:13},{n:18,p:4,i:3}]},
{id:'camaleon',nombre:'El Camale√≥n Mayacoba',par:72,hoyos:[{n:1,p:4,i:11},{n:2,p:5,i:7},{n:3,p:3,i:17},{n:4,p:4,i:3},{n:5,p:4,i:13},{n:6,p:4,i:1},{n:7,p:5,i:9},{n:8,p:3,i:15},{n:9,p:4,i:5},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:4,i:6},{n:18,p:5,i:14}]},
{id:'pgariviera',nombre:'PGA Riviera Maya',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'pendiente',nombre:'Por Confirmar',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:4,i:3},{n:3,p:4,i:11},{n:4,p:5,i:1},{n:5,p:3,i:15},{n:6,p:4,i:9},{n:7,p:4,i:5},{n:8,p:3,i:17},{n:9,p:5,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:5,i:10},{n:13,p:3,i:16},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'playaparaiso',nombre:'Playa Para√≠so Mayacoba',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:5,i:5},{n:3,p:4,i:1},{n:4,p:3,i:17},{n:5,p:4,i:11},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:3},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
// CAMPOS ANDALUC√çA
{id:'valderrama',nombre:'Valderrama',zona:'Andaluc√≠a',par:71,hoyos:[{n:1,p:4,i:11},{n:2,p:4,i:5},{n:3,p:3,i:17},{n:4,p:5,i:1},{n:5,p:4,i:9},{n:6,p:4,i:13},{n:7,p:3,i:15},{n:8,p:4,i:7},{n:9,p:4,i:3},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:4,i:10},{n:13,p:4,i:4},{n:14,p:4,i:12},{n:15,p:3,i:18},{n:16,p:4,i:6},{n:17,p:5,i:14},{n:18,p:4,i:16}]},
{id:'fincacortesin',nombre:'Finca Cortes√≠n',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:5,i:11},{n:3,p:4,i:3},{n:4,p:3,i:15},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'lareserva',nombre:'La Reserva Sotogrande',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'sotogrande',nombre:'Real Club Sotogrande',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:5,i:11},{n:3,p:4,i:3},{n:4,p:3,i:15},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'aloha',nombre:'Aloha Golf',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:11},{n:2,p:4,i:5},{n:3,p:3,i:17},{n:4,p:5,i:1},{n:5,p:4,i:9},{n:6,p:4,i:13},{n:7,p:3,i:15},{n:8,p:5,i:7},{n:9,p:4,i:3},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:4,i:10},{n:13,p:3,i:16},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'losnaranjos',nombre:'Los Naranjos',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:5,i:3},{n:3,p:4,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'lacala',nombre:'La Cala Golf',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:4,i:11},{n:3,p:3,i:17},{n:4,p:5,i:3},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'santana',nombre:'Santana Golf',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:5,i:5},{n:3,p:4,i:1},{n:4,p:3,i:17},{n:5,p:4,i:11},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:3},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'montecastillo',nombre:'Montecastillo',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'laduquesa',nombre:'La Duquesa',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:11},{n:2,p:5,i:5},{n:3,p:4,i:3},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:7},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'guadalmina',nombre:'Guadalmina',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'atalaya',nombre:'Atalaya Golf',zona:'Andaluc√≠a',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:5,i:11},{n:3,p:4,i:3},{n:4,p:3,i:15},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'gaucin',nombre:'La Hoya Golf (Gauc√≠n)',zona:'Andaluc√≠a',par:70,hoyos:[{n:1,p:4,i:9},{n:2,p:4,i:3},{n:3,p:3,i:17},{n:4,p:5,i:1},{n:5,p:4,i:11},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:4,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:3,i:12},{n:16,p:4,i:6},{n:17,p:4,i:18},{n:18,p:4,i:14}]},
// CAMPOS MALLORCA
{id:'songual',nombre:'Son Gual',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:5,i:11},{n:3,p:4,i:3},{n:4,p:3,i:15},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'tgolfcalvia',nombre:'T Golf Calvi√†',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'santaponsa',nombre:'Golf Santa Ponsa',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:11},{n:2,p:5,i:5},{n:3,p:4,i:3},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:7},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'andratx',nombre:'Golf de Andratx',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'alcanada',nombre:'Alcanada Golf',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:5,i:5},{n:3,p:4,i:1},{n:4,p:3,i:17},{n:5,p:4,i:11},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:3},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'pulagolf',nombre:'Pula Golf',zona:'Mallorca',par:70,hoyos:[{n:1,p:4,i:11},{n:2,p:4,i:5},{n:3,p:3,i:17},{n:4,p:5,i:1},{n:5,p:4,i:9},{n:6,p:4,i:13},{n:7,p:3,i:15},{n:8,p:4,i:7},{n:9,p:4,i:3},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:10},{n:13,p:4,i:4},{n:14,p:4,i:12},{n:15,p:3,i:18},{n:16,p:4,i:6},{n:17,p:4,i:14},{n:18,p:4,i:16}]},
{id:'capdepera',nombre:'Capdepera Golf',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:5,i:11},{n:3,p:4,i:3},{n:4,p:3,i:15},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:17},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:3,i:18},{n:17,p:5,i:6},{n:18,p:4,i:14}]},
{id:'sonantem',nombre:'Son Antem',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:9},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:7},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]},
{id:'sonvida',nombre:'Son Vida Golf',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:11},{n:2,p:5,i:5},{n:3,p:4,i:3},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:7},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:4,i:2},{n:12,p:3,i:16},{n:13,p:5,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:4,i:6},{n:17,p:3,i:18},{n:18,p:5,i:14}]},
{id:'sonmuntaner',nombre:'Son Muntaner',zona:'Mallorca',par:72,hoyos:[{n:1,p:4,i:7},{n:2,p:4,i:3},{n:3,p:5,i:11},{n:4,p:3,i:17},{n:5,p:4,i:1},{n:6,p:4,i:9},{n:7,p:3,i:15},{n:8,p:5,i:5},{n:9,p:4,i:13},{n:10,p:4,i:8},{n:11,p:5,i:2},{n:12,p:3,i:16},{n:13,p:4,i:10},{n:14,p:4,i:4},{n:15,p:4,i:12},{n:16,p:5,i:6},{n:17,p:3,i:18},{n:18,p:4,i:14}]}
];

const PRUEBAS_HIST=[
{id:'brisas',nombre:'Brisas',fecha:'2024-09-15',campo:'Las Brisas',res:[{nombre:'Rodiles',stb:40,pts:'15+1'},{nombre:'I√±aki',stb:36,pts:'12+1'},{nombre:'Pedro',stb:32,pts:'10+1'},{nombre:'Abril',stb:31,pts:'9+1'},{nombre:'Botella',stb:29,pts:'8'},{nombre:'Ricard',stb:27,pts:'7+1'},{nombre:'Gin√©s',stb:24,pts:'6+1'},{nombre:'Alex',stb:23,pts:'5'},{nombre:'Chiky',stb:23,pts:'4+1'},{nombre:'Diego',stb:21,pts:'3+1'}],liv:[{pos:1,jug:['Rodiles','Pedro'],pts:[40,32],tot:72,pLIV:15},{pos:2,jug:['Abril','Ricard'],pts:[31,27],tot:58,pLIV:12},{pos:3,jug:['I√±aki','Diego'],pts:[36,21],tot:57,pLIV:10},{pos:4,jug:['Botella','Alex'],pts:[29,23],tot:52,pLIV:8},{pos:5,jug:['Gin√©s','Chiky'],pts:[24,23],tot:47,pLIV:6}]},
{id:'sanroque',nombre:'San Roque',fecha:'2024-10-20',campo:'San Roque Club',res:[{nombre:'Alex',stb:36,pts:'15+1'},{nombre:'Rodiles',stb:34,pts:'12+1'},{nombre:'Abril',stb:27,pts:'10+1'},{nombre:'Gin√©s',stb:26,pts:'9'},{nombre:'Chiky',stb:24,pts:'8+1'},{nombre:'Ricard',stb:23,pts:'7+1'},{nombre:'I√±aki',stb:23,pts:'6'},{nombre:'Santi',stb:19,pts:'5+1'}],liv:[{pos:1,jug:['Abril','Ricard','Alex'],pts:[27,23,36],tot:86,pLIV:15},{pos:2,jug:['Gin√©s','Santi','Chiky'],pts:[26,19,24],tot:69,pLIV:12},{pos:3,jug:['Rodiles','Botella','I√±aki'],pts:[34,0,23],tot:57,pLIV:10}]},
{id:'zagaleta',nombre:'Zagaleta',fecha:'2024-11-17',campo:'La Zagaleta',res:[{nombre:'Diego',stb:36,pts:'15+1'},{nombre:'Alex',stb:34,pts:'12'},{nombre:'Rodiles',stb:32,pts:'10+1'},{nombre:'Ricard',stb:31,pts:'9+1'},{nombre:'I√±aki',stb:28,pts:'8+1'},{nombre:'Dur√°n',stb:28,pts:'7+1'},{nombre:'Gin√©s',stb:28,pts:'6+1'},{nombre:'Pedro',stb:27,pts:'5+1'},{nombre:'Abril',stb:26,pts:'4+1'},{nombre:'Chiky',stb:26,pts:'3+1'}],liv:[{pos:1,jug:['Diego','Abril'],pts:[36,26],tot:62,pLIV:15},{pos:2,jug:['Chiky','Alex'],pts:[26,34],tot:60,pLIV:12},{pos:3,jug:['Rodiles','Pedro'],pts:[32,27],tot:59,pLIV:10},{pos:4,jug:['Ricard','Dur√°n'],pts:[31,28],tot:59,pLIV:8},{pos:5,jug:['I√±aki','Gin√©s'],pts:[28,28],tot:56,pLIV:6}]},
{id:'marbella',nombre:'Marbella Club (9 hoyos)',fecha:'2024-12-15',campo:'Marbella Club Golf',res:[{nombre:'Alex',stb:19,pts:'7.5'},{nombre:'I√±aki',stb:19,pts:'6+1'},{nombre:'Rodiles',stb:18,pts:'5'},{nombre:'Abril',stb:16,pts:'4.5+1'},{nombre:'Ricard',stb:15,pts:'4+1'},{nombre:'Tito Rubio',stb:13,pts:'3.5+1'},{nombre:'Santi',stb:12,pts:'3+1'},{nombre:'Dur√°n',stb:12,pts:'2.5+1'},{nombre:'Gin√©s',stb:12,pts:'2+1'},{nombre:'Diego',stb:11,pts:'1+1'},{nombre:'Pedro',stb:11,pts:'1.5'},{nombre:'Chiky',stb:10,pts:'0.5+1'}],liv:[{pos:1,jug:['I√±aki','Diego','Abril'],pts:[19,11,16],tot:46,pLIV:15},{pos:2,jug:['Ricard','Dur√°n','Rodiles'],pts:[15,12,18],tot:45,pLIV:12},{pos:3,jug:['Tito Rubio','Santi','Gin√©s'],pts:[13,12,12],tot:37,pLIV:10}]},
{id:'rioreal',nombre:'Rio Real',fecha:'2025-01-19',campo:'R√≠o Real Golf',res:[{nombre:'Rodiles',stb:35,pts:'15+1'},{nombre:'Ricard',stb:34,pts:'12+1'},{nombre:'Abril',stb:32,pts:'10+1'},{nombre:'Pedro',stb:32,pts:'9+1'},{nombre:'Alex',stb:30,pts:'8+1'},{nombre:'I√±aki',stb:29,pts:'7+1'},{nombre:'Dur√°n',stb:27,pts:'6+1'},{nombre:'Chiky',stb:26,pts:'5+1'},{nombre:'Santi',stb:21,pts:'4+1'},{nombre:'Gin√©s',stb:17,pts:'3+1'}],liv:[{pos:1,jug:['Alex','Abril'],pts:[30,32],tot:62,pLIV:15},{pos:2,jug:['Rodiles','Chiky'],pts:[35,26],tot:61,pLIV:12},{pos:3,jug:['Dur√°n','Pedro'],pts:[27,32],tot:59,pLIV:10},{pos:4,jug:['Santi','Ricard'],pts:[21,34],tot:55,pLIV:8},{pos:5,jug:['Gin√©s','I√±aki'],pts:[17,29],tot:46,pLIV:6}]},
{id:'hacienda26',nombre:'La Hacienda',fecha:'2026-02-14',campo:'La Hacienda Links',res:[{nombre:'Santi',stb:30,pts:'15+1'},{nombre:'I√±aki',stb:30,pts:'12'},{nombre:'Pedro',stb:30,pts:'10'},{nombre:'Ricard',stb:29,pts:'9+1'},{nombre:'Alex',stb:29,pts:'8'},{nombre:'Rodiles',stb:28,pts:'7+1'},{nombre:'Diego',stb:27,pts:'6+1'},{nombre:'Gin√©s',stb:26,pts:'5+1'},{nombre:'Chiky',stb:23,pts:'4+1'},{nombre:'Abril',stb:22,pts:'3+1'}],liv:[{pos:1,jug:['Santi','Alex'],pts:[30,29],tot:59,pLIV:15},{pos:2,jug:['Pedro','Rodiles'],pts:[30,28],tot:58,pLIV:12},{pos:3,jug:['I√±aki','Diego'],pts:[30,27],tot:57,pLIV:10},{pos:4,jug:['Gin√©s','Ricard'],pts:[26,29],tot:55,pLIV:8},{pos:5,jug:['Chiky','Abril'],pts:[23,22],tot:45,pLIV:6}]}
];

const CLASIF=[{pos:1,nombre:'Rodiles',total:69},{pos:2,nombre:'Alex',total:57.5},{pos:3,nombre:'Ricard',total:55},{pos:4,nombre:'I√±aki',total:55},{pos:5,nombre:'Abril',total:46.5},{pos:6,nombre:'Pedro',total:38.5},{pos:7,nombre:'Gin√©s',total:36},{pos:8,nombre:'Santi',total:31},{pos:9,nombre:'Chiky',total:30.5},{pos:10,nombre:'Diego',total:29},{pos:11,nombre:'Dur√°n',total:18.5},{pos:12,nombre:'Botella',total:13},{pos:13,nombre:'Tito Rubio',total:4.5}];
const CLASIF_LIV=[{pos:1,nombre:'Abril',total:78},{pos:2,nombre:'Alex',total:75},{pos:3,nombre:'Rodiles',total:71},{pos:4,nombre:'Ricard',total:63},{pos:5,nombre:'I√±aki',total:57},{pos:6,nombre:'Chiky',total:56},{pos:7,nombre:'Pedro',total:55},{pos:8,nombre:'Diego',total:50},{pos:9,nombre:'Gin√©s',total:46},{pos:10,nombre:'Santi',total:45},{pos:11,nombre:'Dur√°n',total:30},{pos:12,nombre:'Botella',total:18},{pos:13,nombre:'Tito Rubio',total:10}];

const JUG_INI=[{id:'rodiles',nombre:'Rodiles',hcp:3.5,esR:true},{id:'titorubio',nombre:'Tito Rubio',hcp:3},{id:'ricard',nombre:'Ricard',hcp:6.5},{id:'alex',nombre:'Alex',hcp:7.5},{id:'santi',nombre:'Santi',hcp:7.5},{id:'inaki',nombre:'I√±aki',hcp:10.5},{id:'abril',nombre:'Abril',hcp:11.5},{id:'botella',nombre:'Botella',hcp:10.5},{id:'pedro',nombre:'Pedro',hcp:12.5},{id:'chiky',nombre:'Chiky',hcp:13.5},{id:'diego',nombre:'Diego',hcp:15.5},{id:'duran',nombre:'Dur√°n',hcp:16},{id:'gines',nombre:'Gin√©s',hcp:18}];

const CAL_INI=[
{id:'hacienda26',nombre:'La Hacienda',fecha:'2026-02-14',campoId:'hacienda',done:true,ins:[],grp:[],eqLIV:[],histPartidas:[['Ricard','Diego','Gin√©s','Abril'],['Chiky','Santi','Pedro'],['I√±aki','Alex','Rodiles']]},
{id:'baviera26',nombre:'Baviera',fecha:'2026-03-14',campoId:'baviera',done:false,ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'arcos26',nombre:'Arcos Gardens',fecha:'2026-04-18',campoId:'arcos',done:false,ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'gaucin26a',nombre:'Gauc√≠n - D√≠a 1',fecha:'2026-05-16',campoId:'pendiente',done:false,esDoble:true,doblePar:'gaucin26b',ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'gaucin26b',nombre:'Gauc√≠n - D√≠a 2',fecha:'2026-05-17',campoId:'pendiente',done:false,esDoble:true,doblePar:'gaucin26a',ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'mallorca26a',nombre:'Mallorca - D√≠a 1',fecha:'2026-06-20',campoId:'pendiente',done:false,esDoble:true,doblePar:'mallorca26b',ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'mallorca26b',nombre:'Mallorca - D√≠a 2',fecha:'2026-06-21',campoId:'pendiente',done:false,esDoble:true,doblePar:'mallorca26a',ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'julio26',nombre:'Por Confirmar (Julio)',fecha:'2026-07-11',campoId:'pendiente',done:false,ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'sept26',nombre:'Por Confirmar (Sept)',fecha:'2026-09-12',campoId:'pendiente',done:false,ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'oct26',nombre:'Por Confirmar (Oct)',fecha:'2026-10-10',campoId:'pendiente',done:false,ins:[],grp:[],eqLIV:[],histPartidas:[]},
{id:'f1',nombre:'Final 1 - El Camale√≥n',fecha:'2026-11-03',campoId:'camaleon',done:false,esFinal:true,ins:[],grp:[],eqLIV:[]},
{id:'f2',nombre:'Final 2 - PGA Riviera Maya',fecha:'2026-11-04',campoId:'pgariviera',done:false,esFinal:true,ins:[],grp:[],eqLIV:[]},
{id:'ryder26a',nombre:'Ryder D√≠a 1 - Playa Para√≠so',fecha:'2026-11-06',campoId:'playaparaiso',done:false,esRyder:true,ryderDia:1,ins:[],equipoA:{nombre:'Equipo A',color:'#1565c0',jug:[],parejas:[]},equipoB:{nombre:'Equipo B',color:'#c62828',jug:[],parejas:[]},partidos:[]},
{id:'ryder26b',nombre:'Ryder D√≠a 2 - El Camale√≥n',fecha:'2026-11-07',campoId:'camaleon',done:false,esRyder:true,ryderDia:2,ins:[],equipoA:{nombre:'Equipo A',color:'#1565c0',jug:[],parejas:[]},equipoB:{nombre:'Equipo B',color:'#c62828',jug:[],parejas:[]},partidos:[]}
];

// VIAJE MAYACOBA - Datos del viaje
const VIAJE_MAYACOBA={
fecha:'3-7 Nov 2026',
destino:'Riviera Maya, M√©xico',
gastos:[
{concepto:'Casa',total:20000,desc:'8 habitaciones (5 individuales y 3 dobles)',icono:'üè†'},
{concepto:'Ch√≥fer',total:2800,desc:'Transfer aeropuerto I/V + 10h diarias para golf',icono:'üöê'},
{concepto:'Vuelos',total:27500,desc:'Ida turista superior, vuelta en Business',icono:'‚úàÔ∏è'},
{concepto:'F & B',total:5500,desc:'Bebidas y comidas',icono:'üçΩÔ∏è'},
{concepto:'Green Fees',total:11000,desc:'4 d√≠as de juego (Final MT + Ryder)',icono:'‚õ≥'},
{concepto:'Varios',total:5500,desc:'Fondo de maniobra',icono:'üíº'}
],
totalGeneral:72300,
viajeros:[
{hab:1,nombre:'Carlos R.',casa:1250,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:6004.55,pagado:1000},
{hab:1,nombre:'Santi',casa:1250,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:6004.55,pagado:1600},
{hab:2,nombre:'Alex',casa:2500,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:7254.55,pagado:1000},
{hab:3,nombre:'Carlos A.',casa:1250,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:6004.55,pagado:1600},
{hab:3,nombre:'Pedro',casa:1250,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:6004.55,pagado:1600},
{hab:4,nombre:'Gin√©s',casa:2500,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:7254.55,pagado:1600},
{hab:5,nombre:'Ricard',casa:1250,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:6004.55,pagado:2000},
{hab:5,nombre:'Diego',casa:1250,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:6004.55,pagado:1600},
{hab:6,nombre:'Manolo',casa:2500,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:7254.55,pagado:1600},
{hab:7,nombre:'Chiky',casa:2500,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:7254.55,pagado:2035},
{hab:8,nombre:'I√±aki',casa:2500,chofer:254.55,vuelos:2500,fb:500,gf:1000,varios:500,total:7254.55,pagado:1600}
],
remanentes:[{concepto:'Remanente 24/25',cantidad:1255.24},{concepto:'Remanente 24/25',cantidad:3330}],
reservas:[{concepto:'50% Reserva Casa',cantidad:9950},{concepto:'50% Reserva Ch√≥fer',cantidad:1435}],
totalPagado:21820.24
};

const pc=p=>p===1?'gold':p===2?'silver':p===3?'bronze':'';
const hcpJ=(h,r)=>r?Math.floor(h):Math.ceil(h);
const gE=(hcp,idx)=>{if(hcp<=0)return idx<=Math.abs(hcp)?-1:0;if(hcp<=18)return idx<=hcp?1:0;if(hcp<=36)return idx<=(hcp-18)?2:1;return idx<=(hcp-36)?3:2;};
const stb=(g,p,e)=>{if(!g)return 0;const d=g-e-p;return d<=-3?5:d===-2?4:d===-1?3:d===0?2:d===1?1:0;};
const genCode=()=>Math.random().toString(36).substring(2,6).toUpperCase();

// Funci√≥n para mostrar nombre con handicap: "Nombre hcp (hcpJuego)"
// Rodiles (esR:true) redondea a la baja, el resto al alza
const nomConHcp=(jug,jugadores)=>{
if(!jug)return'';
const j=jugadores?.find(x=>x.nombre===jug.nombre||x.nombre===jug)||jug;
const nombre=j.nombre||jug.nombre||jug;
const hcp=j.hcp;
if(hcp===undefined||hcp===null)return nombre;
const hcpJuego=j.esR?Math.floor(hcp):Math.ceil(hcp);
return`${nombre} ${hcp} (${hcpJuego})`;
};

// Sistema de puntos por posici√≥n (√≠ndice 0 = 1¬∫ puesto)
const PUNTOS_POSICION=[15,12,10,9,8,7,6,5,4,3,2,1,0];
const getPuntosPosicion=(pos)=>pos<=13?PUNTOS_POSICION[pos-1]:0;

// Ryder Cup - Puntuaci√≥n ponderada para equilibrar equipos
const calcPuntajeEquilibrio=(jug)=>{
const posClasif=CLASIF.find(c=>c.nombre===jug.nombre)?.pos||99;
const hcp=jug.hcp||20;
// Ponderaci√≥n: 60% handicap, 40% clasificaci√≥n (normalizado)
return(hcp*0.6)+((posClasif/13)*20*0.4);
};

// Formar equipos equilibrados de 6 jugadores cada uno
const formarEquiposRyder=(jugadores)=>{
if(jugadores.length<12)return null;
const sorted=[...jugadores].sort((a,b)=>calcPuntajeEquilibrio(a)-calcPuntajeEquilibrio(b));
const equipoA=[];const equipoB=[];
// M√©todo serpentina: 1-2-2-2-2-2-1
for(let i=0;i<12;i++){
const jug=sorted[i];
if(i%4===0||i%4===3)equipoA.push(jug);
else equipoB.push(jug);
}
return{equipoA,equipoB};
};

// Formar parejas dentro de un equipo
const formarParejasRyder=(equipo)=>{
const parejas=[];
for(let i=0;i<equipo.length;i+=2){
if(i+1<equipo.length){
parejas.push({id:Date.now()+i,jug:[equipo[i],equipo[i+1]],resultado:null});
}}
return parejas;
};

const getLIVHist=(nombre)=>{
const hist=[];
PRUEBAS_HIST.forEach(pr=>{pr.liv.forEach(eq=>{if(eq.jug.includes(nombre)){const idx=eq.jug.indexOf(nombre);hist.push({prueba:pr.nombre,fecha:pr.fecha,equipo:eq.jug,misPts:eq.pts[idx],total:eq.tot,pos:eq.pos,ptsLIV:eq.pLIV});}});});
return hist.reverse();
};

const App=()=>{
const[scr,setScr]=useState('home');
const[isAdmin,setIsAdmin]=useState(false);
const[showLogin,setShowLogin]=useState(false);
const[showPartidaLogin,setShowPartidaLogin]=useState(false);
// Modal de confirmaci√≥n no-bloqueante (reemplaza confirm() que congelaba Firebase listeners)
const[confirmModal,setConfirmModal]=useState(null);
const mostrarConfirm=(msg,onOk)=>{setConfirmModal({msg,onOk});};
const cerrarConfirm=()=>setConfirmModal(null);
// Estados con persistencia en localStorage
const[jugadores,setJugadores]=useState(()=>{
try{const saved=localStorage.getItem('maniac_jugadores');return saved?JSON.parse(saved):JUG_INI;}catch(e){return JUG_INI;}
});
const[editJug,setEditJug]=useState(null);
const[showEditModal,setShowEditModal]=useState(false);
const[cal,setCal]=useState(()=>{
try{const saved=localStorage.getItem('maniac_calendario');return saved?JSON.parse(saved):CAL_INI;}catch(e){return CAL_INI;}
});
const[selJug,setSelJug]=useState(null);
const[selPr,setSelPr]=useState(null);
const[tab,setTab]=useState('general');
const[admScr,setAdmScr]=useState(null);
const[selPrueba,setSelPrueba]=useState(null);
const[liveOn,setLiveOn]=useState(false);
const[hole,setHole]=useState(1);
const[scores,setScores]=useState(()=>{
try{const saved=localStorage.getItem('maniac_scores');return saved?JSON.parse(saved):{};}catch(e){return {};}
});
const[partidaActiva,setPartidaActiva]=useState(null);
const[pruebaActiva,setPruebaActiva]=useState(null);
// Estado del viaje con persistencia en localStorage
const[isViajeAdmin,setIsViajeAdmin]=useState(false);
const[showViajeLogin,setShowViajeLogin]=useState(false);
const[viajeGastos,setViajeGastos]=useState(()=>{
try{const saved=localStorage.getItem('maniac_viaje_gastos');return saved?JSON.parse(saved):VIAJE_MAYACOBA.gastos;}catch(e){return VIAJE_MAYACOBA.gastos;}
});
const[viajeViajeros,setViajeViajeros]=useState(()=>{
try{const saved=localStorage.getItem('maniac_viaje_viajeros');return saved?JSON.parse(saved):VIAJE_MAYACOBA.viajeros;}catch(e){return VIAJE_MAYACOBA.viajeros;}
});
const[viajeRemanentes,setViajeRemanentes]=useState(()=>{
try{const saved=localStorage.getItem('maniac_viaje_remanentes');return saved?JSON.parse(saved):VIAJE_MAYACOBA.remanentes.map(r=>({...r,gastos:[]}));}catch(e){return VIAJE_MAYACOBA.remanentes.map(r=>({...r,gastos:[]}));}
});
const[nuevoGasto,setNuevoGasto]=useState({concepto:'',total:0,desc:'',icono:'üì¶'});
const[guardado,setGuardado]=useState(false);
const[cambiosPendientes,setCambiosPendientes]=useState(false);
// Estados para modo edici√≥n post-partida
const[modoEdicion,setModoEdicion]=useState(false);
const[hoyoEdicion,setHoyoEdicion]=useState(1);
// Estados para resultados y asistencia a comida
const[modoResultados,setModoResultados]=useState(false);
const[asistenciaComida,setAsistenciaComida]=useState({});

// cambiosPendientes se marca manualmente solo en las funciones que hacen cambios locales
// (eliminado el useEffect que lo marcaba en CADA actualizacion, incluyendo las de Firebase)

// Estado de conexi√≥n Firebase
const[firebaseConectado,setFirebaseConectado]=useState(false);
const[cargandoFirebase,setCargandoFirebase]=useState(true);
const[guardandoFirebase,setGuardandoFirebase]=useState(false);
const[ultimaActLocal,setUltimaActLocal]=useState(null);
const[colaGuardado,setColaGuardado]=useState(null);
const guardandoRef=React.useRef(false);
const debounceRef=React.useRef(null);

// Ref para timestamp local (evita re-suscribir el listener)
const ultimaActRef=useRef(null);

// Cargar datos desde Firebase al iniciar Y escuchar cambios en tiempo real
// SIN dependencias variables para evitar re-suscripcion infinita
// THROTTLE: con 13 usuarios escribiendo, Firebase dispara muchos updates.
// Procesamos m√°ximo 1 update cada 800ms para no saturar el hilo de React.
const throttleRef=useRef(null);
const pendingDataRef=useRef(null);
const hcpCorregidoRef=useRef(false); // Solo 1 cliente corrige handicaps
useEffect(()=>{
let mounted=true;
const procesarDatos=(datos)=>{
if(!mounted||guardandoRef.current)return;
const remoteTime=datos.ultimaActualizacion?new Date(datos.ultimaActualizacion).getTime():0;
const localTime=ultimaActRef.current?new Date(ultimaActRef.current).getTime():0;
if(!ultimaActRef.current||remoteTime>localTime){
// React 18 auto-batch: todas las actualizaciones en un tick = 1 solo re-render
ReactDOM.unstable_batchedUpdates(()=>{
if(datos.viajeGastos)setViajeGastos(datos.viajeGastos);
if(datos.viajeViajeros)setViajeViajeros(datos.viajeViajeros);
if(datos.viajeRemanentes)setViajeRemanentes(datos.viajeRemanentes);
if(datos.cal)setCal(datos.cal);
if(datos.scores)setScores(datos.scores);
// Forzar handicaps correctos de JUG_INI si Firebase tiene valores desactualizados
// Y ASEGURAR que todos los jugadores de JUG_INI existen (por si falta alguno en Firebase)
const fbJugadores=datos.jugadores||JUG_INI;
const jugCorregidos=JUG_INI.map(ini=>{
const fb=fbJugadores.find(x=>x.id===ini.id);
if(fb){
// Existe en Firebase: forzar nombre, hcp y esR correctos de JUG_INI
if(fb.hcp!==ini.hcp||fb.esR!==ini.esR||fb.nombre!==ini.nombre){
return{...fb,nombre:ini.nombre,hcp:ini.hcp,esR:ini.esR||false};
}
return fb;
}
// NO existe en Firebase: a√±adirlo desde JUG_INI
return{...ini};
});
const hcpCambiaron=jugCorregidos.length!==fbJugadores.length||jugCorregidos.some((j)=>{
const orig=fbJugadores.find(x=>x.id===j.id);
return !orig||orig.hcp!==j.hcp||orig.esR!==j.esR||orig.nombre!==j.nombre;
});
setJugadores(jugCorregidos);
if(datos.ultimaActualizacion){
ultimaActRef.current=datos.ultimaActualizacion;
setUltimaActLocal(datos.ultimaActualizacion);
}
setFirebaseConectado(true);
setCargandoFirebase(false);
setCambiosPendientes(false);
// Si los handicaps estaban desactualizados, solo 1 cliente corrige
// Usa delay aleatorio (1-5s) para evitar que 13 clientes escriban a la vez
if(hcpCambiaron&&!guardandoRef.current&&!hcpCorregidoRef.current){
hcpCorregidoRef.current=true;
const randomDelay=1000+Math.random()*4000;
setTimeout(()=>{
if(!guardandoRef.current){
guardandoRef.current=true;
const ts=new Date().toISOString();
db.ref('maniac').update({jugadores:jugCorregidos,ultimaActualizacion:ts}).then(()=>{
ultimaActRef.current=ts;
setTimeout(()=>{guardandoRef.current=false;},500);
console.log('Handicaps actualizados en Firebase');
}).catch(()=>{guardandoRef.current=false;});
}
},randomDelay);
}
});
}else{
setFirebaseConectado(true);
setCargandoFirebase(false);
}
};
const onValue=(snapshot)=>{
if(!mounted)return;
if(guardandoRef.current)return;
const datos=snapshot.val();
if(!datos)return;
// THROTTLE: si ya hay un procesamiento pendiente, guardar datos y esperar
if(throttleRef.current){
pendingDataRef.current=datos;
return;
}
// Procesar inmediatamente
procesarDatos(datos);
// Bloquear procesamiento durante 800ms
throttleRef.current=setTimeout(()=>{
throttleRef.current=null;
// Si hay datos pendientes, procesar los m√°s recientes
if(pendingDataRef.current){
const pending=pendingDataRef.current;
pendingDataRef.current=null;
procesarDatos(pending);
}
},800);
};
const onError=(err)=>{
console.log('Error Firebase:',err);
if(mounted){setCargandoFirebase(false);setFirebaseConectado(false);}
};
db.ref('maniac').on('value',onValue,onError);
// Monitor connection state
const connRef=db.ref('.info/connected');
const onConn=(snap)=>{if(mounted)setFirebaseConectado(!!snap.val());};
connRef.on('value',onConn);
return()=>{
mounted=false;
db.ref('maniac').off('value',onValue);
connRef.off('value',onConn);
if(debounceRef.current)clearTimeout(debounceRef.current);
if(throttleRef.current)clearTimeout(throttleRef.current);
};
// eslint-disable-next-line react-hooks/exhaustive-deps
},[]);

// Funci√≥n para guardar todos los datos en Firebase con debouncing robusto
const guardarTodo=(datosOverride=null,forzar=false)=>{
if(debounceRef.current&&!forzar){clearTimeout(debounceRef.current);}
const ejecutarGuardado=()=>{
const timestamp=new Date().toISOString();
const datos=datosOverride||{
viajeGastos,viajeViajeros,viajeRemanentes,cal,scores,jugadores,
ultimaActualizacion:timestamp
};
datos.ultimaActualizacion=timestamp;
guardandoRef.current=true;
setGuardandoFirebase(true);
ultimaActRef.current=timestamp;
setUltimaActLocal(timestamp);
// CRITICAL FIX: usar update() en vez de set() para evitar race conditions
// con 13 usuarios escribiendo simult√°neamente. set() sobreescribe TODO,
// update() solo escribe las claves que cambiaron, sin pisar datos de otros.
const updatePayload={};
if(datos.viajeGastos)updatePayload.viajeGastos=datos.viajeGastos;
if(datos.viajeViajeros)updatePayload.viajeViajeros=datos.viajeViajeros;
if(datos.viajeRemanentes)updatePayload.viajeRemanentes=datos.viajeRemanentes;
if(datos.cal)updatePayload.cal=datos.cal;
if(datos.scores)updatePayload.scores=datos.scores;
if(datos.jugadores)updatePayload.jugadores=datos.jugadores;
updatePayload.ultimaActualizacion=timestamp;
return db.ref('maniac').update(updatePayload).then(()=>{
setCambiosPendientes(false);
setGuardado(true);
setFirebaseConectado(true);
// Desbloquear rapido (500ms en vez de 2000ms) para no perder updates de otros
setTimeout(()=>{setGuardado(false);setGuardandoFirebase(false);guardandoRef.current=false;},500);
// Guardar en localStorage de forma asincrona para no bloquear UI
setTimeout(()=>{try{
localStorage.setItem('maniac_viaje_gastos',JSON.stringify(datos.viajeGastos||viajeGastos));
localStorage.setItem('maniac_viaje_viajeros',JSON.stringify(datos.viajeViajeros||viajeViajeros));
localStorage.setItem('maniac_viaje_remanentes',JSON.stringify(datos.viajeRemanentes||viajeRemanentes));
localStorage.setItem('maniac_calendario',JSON.stringify(datos.cal||cal));
localStorage.setItem('maniac_scores',JSON.stringify(datos.scores||scores));
localStorage.setItem('maniac_jugadores',JSON.stringify(datos.jugadores||jugadores));
}catch(e){}},0);
return true;
}).catch((err)=>{
setGuardandoFirebase(false);
guardandoRef.current=false;
console.error('Error al guardar:',err);
setFirebaseConectado(false);
return false;
});
};
// Debounce 1s para agrupar cambios rapidos (antes 300ms era muy corto con 13 usuarios)
if(forzar){return ejecutarGuardado();}
debounceRef.current=setTimeout(ejecutarGuardado,1000);
};

// Auto-guardar sin bloquear UI (reemplaza confirm() que congelaba la app)
const autoGuardar=(datosOverride=null)=>{
setCambiosPendientes(true);
guardarTodo(datosOverride);
};

// Funci√≥n para guardar inmediatamente sin preguntar (para datos cr√≠ticos en vivo)
const guardarInmediato=(datosOverride=null)=>{
guardarTodo(datosOverride,true);
};

// Exportar datos a JSON
const exportarDatos=()=>{
const datos={
version:'1.0',
fecha:new Date().toISOString(),
viajeGastos,viajeViajeros,viajeRemanentes,cal,scores,jugadores
};
const blob=new Blob([JSON.stringify(datos,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;a.download=`maniac_backup_${new Date().toISOString().slice(0,10)}.json`;
a.click();URL.revokeObjectURL(url);
};

// Importar datos desde JSON
const importarDatos=(e)=>{
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=(ev)=>{
try{
const datos=JSON.parse(ev.target.result);
if(datos.viajeGastos)setViajeGastos(datos.viajeGastos);
if(datos.viajeViajeros)setViajeViajeros(datos.viajeViajeros);
if(datos.viajeRemanentes)setViajeRemanentes(datos.viajeRemanentes);
if(datos.cal)setCal(datos.cal);
if(datos.scores)setScores(datos.scores);
if(datos.jugadores)setJugadores(datos.jugadores);
guardarTodo();
alert('Datos importados correctamente');
}catch(err){alert('Error al importar: archivo no v√°lido');}
};
reader.readAsText(file);
};

// Preguntar antes de cerrar si hay cambios sin guardar
useEffect(()=>{
const handleBeforeUnload=(e)=>{
if(cambiosPendientes){e.preventDefault();e.returnValue='Tienes cambios sin guardar. ¬øSeguro que quieres salir?';}
};
window.addEventListener('beforeunload',handleBeforeUnload);
return()=>window.removeEventListener('beforeunload',handleBeforeUnload);
},[cambiosPendientes]);

// Funci√≥n para salir - auto-guarda si hay cambios pendientes (sin bloquear con confirm)
const salirConVerificacion=(destino,callback)=>{
if(cambiosPendientes){guardarTodo();}
callback();
};

// Obtener prueba actualizada del estado
const getPrueba=(id)=>cal.find(p=>p.id===id);

const campoAct=useMemo(()=>{
const pr=pruebaActiva?getPrueba(pruebaActiva.id):null;
return pr?.campoId?CAMPOS.find(c=>c.id===pr.campoId):null;
},[pruebaActiva,cal]);

const hoyoAct=useMemo(()=>campoAct?.hoyos.find(h=>h.n===hole),[campoAct,hole]);

// Leaderboard de la partida actual (para uso interno)
const lb=useMemo(()=>{
if(!campoAct||!partidaActiva)return[];
const jug=partidaActiva.jug||[];
return jug.map(j=>{
const hcp=hcpJ(j.hcp,j.esR);let tot=0,thru=0;
for(let h=1;h<=18;h++){const g=scores[`${j.id}-${h}`];if(g>0){const ho=campoAct.hoyos.find(x=>x.n===h);if(ho){tot+=stb(g,ho.p,gE(hcp,ho.i));thru=h;}}}
return{...j,totalPts:tot,hoyosJugados:thru};
}).sort((a,b)=>b.totalPts-a.totalPts);
},[scores,partidaActiva,campoAct]);

// Leaderboard GLOBAL de todas las partidas de la prueba activa
const lbGlobal=useMemo(()=>{
if(!campoAct||!pruebaActiva)return[];
const pr=cal.find(p=>p.id===pruebaActiva.id);
if(!pr)return[];
const todosJugadores=[];
// Recoger todos los jugadores de todos los grupos
(pr.grp||[]).forEach(g=>{
(g.jug||[]).forEach(j=>{
if(!todosJugadores.find(x=>x.id===j.id)){
todosJugadores.push(j);
}
});
});
// Calcular puntos para cada jugador
return todosJugadores.map(j=>{
const hcp=hcpJ(j.hcp,j.esR);let tot=0,thru=0;
for(let h=1;h<=18;h++){
const g=scores[`${j.id}-${h}`];
if(g>0){
const ho=campoAct.hoyos.find(x=>x.n===h);
if(ho){tot+=stb(g,ho.p,gE(hcp,ho.i));thru=h;}
}
}
return{...j,totalPts:tot,hoyosJugados:thru};
}).sort((a,b)=>b.totalPts-a.totalPts);
},[scores,pruebaActiva,campoAct,cal]);

const login=pwd=>{if(pwd==='maniac2025'){setIsAdmin(true);setShowLogin(false);setScr('admin');}};
const loginViaje=pwd=>{if(pwd==='PEKAS'){setIsViajeAdmin(true);setShowViajeLogin(false);}};

// Funciones del viaje - con guardado autom√°tico (solo en modo Admin Viaje)
const updateViajero=(idx,field,value)=>{
setViajeViajeros(prev=>{
const newViajeros=prev.map((v,i)=>i===idx?{...v,[field]:parseFloat(value)||0}:v);
// Solo preguntar guardar si es admin del viaje
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newViajeros,viajeRemanentes,cal,scores,jugadores});}
return newViajeros;
});
};
const updateGasto=(idx,field,value)=>{
setViajeGastos(prev=>{
const newGastos=prev.map((g,i)=>i===idx?{...g,[field]:field==='total'?(parseFloat(value)||0):value}:g);
if(isViajeAdmin){autoGuardar({viajeGastos:newGastos,viajeViajeros,viajeRemanentes,cal,scores,jugadores});}
return newGastos;
});
};
const addGasto=()=>{
if(nuevoGasto.concepto&&nuevoGasto.total>0){
setViajeGastos(prev=>{
const newGastos=[...prev,{...nuevoGasto}];
if(isViajeAdmin){autoGuardar({viajeGastos:newGastos,viajeViajeros,viajeRemanentes,cal,scores,jugadores});}
return newGastos;
});
setNuevoGasto({concepto:'',total:0,desc:'',icono:'üì¶'});
}};
const removeGasto=(idx)=>{
setViajeGastos(prev=>{
const newGastos=prev.filter((_,i)=>i!==idx);
if(isViajeAdmin){autoGuardar({viajeGastos:newGastos,viajeViajeros,viajeRemanentes,cal,scores,jugadores});}
return newGastos;
});
};
// Funciones para gastos contra remanente (efectivo en caja)
const addGastoRemanente=(remIdx,concepto,cantidad)=>{
if(!concepto||!cantidad||cantidad<=0)return;
setViajeRemanentes(prev=>{
const newRem=prev.map((r,i)=>{
if(i!==remIdx)return r;
return{...r,gastos:[...(r.gastos||[]),{concepto,cantidad:parseFloat(cantidad),fecha:new Date().toISOString().split('T')[0]}]};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes:newRem,cal,scores,jugadores});}
return newRem;
});
};
const removeGastoRemanente=(remIdx,gastoIdx)=>{
setViajeRemanentes(prev=>{
const newRem=prev.map((r,i)=>{
if(i!==remIdx)return r;
return{...r,gastos:(r.gastos||[]).filter((_,gi)=>gi!==gastoIdx)};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes:newRem,cal,scores,jugadores});}
return newRem;
});
};
const getRemanenteSaldo=(rem)=>{
const gastosTotal=(rem.gastos||[]).reduce((s,g)=>s+g.cantidad,0);
return rem.cantidad-gastosTotal;
};
// Total din√°mico: suma campos fijos + extras personalizados
const recalcViajeroTotal=(v)=>{
const base=v.casa+v.chofer+v.vuelos+v.fb+v.gf+v.varios;
const extras=(v.extras||[]).reduce((s,e)=>s+(e.cantidad||0),0);
return base+extras;
};
// Repartir un gasto equitativamente entre todos los viajeros (a partes iguales)
const repartirGastoIgual=(field,totalGasto)=>{
const n=viajeViajeros.length;
if(n===0)return;
const cada=Math.round((totalGasto/n)*100)/100;
setViajeViajeros(prev=>{
const newV=prev.map(v=>({...v,[field]:cada}));
const withTotals=newV.map(v=>({...v,total:recalcViajeroTotal(v)}));
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:withTotals,viajeRemanentes,cal,scores,jugadores});}
return withTotals;
});
};
// Repartir casa seg√∫n habitaciones: precio casa / n¬∫ habitaciones = precio habitaci√≥n
// Los que comparten habitaci√≥n pagan a medias, los que est√°n solos pagan la habitaci√≥n completa
const repartirCasa=(totalCasa)=>{
setViajeViajeros(prev=>{
// Contar cu√°ntas habitaciones √∫nicas hay
const habsUnicas=[...new Set(prev.map(v=>v.hab))];
const nHabs=habsUnicas.length;
if(nHabs===0)return prev;
const precioHab=Math.round((totalCasa/nHabs)*100)/100;
// Contar ocupantes por habitaci√≥n
const ocupantesPorHab={};
prev.forEach(v=>{ocupantesPorHab[v.hab]=(ocupantesPorHab[v.hab]||0)+1;});
const newV=prev.map(v=>{
const nOcupantes=ocupantesPorHab[v.hab]||1;
const cuota=Math.round((precioHab/nOcupantes)*100)/100;
return{...v,casa:cuota};
});
const withTotals=newV.map(v=>({...v,total:recalcViajeroTotal(v)}));
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:withTotals,viajeRemanentes,cal,scores,jugadores});}
return withTotals;
});
};
// Repartir todos los gastos seg√∫n reglas Maniac:
// Casa ‚Üí por habitaci√≥n (compartida o individual)
// Todo lo dem√°s ‚Üí a partes iguales entre todos
const repartirTodoSegunReglas=()=>{
setViajeViajeros(prev=>{
const n=prev.length;
if(n===0)return prev;
// Calcular cuota de casa por habitaci√≥n
const habsUnicas=[...new Set(prev.map(v=>v.hab))];
const nHabs=habsUnicas.length||1;
const gastoCasa=viajeGastos[0]; // Casa es siempre el primer gasto
const totalCasa=gastoCasa?gastoCasa.total:0;
const precioHab=Math.round((totalCasa/nHabs)*100)/100;
const ocupantesPorHab={};
prev.forEach(v=>{ocupantesPorHab[v.hab]=(ocupantesPorHab[v.hab]||0)+1;});
// Los dem√°s gastos (√≠ndices 1-5) a partes iguales
const cuotaChofer=viajeGastos[1]?Math.round((viajeGastos[1].total/n)*100)/100:0;
const cuotaVuelos=viajeGastos[2]?Math.round((viajeGastos[2].total/n)*100)/100:0;
const cuotaFB=viajeGastos[3]?Math.round((viajeGastos[3].total/n)*100)/100:0;
const cuotaGF=viajeGastos[4]?Math.round((viajeGastos[4].total/n)*100)/100:0;
const cuotaVarios=viajeGastos[5]?Math.round((viajeGastos[5].total/n)*100)/100:0;
const newV=prev.map(v=>{
const nOcupantes=ocupantesPorHab[v.hab]||1;
const cuotaCasa=Math.round((precioHab/nOcupantes)*100)/100;
const updated={...v,casa:cuotaCasa,chofer:cuotaChofer,vuelos:cuotaVuelos,fb:cuotaFB,gf:cuotaGF,varios:cuotaVarios};
// Tambi√©n repartir extras a partes iguales si los hay
if(updated.extras&&updated.extras.length>0){
// Los extras se calculan buscando el gasto general correspondiente (√≠ndice 6+)
updated.extras=updated.extras.map((ex,ei)=>{
const gastoIdx=6+ei;
if(viajeGastos[gastoIdx]){
return{...ex,cantidad:Math.round((viajeGastos[gastoIdx].total/n)*100)/100};
}
return ex;
});
}
return{...updated,total:recalcViajeroTotal(updated)};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// Repartir extra equitativamente
const repartirExtraIgual=(extraIdx,totalGasto)=>{
const n=viajeViajeros.length;
if(n===0)return;
const cada=Math.round((totalGasto/n)*100)/100;
setViajeViajeros(prev=>{
const newV=prev.map(v=>{
const extras=[...(v.extras||[])];
if(extras[extraIdx]){extras[extraIdx]={...extras[extraIdx],cantidad:cada};}
return{...v,extras,total:recalcViajeroTotal({...v,extras})};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// A√±adir gasto extra a todos los viajeros
const addExtraToViajeros=(concepto,icono)=>{
setViajeViajeros(prev=>{
const newV=prev.map(v=>{
const extras=[...(v.extras||[]),{concepto,icono:icono||'üì¶',cantidad:0}];
return{...v,extras};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// Eliminar gasto extra de todos los viajeros
const removeExtraFromViajeros=(extraIdx)=>{
setViajeViajeros(prev=>{
const newV=prev.map(v=>{
const extras=[...(v.extras||[])];
extras.splice(extraIdx,1);
return{...v,extras,total:recalcViajeroTotal({...v,extras})};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// Actualizar extra individual de un viajero
const updateViajeroExtra=(viajeroIdx,extraIdx,value)=>{
setViajeViajeros(prev=>{
const newV=prev.map((v,i)=>{
if(i!==viajeroIdx)return v;
const extras=[...(v.extras||[])];
if(extras[extraIdx]){extras[extraIdx]={...extras[extraIdx],cantidad:parseFloat(value)||0};}
const updated={...v,extras};
return{...updated,total:recalcViajeroTotal(updated)};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// Actualizar campo fijo de viajero con recalc total
const updateViajeroField=(idx,field,value)=>{
setViajeViajeros(prev=>{
const newV=prev.map((v,i)=>{
if(i!==idx)return v;
const updated={...v,[field]:parseFloat(value)||0};
return{...updated,total:recalcViajeroTotal(updated)};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};

// A√±adir un pago al historial de un viajero
const addPagoViajero=(viajeroIdx,cantidad,fecha,metodo)=>{
if(!cantidad||cantidad<=0)return;
setViajeViajeros(prev=>{
const newV=prev.map((v,i)=>{
if(i!==viajeroIdx)return v;
const pagos=[...(v.pagos||[]),{cantidad:parseFloat(cantidad),fecha,metodo}];
const totalPagado=pagos.reduce((s,p)=>s+p.cantidad,0);
return{...v,pagos,pagado:Math.round(totalPagado*100)/100};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// Eliminar un pago del historial
const removePagoViajero=(viajeroIdx,pagoIdx)=>{
setViajeViajeros(prev=>{
const newV=prev.map((v,i)=>{
if(i!==viajeroIdx)return v;
const pagos=[...(v.pagos||[])];
pagos.splice(pagoIdx,1);
const totalPagado=pagos.reduce((s,p)=>s+p.cantidad,0);
return{...v,pagos,pagado:Math.round(totalPagado*100)/100};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};
// Migrar pagado existente a historial de pagos (si no tiene pagos pero tiene pagado>0)
const migrarPagadoAPagos=(viajeroIdx)=>{
setViajeViajeros(prev=>{
const v=prev[viajeroIdx];
if(!v||v.pagado<=0||(v.pagos&&v.pagos.length>0))return prev;
const newV=prev.map((vj,i)=>{
if(i!==viajeroIdx)return vj;
return{...vj,pagos:[{cantidad:vj.pagado,fecha:'Anterior',metodo:'transfer'}]};
});
if(isViajeAdmin){autoGuardar({viajeGastos,viajeViajeros:newV,viajeRemanentes,cal,scores,jugadores});}
return newV;
});
};

// Editar jugador - con guardado autom√°tico (solo en modo Admin)
const updateJugador=(id,updates)=>{
setJugadores(prev=>{
const newJugadores=prev.map(j=>j.id===id?{...j,...updates}:j);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal,scores,jugadores:newJugadores});}
return newJugadores;
});
};
const openEditJug=(jug)=>{setEditJug({...jug});setShowEditModal(true);};
const saveEditJug=()=>{if(editJug){updateJugador(editJug.id,{nombre:editJug.nombre,hcp:editJug.hcp,esR:editJug.esR||false});}setShowEditModal(false);setEditJug(null);};

// Generaci√≥n de partidas
const shuffle=(arr)=>{const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};

const getHistorialPartidas=(pruebaId)=>{
const idx=cal.findIndex(p=>p.id===pruebaId);
const historial=[];
for(let i=0;i<idx;i++){
const pr=cal[i];
if(pr.done&&pr.histPartidas){historial.push(...pr.histPartidas);}
else if(pr.grp){pr.grp.forEach(g=>{if(g.jug.length>1){for(let a=0;a<g.jug.length;a++){for(let b=a+1;b<g.jug.length;b++){historial.push([g.jug[a].id,g.jug[b].id].sort().join('-'));}}}});}}
return historial;
};

const generarPartidasAleatorias=(pruebaId)=>{
const pr=getPrueba(pruebaId);
if(!pr)return;
const ins=pr.ins||[];
if(ins.length<2)return;
const esPrimera=cal.findIndex(p=>p.id===pruebaId)===0;
const esFinal=pr.esFinal;
let jugOrdenados;
if(esFinal){
jugOrdenados=[...ins].sort((a,b)=>{const pa=CLASIF.find(c=>c.nombre===a.nombre);const pb=CLASIF.find(c=>c.nombre===b.nombre);return(pa?.pos||99)-(pb?.pos||99);});
}else if(esPrimera){
jugOrdenados=shuffle(ins);
}else{
const historial=getHistorialPartidas(pruebaId);
const disponibles=[...ins];
jugOrdenados=[];
while(disponibles.length>0){
if(jugOrdenados.length===0){jugOrdenados.push(disponibles.shift());continue;}
let mejor=null;let mejorScore=Infinity;
for(let i=0;i<disponibles.length;i++){
let score=0;
for(const jug of jugOrdenados.slice(-3)){
const pair=[jug.id,disponibles[i].id].sort().join('-');
if(historial.includes(pair))score+=10;
}
if(score<mejorScore){mejorScore=score;mejor=i;}
}
if(mejor!==null)jugOrdenados.push(disponibles.splice(mejor,1)[0]);
else jugOrdenados.push(disponibles.shift());
}
}
const grupos=[];
for(let i=0;i<jugOrdenados.length;i+=4){
const grp=jugOrdenados.slice(i,Math.min(i+4,jugOrdenados.length));
grupos.push({id:Date.now()+i,jug:grp,adminId:null,code:genCode()});
}
setCal(prev=>{
const newCal=prev.map(p=>p.id===pruebaId?{...p,grp:grupos}:p);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

// Ryder Cup Management - con guardado autom√°tico (solo en modo Admin)
const generarEquiposRyder=(pruebaId)=>{
const pr=getPrueba(pruebaId);
if(!pr||!pr.esRyder)return;
const ins=pr.ins||[];
if(ins.length<12)return alert('Se necesitan al menos 12 jugadores inscritos');
const result=formarEquiposRyder(ins);
if(!result)return;
const parejasA=formarParejasRyder(result.equipoA);
const parejasB=formarParejasRyder(result.equipoB);
const partidos=parejasA.map((pA,i)=>({id:Date.now()+i,parejaA:pA,parejaB:parejasB[i],resultado:null,hoyo:1,scoresA:{},scoresB:{}}));
setCal(prev=>{
const newCal=prev.map(p=>p.id===pruebaId?{...p,equipoA:{...p.equipoA,jug:result.equipoA,parejas:parejasA},equipoB:{...p.equipoB,jug:result.equipoB,parejas:parejasB},partidos}:p);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const updateRyderEquipoNombre=(pruebaId,equipo,nombre)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id===pruebaId?{...p,[equipo]:{...p[equipo],nombre}}:p);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const setResultadoPartido=(pruebaId,partidoId,resultado)=>{
setCal(prev=>{
const newCal=prev.map(p=>{
if(p.id!==pruebaId)return p;
const partidos=(p.partidos||[]).map(m=>m.id===partidoId?{...m,resultado}:m);
return{...p,partidos};
});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

// CRUD Inscripciones - con guardado autom√°tico (solo en modo Admin)
const addIns=(pruebaId,jug)=>{
setCal(prev=>{
const newCal=prev.map(p=>{
if(p.id!==pruebaId)return p;
const ins=p.ins||[];
if(ins.find(i=>i.id===jug.id))return p;
return{...p,ins:[...ins,jug]};
});
// Solo preguntar guardar si es admin
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const remIns=(pruebaId,jugId)=>{
const jugNombre=jugadores.find(j=>j.id===jugId)?.nombre||'jugador';
setCal(prev=>{
const newCal=prev.map(p=>{
if(p.id!==pruebaId)return p;
return{...p,ins:(p.ins||[]).filter(i=>i.id!==jugId)};
});
// Solo preguntar guardar si es admin
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

// CRUD Grupos con admin - con guardado autom√°tico (solo en modo Admin)
const addGrp=(pruebaId)=>{
const code=genCode();
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,grp:[...(p.grp||[]),{id:Date.now(),jug:[],adminId:null,code}]});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const setGrpAdmin=(pruebaId,grpId,jugId)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,grp:(p.grp||[]).map(g=>g.id===grpId?{...g,adminId:jugId}:g)});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const addJG=(pruebaId,grpId,jug)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,grp:(p.grp||[]).map(g=>g.id!==grpId||g.jug.find(j=>j.id===jug.id)?g:{...g,jug:[...g.jug,jug]})});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const remJG=(pruebaId,grpId,jugId)=>{
const jugNombre=jugadores.find(j=>j.id===jugId)?.nombre||'jugador';
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,grp:(p.grp||[]).map(g=>g.id===grpId?{...g,jug:g.jug.filter(j=>j.id!==jugId),adminId:g.adminId===jugId?null:g.adminId}:g)});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

const remGrp=(pruebaId,grpId)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id===pruebaId?{...p,grp:(p.grp||[]).filter(g=>g.id!==grpId)}:p);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

// CRUD LIV - con guardado autom√°tico (solo en modo Admin)
const addEL=(pruebaId)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,eqLIV:[...(p.eqLIV||[]),{id:Date.now(),jug:[]}]});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};
const addJL=(pruebaId,eqId,jug)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,eqLIV:(p.eqLIV||[]).map(e=>e.id!==eqId||e.jug.length>=2||e.jug.find(j=>j.id===jug.id)?e:{...e,jug:[...e.jug,jug]})});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};
const remJL=(pruebaId,eqId,jugId)=>{
const jugNombre=jugadores.find(j=>j.id===jugId)?.nombre||'jugador';
setCal(prev=>{
const newCal=prev.map(p=>p.id!==pruebaId?p:{...p,eqLIV:(p.eqLIV||[]).map(e=>e.id===eqId?{...e,jug:e.jug.filter(j=>j.id!==jugId)}:e)});
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};
const remEL=(pruebaId,eqId)=>{
setCal(prev=>{
const newCal=prev.map(p=>p.id===pruebaId?{...p,eqLIV:(p.eqLIV||[]).filter(e=>e.id!==eqId)}:p);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};

// Score b√°sico (el guardado se hace con el bot√≥n dedicado en la pantalla de scoring)
const setScore=(jid,h,g)=>{setScores(prev=>({...prev,[`${jid}-${h}`]:Math.max(0,g)}));setCambiosPendientes(true);};

const startScoring=(prueba,grupo)=>{
setPruebaActiva(prueba);
setPartidaActiva(grupo);
setHole(1);
setLiveOn(true);
setScr('scoring');
};

// Acceso por c√≥digo de partida
const accessByCode=(code)=>{
for(const pr of cal){
if(pr.done)continue;
for(const g of(pr.grp||[])){
if(g.code===code&&g.jug.length>0){
startScoring(pr,g);
return true;
}}}
return false;
};

// SCREENS
// Pantalla de carga inicial
if(cargandoFirebase)return(
<div className="app" style={{display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',minHeight:'100vh',background:'linear-gradient(135deg,#1a472a,#2d5a3f)'}}>
<div style={{fontSize:60,marginBottom:20}}>‚õ≥</div>
<h1 style={{color:'#fff',fontFamily:'Georgia,serif',fontSize:24,marginBottom:10}}>Maniac Tour Golf</h1>
<p style={{color:'rgba(255,255,255,.7)',fontSize:14}}>Cargando datos...</p>
<div style={{marginTop:20,width:40,height:40,border:'3px solid rgba(255,255,255,.3)',borderTopColor:'#fff',borderRadius:'50%',animation:'spin 1s linear infinite'}}></div>
<style>{'@keyframes spin{to{transform:rotate(360deg)}}'}</style>
</div>
);

const HomeScr=()=>{
const prLive=liveOn&&pruebaActiva?getPrueba(pruebaActiva.id):null;
return(
<div className="scroll">
<header className="hdr">
<h1>Maniac Tour Golf</h1>
<div style={{display:'flex',alignItems:'center',gap:8}}>
{firebaseConectado?
<span style={{fontSize:9,background:'#4caf50',color:'#fff',padding:'2px 6px',borderRadius:8}}>‚òÅÔ∏è Online</span>:
<span style={{fontSize:9,background:'#ff9800',color:'#fff',padding:'2px 6px',borderRadius:8}}>‚ö†Ô∏è Offline</span>}
<span style={{fontSize:11,opacity:.8}}>2025-26</span>
</div>
</header>
{prLive&&<div className="sec" style={{paddingBottom:0}}>
<div className="live-card danger active" onClick={()=>setScr('live')}>
<div className="live-badge"><span className="live-dot"></span> EN DIRECTO</div>
<h2>{prLive.nombre}</h2>
<p>Hoyo {hole} ‚Ä¢ {lb.length} jugadores</p>
</div>
</div>}
<div className="sec">
<div className="live-card" onClick={()=>setScr('clasificacion')}><div className="live-badge">üèÜ L√çDER</div><h2>{CLASIF[0].nombre}</h2><p>{CLASIF[0].total} pts</p></div>
<div className="live-card danger" onClick={()=>setScr('clasificacion')}><div className="live-badge">‚ö° L√çDER LIV</div><h2>{CLASIF_LIV[0].nombre}</h2><p>{CLASIF_LIV[0].total} pts</p></div>
</div>
<div className="sec"><div className="menu-grid">
<button className="menu-item" onClick={()=>setScr('clasificacion')}><div className="menu-icon" style={{background:'#1a472a15'}}>üèÜ</div><span className="menu-label">Clasificaci√≥n</span></button>
<button className="menu-item" onClick={()=>setScr('calendario')}><div className="menu-icon" style={{background:'#2196f315'}}>üìÖ</div><span className="menu-label">Calendario</span></button>
<button className="menu-item" onClick={()=>setScr('historico')}><div className="menu-icon" style={{background:'#c9a22715'}}>üìä</div><span className="menu-label">Hist√≥rico</span></button>
<button className="menu-item" onClick={()=>setScr('jugadores')}><div className="menu-icon" style={{background:'#34495e15'}}>üë•</div><span className="menu-label">Jugadores</span></button>
<button className="menu-item" onClick={()=>setScr('live')}><div className="menu-icon" style={{background:'#c6282815'}}>üì∫</div><span className="menu-label">En Vivo</span></button>
<button className="menu-item" onClick={()=>setScr('stats')}><div className="menu-icon" style={{background:'#9c27b015'}}>üìà</div><span className="menu-label">Estad√≠sticas</span></button>
</div></div>
<div className="sec">
<div style={{background:'linear-gradient(135deg,#00897b,#26a69a)',borderRadius:14,padding:18,color:'#fff',cursor:'pointer',marginBottom:12}} onClick={()=>setScr('viaje')}>
<div style={{fontSize:11,textTransform:'uppercase',letterSpacing:2,opacity:.9,display:'flex',alignItems:'center',gap:6}}>‚úàÔ∏è VIAJE MAYACOBA</div>
<h2 style={{fontFamily:'Georgia,serif',fontSize:20,margin:'6px 0'}}>Riviera Maya 2026</h2>
<p style={{fontSize:12,opacity:.9}}>3-7 Nov ‚Ä¢ Finales + Ryder Cup</p>
</div>
</div>
<div className="sec" style={{paddingTop:0}}>
<div className="partida-access">
<h3>üéØ Acceso Admin Partida</h3>
<p style={{fontSize:12,color:'#888',marginBottom:10}}>¬øEres admin de una partida? Introduce tu c√≥digo</p>
<button className="btn btn-outline" onClick={()=>setShowPartidaLogin(true)}>Introducir C√≥digo</button>
</div>
</div>
<div className="sec"><button className="btn btn-sec" onClick={()=>isAdmin?setScr('admin'):setShowLogin(true)}>{isAdmin?'‚öôÔ∏è Panel Admin General':'üîê Admin General'}</button></div>
</div>
);};

const CalendarioScr=()=>{
const[selCampo,setSelCampo]=useState(null);
const prs=cal.filter(p=>!p.done);
const formatFecha=(f)=>{const d=new Date(f);return{dia:d.getDate(),mes:d.toLocaleDateString('es-ES',{month:'short'}),diaSem:d.toLocaleDateString('es-ES',{weekday:'short'})};};
const getCampo=(id)=>CAMPOS.find(c=>c.id===id);
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>üìÖ Calendario 2026</h1></header>
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:15}}>üëÜ Toca una prueba para ver detalles del campo</p>
{prs.map(p=>{
const f=formatFecha(p.fecha);
const campo=getCampo(p.campoId);
const iconoTipo=p.esRyder?'üèÜ':p.esFinal?'ü•á':p.esDoble?'üìç':'‚õ≥';
const colorBg=p.esRyder?'#fff3e0':p.esFinal?'#e8f5e9':'#fff';
return(
<div key={p.id} className="card" style={{background:colorBg,marginBottom:12}} onClick={()=>setSelCampo(selCampo===p.id?null:p.id)}>
<div style={{display:'flex',gap:14}}>
<div style={{minWidth:55,textAlign:'center',background:'#f5f5f5',borderRadius:10,padding:'10px 8px'}}>
<div style={{fontSize:10,color:'#888',textTransform:'uppercase'}}>{f.diaSem}</div>
<div style={{fontSize:22,fontWeight:700,color:'var(--pri)'}}>{f.dia}</div>
<div style={{fontSize:10,color:'#888',textTransform:'uppercase'}}>{f.mes}</div>
</div>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:15,marginBottom:4}}>{iconoTipo} {p.nombre}</div>
<div style={{fontSize:12,color:'#666'}}>{campo?.nombre||'Campo por confirmar'}</div>
{campo&&campo.id!=='pendiente'&&<div style={{fontSize:11,color:'#888',marginTop:3}}>Par {campo.par} ‚Ä¢ 18 hoyos</div>}
</div>
<div style={{alignSelf:'center',color:'#888',fontSize:14}}>{selCampo===p.id?'‚ñ≤':'‚ñº'}</div>
</div>
{selCampo===p.id&&campo&&campo.id!=='pendiente'&&(
<div style={{marginTop:15,borderTop:'1px solid #eee',paddingTop:15}}>
<div style={{fontWeight:700,marginBottom:10,fontSize:13}}>üèåÔ∏è Detalles del Campo</div>
<div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:6}}>
<div style={{background:'#f8f9fa',padding:10,borderRadius:8}}>
<div style={{fontSize:11,color:'#888'}}>NOMBRE</div>
<div style={{fontWeight:700,fontSize:13}}>{campo.nombre}</div>
</div>
<div style={{background:'#f8f9fa',padding:10,borderRadius:8}}>
<div style={{fontSize:11,color:'#888'}}>PAR TOTAL</div>
<div style={{fontWeight:700,fontSize:13,color:'var(--pri)'}}>{campo.par}</div>
</div>
</div>
<div style={{marginTop:12}}>
<div style={{fontSize:12,fontWeight:600,marginBottom:8}}>üìã Tarjeta del Campo</div>
<div style={{overflowX:'auto'}}>
<table style={{width:'100%',borderCollapse:'collapse',fontSize:11}}>
<thead>
<tr style={{background:'var(--pri)',color:'#fff'}}>
<th style={{padding:'6px 4px',textAlign:'center'}}>Hoyo</th>
{campo.hoyos.slice(0,9).map(h=><th key={h.n} style={{padding:'6px 3px',textAlign:'center'}}>{h.n}</th>)}
<th style={{padding:'6px 4px',textAlign:'center',background:'var(--pri-l)'}}>Out</th>
</tr>
</thead>
<tbody>
<tr style={{background:'#fff'}}>
<td style={{padding:'5px 4px',fontWeight:700}}>Par</td>
{campo.hoyos.slice(0,9).map(h=><td key={h.n} style={{padding:'5px 3px',textAlign:'center'}}>{h.p}</td>)}
<td style={{padding:'5px 4px',textAlign:'center',fontWeight:700,background:'#f0f0f0'}}>{campo.hoyos.slice(0,9).reduce((s,h)=>s+h.p,0)}</td>
</tr>
<tr style={{background:'#fafafa'}}>
<td style={{padding:'5px 4px',fontWeight:700}}>Idx</td>
{campo.hoyos.slice(0,9).map(h=><td key={h.n} style={{padding:'5px 3px',textAlign:'center',color:'#888'}}>{h.i}</td>)}
<td style={{padding:'5px 4px',textAlign:'center',background:'#f0f0f0'}}>-</td>
</tr>
</tbody>
</table>
<table style={{width:'100%',borderCollapse:'collapse',fontSize:11,marginTop:2}}>
<thead>
<tr style={{background:'var(--pri)',color:'#fff'}}>
<th style={{padding:'6px 4px',textAlign:'center'}}>Hoyo</th>
{campo.hoyos.slice(9,18).map(h=><th key={h.n} style={{padding:'6px 3px',textAlign:'center'}}>{h.n}</th>)}
<th style={{padding:'6px 4px',textAlign:'center',background:'var(--pri-l)'}}>In</th>
</tr>
</thead>
<tbody>
<tr style={{background:'#fff'}}>
<td style={{padding:'5px 4px',fontWeight:700}}>Par</td>
{campo.hoyos.slice(9,18).map(h=><td key={h.n} style={{padding:'5px 3px',textAlign:'center'}}>{h.p}</td>)}
<td style={{padding:'5px 4px',textAlign:'center',fontWeight:700,background:'#f0f0f0'}}>{campo.hoyos.slice(9,18).reduce((s,h)=>s+h.p,0)}</td>
</tr>
<tr style={{background:'#fafafa'}}>
<td style={{padding:'5px 4px',fontWeight:700}}>Idx</td>
{campo.hoyos.slice(9,18).map(h=><td key={h.n} style={{padding:'5px 3px',textAlign:'center',color:'#888'}}>{h.i}</td>)}
<td style={{padding:'5px 4px',textAlign:'center',background:'#f0f0f0'}}>-</td>
</tr>
</tbody>
</table>
</div>
<div style={{marginTop:10,display:'flex',justifyContent:'center',gap:15,fontSize:12,color:'#666'}}>
<span>Par Total: <strong style={{color:'var(--pri)'}}>{campo.par}</strong></span>
<span>Out: <strong>{campo.hoyos.slice(0,9).reduce((s,h)=>s+h.p,0)}</strong></span>
<span>In: <strong>{campo.hoyos.slice(9,18).reduce((s,h)=>s+h.p,0)}</strong></span>
</div>
</div>
</div>
)}
{selCampo===p.id&&(!campo||campo.id==='pendiente')&&(
<div style={{marginTop:15,borderTop:'1px solid #eee',paddingTop:15,textAlign:'center',color:'#888'}}>
<div style={{fontSize:24,marginBottom:8}}>üèåÔ∏è</div>
<p style={{fontSize:12}}>Campo por confirmar</p>
<p style={{fontSize:11}}>Los detalles se a√±adir√°n cuando se confirme el campo</p>
</div>
)}
</div>
);})}
</div>
</div>
);};

const ViajeScr=()=>{
const[editGasto,setEditGasto]=useState(null);
const[showAddGasto,setShowAddGasto]=useState(false);
const[editViajero,setEditViajero]=useState(null);
const[showAddExtra,setShowAddExtra]=useState(false);
const[nuevoExtra,setNuevoExtra]=useState({concepto:'',icono:'üì¶'});
const[addPagoIdx,setAddPagoIdx]=useState(null); // √≠ndice del viajero al que se a√±ade pago
const[nuevoPago,setNuevoPago]=useState({cantidad:'',fecha:new Date().toISOString().split('T')[0],metodo:'transfer'});
const[showPagosIdx,setShowPagosIdx]=useState(null); // √≠ndice del viajero cuyo historial se muestra
const[addGastoRemIdx,setAddGastoRemIdx]=useState(null); // √≠ndice del remanente al que se a√±ade gasto
const[nuevoGastoRem,setNuevoGastoRem]=useState({concepto:'',cantidad:''});
const v=VIAJE_MAYACOBA;
const totalGastos=viajeGastos.reduce((s,g)=>s+g.total,0);
const totalViajeros=viajeViajeros.reduce((s,p)=>s+(p.total||recalcViajeroTotal(p)),0);
const totalPagado=viajeViajeros.reduce((s,p)=>s+p.pagado,0);
const totalPendiente=totalViajeros-totalPagado;
const pctPagado=totalViajeros>0?(totalPagado/totalViajeros*100).toFixed(0):0;

// Campos fijos con su mapping a gasto general
const camposFijos=[
{key:'casa',label:'Casa',icono:'üè†'},
{key:'chofer',label:'Ch√≥fer',icono:'üöê'},
{key:'vuelos',label:'Vuelos',icono:'‚úàÔ∏è'},
{key:'fb',label:'F&B',icono:'üçΩÔ∏è'},
{key:'gf',label:'Green Fees',icono:'‚õ≥'},
{key:'varios',label:'Varios',icono:'üíº'}
];

return(
<div className="scroll">
<header className="hdr" style={{background:'linear-gradient(135deg,#00897b,#004d40)'}}>
<button className="hdr-back" onClick={()=>salirConVerificacion('home',()=>setScr('home'))}>‚Üê</button>
<div style={{flex:1}}><h1>‚úàÔ∏è Viaje Mayacoba</h1><p>{v.fecha}</p></div>
{guardado&&<span style={{background:'#4caf50',color:'#fff',padding:'4px 10px',borderRadius:12,fontSize:10,fontWeight:700,marginRight:6,animation:'fadeIn 0.3s'}}>‚úì Guardado</span>}
{cambiosPendientes&&isViajeAdmin&&<span style={{background:'#ff9800',color:'#fff',padding:'4px 10px',borderRadius:12,fontSize:10,fontWeight:700,marginRight:6}}>‚óè Sin guardar</span>}
{isViajeAdmin?<span style={{background:'#fff',color:'#00897b',padding:'4px 10px',borderRadius:12,fontSize:10,fontWeight:700}}>ADMIN</span>:
<button onClick={()=>setShowViajeLogin(true)} style={{background:'rgba(255,255,255,.2)',border:'none',color:'#fff',padding:'6px 12px',borderRadius:8,fontSize:11,cursor:'pointer'}}>üîê</button>}
</header>
<div style={{background:'linear-gradient(135deg,#00897b,#26a69a)',padding:20,color:'#fff',textAlign:'center'}}>
<div style={{fontSize:12,opacity:.8,marginBottom:5}}>{v.destino}</div>
<div style={{fontSize:36,fontWeight:700}}>{totalGastos.toLocaleString('es-ES')} ‚Ç¨</div>
<div style={{fontSize:12,opacity:.9,marginTop:5}}>Coste total del viaje</div>
<div style={{marginTop:15,background:'rgba(255,255,255,.2)',borderRadius:20,height:8,overflow:'hidden'}}>
<div style={{width:`${pctPagado}%`,height:'100%',background:'#fff',borderRadius:20}}></div>
</div>
<div style={{marginTop:8,fontSize:11,display:'flex',justifyContent:'space-between'}}>
<span>Pagado: {totalPagado.toLocaleString('es-ES')} ‚Ç¨</span>
<span>{pctPagado}%</span>
</div>
</div>

{/* SECCI√ìN 1: GASTOS GENERALES */}
<div className="sec">
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
<div className="section-title" style={{margin:0}}>üí∞ Gastos Generales</div>
{isViajeAdmin&&<button onClick={()=>setShowAddGasto(true)} style={{background:'#00897b',color:'#fff',border:'none',padding:'6px 12px',borderRadius:8,fontSize:11,cursor:'pointer'}}>+ A√±adir</button>}
</div>
{viajeGastos.map((g,i)=>(
<div key={i} style={{background:'#fff',borderRadius:12,padding:14,marginBottom:10}}>
<div style={{display:'flex',alignItems:'center',gap:12}}>
<div style={{width:45,height:45,borderRadius:10,background:'#e0f2f1',display:'flex',alignItems:'center',justifyContent:'center',fontSize:22}}>
{editGasto===i&&isViajeAdmin?(
<select value={g.icono} onChange={e=>updateGasto(i,'icono',e.target.value)} style={{width:40,border:'none',fontSize:20,background:'transparent',cursor:'pointer'}}>
<option value="üè†">üè†</option><option value="üöê">üöê</option><option value="‚úàÔ∏è">‚úàÔ∏è</option><option value="üçΩÔ∏è">üçΩÔ∏è</option><option value="‚õ≥">‚õ≥</option><option value="üíº">üíº</option><option value="üì¶">üì¶</option><option value="üéâ">üéâ</option><option value="üíä">üíä</option><option value="üéØ">üéØ</option><option value="üöï">üöï</option>
</select>
):g.icono}
</div>
<div style={{flex:1}}>
{editGasto===i&&isViajeAdmin?(
<div>
<input type="text" value={g.concepto} onChange={e=>updateGasto(i,'concepto',e.target.value)} style={{width:'100%',padding:6,border:'1px solid #00897b',borderRadius:4,marginBottom:4,fontSize:13,fontWeight:700}}/>
<input type="text" value={g.desc} onChange={e=>updateGasto(i,'desc',e.target.value)} style={{width:'100%',padding:4,border:'1px solid #ccc',borderRadius:4,fontSize:11}} placeholder="Descripci√≥n"/>
</div>
):(
<div onClick={()=>{if(isViajeAdmin)setEditGasto(i);}} style={{cursor:isViajeAdmin?'pointer':'default'}}>
<div style={{fontWeight:700,fontSize:14}}>{g.concepto}</div>
<div style={{fontSize:11,color:'#888',marginTop:2}}>{g.desc}</div>
</div>
)}
</div>
{editGasto===i&&isViajeAdmin?(
<div style={{display:'flex',flexDirection:'column',gap:4,alignItems:'flex-end'}}>
<input type="number" value={g.total} onChange={e=>updateGasto(i,'total',e.target.value)} style={{width:90,padding:6,border:'2px solid #00897b',borderRadius:6,fontSize:14,fontWeight:700,textAlign:'right'}}/>
<div style={{display:'flex',gap:4}}>
<button onClick={()=>{
const campo=camposFijos[i]?.key;
if(campo==='casa'){repartirCasa(g.total);}
else if(campo){repartirGastoIgual(campo,g.total);}
}} title={camposFijos[i]?.key==='casa'?'Repartir por habitaci√≥n':'Repartir a partes iguales'} style={{background:'#e0f2f1',color:'#00897b',border:'none',padding:'4px 8px',borderRadius:4,fontSize:10,cursor:'pointer',fontWeight:700}}>{camposFijos[i]?.key==='casa'?'üè† Por hab':'√∑ Iguales'}</button>
<button onClick={()=>setEditGasto(null)} style={{background:'#4caf50',color:'#fff',border:'none',padding:'4px 8px',borderRadius:4,fontSize:10,cursor:'pointer'}}>‚úì</button>
<button onClick={()=>{removeGasto(i);setEditGasto(null);}} style={{background:'#f44336',color:'#fff',border:'none',padding:'4px 8px',borderRadius:4,fontSize:10,cursor:'pointer'}}>üóë</button>
</div>
</div>
):(
<div style={{textAlign:'right'}} onClick={()=>{if(isViajeAdmin)setEditGasto(i);}}>
<div style={{fontWeight:700,color:'#00897b',fontSize:15,cursor:isViajeAdmin?'pointer':'default'}}>{g.total.toLocaleString('es-ES')} ‚Ç¨</div>
{isViajeAdmin&&<div style={{fontSize:9,color:'#aaa',marginTop:2}}>toca para editar</div>}
</div>
)}
</div>
</div>
))}
{showAddGasto&&isViajeAdmin&&(
<div style={{background:'#e8f5e9',borderRadius:12,padding:14,marginBottom:10,border:'2px dashed #00897b'}}>
<div style={{fontWeight:700,fontSize:13,marginBottom:10,color:'#00897b'}}>‚ûï Nuevo Gasto</div>
<div style={{display:'grid',gridTemplateColumns:'auto 1fr',gap:8,fontSize:12}}>
<span>Icono:</span>
<select value={nuevoGasto.icono} onChange={e=>setNuevoGasto({...nuevoGasto,icono:e.target.value})} style={{padding:6,borderRadius:4,border:'1px solid #ccc'}}>
<option value="üì¶">üì¶ Otros</option><option value="üè†">üè† Alojamiento</option><option value="‚úàÔ∏è">‚úàÔ∏è Transporte</option><option value="üçΩÔ∏è">üçΩÔ∏è Comida</option><option value="‚õ≥">‚õ≥ Golf</option><option value="üöê">üöê Veh√≠culo</option><option value="üéâ">üéâ Ocio</option><option value="üíä">üíä Salud</option>
</select>
<span>Concepto:</span>
<input type="text" value={nuevoGasto.concepto} onChange={e=>setNuevoGasto({...nuevoGasto,concepto:e.target.value})} placeholder="Nombre del gasto" style={{padding:6,borderRadius:4,border:'1px solid #ccc'}}/>
<span>Descripci√≥n:</span>
<input type="text" value={nuevoGasto.desc} onChange={e=>setNuevoGasto({...nuevoGasto,desc:e.target.value})} placeholder="Descripci√≥n breve" style={{padding:6,borderRadius:4,border:'1px solid #ccc'}}/>
<span>Importe:</span>
<input type="number" value={nuevoGasto.total||''} onChange={e=>setNuevoGasto({...nuevoGasto,total:parseFloat(e.target.value)||0})} placeholder="0" style={{padding:6,borderRadius:4,border:'1px solid #ccc'}}/>
</div>
<div style={{display:'flex',gap:10,marginTop:12}}>
<button onClick={()=>{addGasto();setShowAddGasto(false);}} style={{flex:1,background:'#00897b',color:'#fff',border:'none',padding:10,borderRadius:8,fontWeight:700,cursor:'pointer'}}>‚úì A√±adir</button>
<button onClick={()=>setShowAddGasto(false)} style={{flex:1,background:'#ccc',color:'#333',border:'none',padding:10,borderRadius:8,fontWeight:700,cursor:'pointer'}}>Cancelar</button>
</div>
</div>
)}
<div style={{background:'#00897b',borderRadius:12,padding:16,marginTop:10,display:'flex',justifyContent:'space-between',alignItems:'center',color:'#fff'}}>
<span style={{fontWeight:700,fontSize:15}}>TOTAL GASTOS</span>
<span style={{fontSize:24,fontWeight:700}}>{totalGastos.toLocaleString('es-ES')} ‚Ç¨</span>
</div>
{isViajeAdmin&&(
<button onClick={repartirTodoSegunReglas} style={{width:'100%',marginTop:10,background:'linear-gradient(135deg,#00897b,#26a69a)',border:'none',padding:14,borderRadius:10,color:'#fff',cursor:'pointer',fontSize:14,fontWeight:700,boxShadow:'0 2px 10px rgba(0,137,123,.3)'}}>
üîÑ RECALCULAR CUOTAS DE TODOS LOS VIAJEROS
<div style={{fontSize:10,fontWeight:400,marginTop:4,opacity:.9}}>Casa ‚Üí por habitaci√≥n ‚Ä¢ Resto ‚Üí a partes iguales</div>
</button>
)}
</div>

{/* SECCI√ìN REMANENTES - EFECTIVO EN CAJA */}
{viajeRemanentes&&viajeRemanentes.length>0&&(
<div className="sec" style={{paddingTop:0}}>
<div className="section-title" style={{marginBottom:10}}>üíµ Efectivo en Caja (Remanentes)</div>
{viajeRemanentes.map((rem,ri)=>{
const saldo=getRemanenteSaldo(rem);
const gastosRem=rem.gastos||[];
return(
<div key={ri} style={{background:'#fff',borderRadius:12,padding:14,marginBottom:10,border:saldo<0?'2px solid #f44336':'1px solid #e0e0e0'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:gastosRem.length>0?10:0}}>
<div>
<div style={{fontWeight:700,fontSize:14,color:'#1a472a'}}>{rem.concepto}</div>
<div style={{fontSize:11,color:'#888',marginTop:2}}>Importe original: {rem.cantidad.toLocaleString('es-ES')} ‚Ç¨</div>
</div>
<div style={{textAlign:'right'}}>
<div style={{fontWeight:700,fontSize:18,color:saldo<0?'#f44336':saldo>0?'#2e7d32':'#888'}}>{saldo.toLocaleString('es-ES',{minimumFractionDigits:2})} ‚Ç¨</div>
<div style={{fontSize:10,color:'#888'}}>saldo disponible</div>
</div>
</div>
{gastosRem.length>0&&(
<div style={{borderTop:'1px solid #eee',paddingTop:8,marginBottom:8}}>
<div style={{fontSize:11,color:'#888',marginBottom:6}}>Gastos realizados:</div>
{gastosRem.map((g,gi)=>(
<div key={gi} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'4px 0',fontSize:12}}>
<div style={{display:'flex',alignItems:'center',gap:6}}>
<span style={{color:'#e65100'}}>‚Ä¢</span>
<span>{g.concepto}</span>
{g.fecha&&<span style={{color:'#aaa',fontSize:10}}>({g.fecha})</span>}
</div>
<div style={{display:'flex',alignItems:'center',gap:6}}>
<span style={{color:'#f44336',fontWeight:600}}>-{g.cantidad.toLocaleString('es-ES',{minimumFractionDigits:2})} ‚Ç¨</span>
{isViajeAdmin&&<button onClick={()=>removeGastoRemanente(ri,gi)} style={{background:'#ffebee',border:'none',borderRadius:4,color:'#f44336',cursor:'pointer',fontSize:10,padding:'2px 5px'}}>√ó</button>}
</div>
</div>
))}
</div>
)}
{isViajeAdmin&&addGastoRemIdx===ri?(
<div style={{background:'#fff8e1',borderRadius:8,padding:10,marginTop:8,border:'1px dashed #ff9800'}}>
<div style={{fontSize:12,fontWeight:600,color:'#e65100',marginBottom:8}}>Nuevo gasto contra remanente</div>
<div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
<input type="text" value={nuevoGastoRem.concepto} onChange={e=>setNuevoGastoRem({...nuevoGastoRem,concepto:e.target.value})} placeholder="Concepto del gasto" style={{flex:2,minWidth:120,padding:8,borderRadius:6,border:'1px solid #ccc',fontSize:12}}/>
<input type="number" value={nuevoGastoRem.cantidad} onChange={e=>setNuevoGastoRem({...nuevoGastoRem,cantidad:e.target.value})} placeholder="Importe" style={{flex:1,minWidth:80,padding:8,borderRadius:6,border:'1px solid #ccc',fontSize:12,textAlign:'right'}}/>
</div>
<div style={{display:'flex',gap:8,marginTop:8}}>
<button onClick={()=>{addGastoRemanente(ri,nuevoGastoRem.concepto,nuevoGastoRem.cantidad);setNuevoGastoRem({concepto:'',cantidad:''});setAddGastoRemIdx(null);}} style={{flex:1,background:'#ff9800',color:'#fff',border:'none',padding:8,borderRadius:6,fontWeight:700,cursor:'pointer',fontSize:12}}>A√±adir</button>
<button onClick={()=>{setAddGastoRemIdx(null);setNuevoGastoRem({concepto:'',cantidad:''});}} style={{flex:1,background:'#eee',color:'#666',border:'none',padding:8,borderRadius:6,fontWeight:600,cursor:'pointer',fontSize:12}}>Cancelar</button>
</div>
</div>
):(
isViajeAdmin&&<button onClick={()=>setAddGastoRemIdx(ri)} style={{width:'100%',marginTop:8,background:'#fff8e1',border:'1px dashed #ff9800',padding:8,borderRadius:8,color:'#e65100',cursor:'pointer',fontSize:11,fontWeight:600}}>+ A√±adir gasto contra este remanente</button>
)}
</div>
);
})}
<div style={{background:'linear-gradient(135deg,#e65100,#ff9800)',borderRadius:12,padding:16,marginTop:10,display:'flex',justifyContent:'space-between',alignItems:'center',color:'#fff'}}>
<span style={{fontWeight:700,fontSize:14}}>TOTAL EFECTIVO EN CAJA</span>
<span style={{fontSize:22,fontWeight:700}}>{viajeRemanentes.reduce((s,r)=>s+getRemanenteSaldo(r),0).toLocaleString('es-ES',{minimumFractionDigits:2})} ‚Ç¨</span>
</div>
</div>
)}

{/* SECCI√ìN 2: DESGLOSE POR VIAJERO */}
<div className="sec" style={{paddingTop:0}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:5}}>
<div className="section-title" style={{margin:0}}>üë• Desglose por Viajero ({viajeViajeros.length})</div>
{isViajeAdmin&&<button onClick={()=>setShowAddExtra(true)} style={{background:'#00897b',color:'#fff',border:'none',padding:'5px 10px',borderRadius:8,fontSize:10,cursor:'pointer'}}>+ Gasto extra</button>}
</div>
<p style={{fontSize:11,color:'#888',marginBottom:12}}>{isViajeAdmin?'Toca cualquier cantidad para editarla':'Cada viajero con su parte proporcional'}</p>

{/* Formulario a√±adir gasto extra a todos los viajeros */}
{showAddExtra&&isViajeAdmin&&(
<div style={{background:'#e8f5e9',borderRadius:12,padding:14,marginBottom:12,border:'2px dashed #00897b'}}>
<div style={{fontWeight:700,fontSize:13,marginBottom:10,color:'#00897b'}}>‚ûï Nuevo gasto extra para todos los viajeros</div>
<div style={{display:'flex',gap:8,alignItems:'center'}}>
<select value={nuevoExtra.icono} onChange={e=>setNuevoExtra({...nuevoExtra,icono:e.target.value})} style={{padding:6,borderRadius:4,border:'1px solid #ccc',fontSize:16}}>
<option value="üì¶">üì¶</option><option value="üéâ">üéâ</option><option value="üç∫">üç∫</option><option value="üöï">üöï</option><option value="üíä">üíä</option><option value="üéØ">üéØ</option><option value="üõçÔ∏è">üõçÔ∏è</option>
</select>
<input type="text" value={nuevoExtra.concepto} onChange={e=>setNuevoExtra({...nuevoExtra,concepto:e.target.value})} placeholder="Nombre del gasto" style={{flex:1,padding:8,borderRadius:6,border:'1px solid #ccc',fontSize:13}}/>
</div>
<div style={{display:'flex',gap:8,marginTop:10}}>
<button onClick={()=>{if(nuevoExtra.concepto){addExtraToViajeros(nuevoExtra.concepto,nuevoExtra.icono);setNuevoExtra({concepto:'',icono:'üì¶'});setShowAddExtra(false);}}} style={{flex:1,background:'#00897b',color:'#fff',border:'none',padding:10,borderRadius:8,fontWeight:700,cursor:'pointer'}}>‚úì A√±adir a todos</button>
<button onClick={()=>setShowAddExtra(false)} style={{flex:1,background:'#ccc',color:'#333',border:'none',padding:10,borderRadius:8,fontWeight:700,cursor:'pointer'}}>Cancelar</button>
</div>
</div>
)}

{viajeViajeros.map((p,vi)=>{
const pendiente=(p.total||recalcViajeroTotal(p))-p.pagado;
const totalV=p.total||recalcViajeroTotal(p);
const pct=totalV>0?(p.pagado/totalV*100).toFixed(0):0;
const isEditing=editViajero===vi&&isViajeAdmin;
const extras=p.extras||[];
return(
<div key={vi} style={{background:'#fff',borderRadius:12,marginBottom:12,overflow:'hidden',border:pendiente<=0?'2px solid #4caf50':'none'}}>
<div style={{background:'linear-gradient(135deg,#00897b,#26a69a)',padding:12,color:'#fff',display:'flex',alignItems:'center',gap:10}}>
<div style={{width:38,height:38,borderRadius:'50%',background:'rgba(255,255,255,.2)',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:16}}>{p.nombre.charAt(0)}</div>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:15}}>{p.nombre}</div>
<div style={{fontSize:11,opacity:.9}}>Hab. {p.hab} ‚Ä¢ Total: {totalV.toLocaleString('es-ES')} ‚Ç¨</div>
</div>
<div style={{display:'flex',gap:6,alignItems:'center'}}>
{pendiente<=0&&<span style={{background:'#fff',color:'#4caf50',padding:'3px 8px',borderRadius:10,fontSize:10,fontWeight:700}}>‚úì PAGADO</span>}
{isViajeAdmin&&<button onClick={()=>setEditViajero(isEditing?null:vi)} style={{background:isEditing?'#fff':'rgba(255,255,255,.2)',color:isEditing?'#00897b':'#fff',border:'none',padding:'4px 10px',borderRadius:8,fontSize:11,cursor:'pointer',fontWeight:700}}>{isEditing?'‚úì Cerrar':'‚úèÔ∏è'}</button>}
</div>
</div>
<div style={{padding:14}}>
{/* Campos fijos */}
<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,fontSize:12,marginBottom:extras.length>0?8:12}}>
{camposFijos.map(cf=>(
<div key={cf.key} style={{background:isEditing?'#e0f2f1':'#f5f5f5',padding:10,borderRadius:8,transition:'background 0.2s'}}>
<div style={{color:'#888',fontSize:10}}>{cf.icono} {cf.label}</div>
{isEditing?(
<input type="number" value={p[cf.key]} onChange={e=>updateViajeroField(vi,cf.key,e.target.value)} style={{width:'100%',padding:4,border:'1px solid #00897b',borderRadius:4,fontSize:13,fontWeight:700,marginTop:2,background:'#fff'}} step="0.01"/>
):(
<div style={{fontWeight:700,marginTop:2}}>{(p[cf.key]||0).toLocaleString('es-ES')} ‚Ç¨</div>
)}
</div>
))}
</div>
{/* Gastos extras */}
{extras.length>0&&(
<div style={{marginBottom:12}}>
<div style={{fontSize:10,color:'#888',fontWeight:700,marginBottom:6}}>GASTOS EXTRA</div>
<div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,fontSize:12}}>
{extras.map((ex,ei)=>(
<div key={ei} style={{background:isEditing?'#fff3e0':'#f5f5f5',padding:10,borderRadius:8,position:'relative'}}>
<div style={{color:'#888',fontSize:10}}>{ex.icono} {ex.concepto}</div>
{isEditing?(
<div style={{display:'flex',alignItems:'center',gap:4,marginTop:2}}>
<input type="number" value={ex.cantidad} onChange={e=>updateViajeroExtra(vi,ei,e.target.value)} style={{width:'100%',padding:4,border:'1px solid #ff9800',borderRadius:4,fontSize:13,fontWeight:700,background:'#fff'}} step="0.01"/>
{vi===0&&<button onClick={()=>removeExtraFromViajeros(ei)} style={{background:'#f44336',color:'#fff',border:'none',borderRadius:4,padding:'2px 5px',fontSize:9,cursor:'pointer',whiteSpace:'nowrap'}}>üóë</button>}
</div>
):(
<div style={{fontWeight:700,marginTop:2}}>{(ex.cantidad||0).toLocaleString('es-ES')} ‚Ç¨</div>
)}
</div>
))}
</div>
</div>
)}
{/* Totales y pagos */}
<div style={{background:'#f0f0f0',borderRadius:8,padding:12}}>
<div style={{display:'flex',justifyContent:'space-between',marginBottom:8}}>
<span style={{fontWeight:700}}>Total a pagar:</span>
<span style={{fontWeight:700,fontSize:16}}>{totalV.toLocaleString('es-ES')} ‚Ç¨</span>
</div>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8}}>
<span style={{color:'#2e7d32',fontWeight:600}}>üí∞ Ya pagado:</span>
<div style={{display:'flex',alignItems:'center',gap:6}}>
<span style={{fontWeight:700,fontSize:16,color:'#2e7d32'}}>{p.pagado.toLocaleString('es-ES')} ‚Ç¨</span>
{isViajeAdmin&&<button onClick={()=>{
if(!(p.pagos&&p.pagos.length>0)&&p.pagado>0){migrarPagadoAPagos(vi);}
setAddPagoIdx(addPagoIdx===vi?null:vi);
setNuevoPago({cantidad:'',fecha:new Date().toISOString().split('T')[0],metodo:'transfer'});
}} style={{width:28,height:28,borderRadius:'50%',border:'2px solid #4caf50',background:addPagoIdx===vi?'#4caf50':'#fff',color:addPagoIdx===vi?'#fff':'#4caf50',fontSize:16,fontWeight:700,cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',lineHeight:1}}>+</button>}
</div>
</div>

{/* Formulario nuevo pago */}
{addPagoIdx===vi&&isViajeAdmin&&(
<div style={{background:'#e8f5e9',borderRadius:8,padding:12,marginBottom:8,border:'1px solid #a5d6a7'}}>
<div style={{fontSize:12,fontWeight:700,color:'#2e7d32',marginBottom:8}}>‚ûï Registrar nuevo pago</div>
<div style={{display:'flex',gap:6,marginBottom:8,alignItems:'center'}}>
<div style={{flex:1}}>
<div style={{fontSize:10,color:'#888',marginBottom:2}}>Cantidad ‚Ç¨</div>
<input type="number" value={nuevoPago.cantidad} onChange={e=>setNuevoPago({...nuevoPago,cantidad:e.target.value})} placeholder="0.00" style={{width:'100%',padding:8,border:'1px solid #a5d6a7',borderRadius:6,fontSize:15,fontWeight:700,textAlign:'right'}} step="0.01"/>
</div>
<div style={{flex:1}}>
<div style={{fontSize:10,color:'#888',marginBottom:2}}>Fecha</div>
<input type="date" value={nuevoPago.fecha} onChange={e=>setNuevoPago({...nuevoPago,fecha:e.target.value})} style={{width:'100%',padding:8,border:'1px solid #a5d6a7',borderRadius:6,fontSize:13}}/>
</div>
</div>
<div style={{display:'flex',gap:6,marginBottom:10}}>
<button onClick={()=>setNuevoPago({...nuevoPago,metodo:'cash'})} style={{flex:1,padding:10,borderRadius:8,border:nuevoPago.metodo==='cash'?'2px solid #ff9800':'2px solid #e0e0e0',background:nuevoPago.metodo==='cash'?'#fff3e0':'#fff',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:6}}>
<span style={{fontSize:20,fontWeight:700,color:'#ff9800'}}>$</span>
<span style={{fontSize:12,fontWeight:nuevoPago.metodo==='cash'?700:400,color:nuevoPago.metodo==='cash'?'#e65100':'#888'}}>Cash</span>
</button>
<button onClick={()=>setNuevoPago({...nuevoPago,metodo:'transfer'})} style={{flex:1,padding:10,borderRadius:8,border:nuevoPago.metodo==='transfer'?'2px solid #1976d2':'2px solid #e0e0e0',background:nuevoPago.metodo==='transfer'?'#e3f2fd':'#fff',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',gap:6}}>
<span style={{fontSize:18,fontWeight:700,color:'#1976d2'}}>T</span>
<span style={{fontSize:12,fontWeight:nuevoPago.metodo==='transfer'?700:400,color:nuevoPago.metodo==='transfer'?'#0d47a1':'#888'}}>Transferencia</span>
</button>
</div>
<div style={{display:'flex',gap:8}}>
<button onClick={()=>{addPagoViajero(vi,nuevoPago.cantidad,nuevoPago.fecha,nuevoPago.metodo);setAddPagoIdx(null);setNuevoPago({cantidad:'',fecha:new Date().toISOString().split('T')[0],metodo:'transfer'});}} disabled={!nuevoPago.cantidad||parseFloat(nuevoPago.cantidad)<=0} style={{flex:1,background:(!nuevoPago.cantidad||parseFloat(nuevoPago.cantidad)<=0)?'#ccc':'#4caf50',color:'#fff',border:'none',padding:10,borderRadius:8,fontWeight:700,cursor:'pointer',fontSize:13}}>‚úì Registrar pago</button>
<button onClick={()=>setAddPagoIdx(null)} style={{background:'#f5f5f5',color:'#888',border:'none',padding:10,borderRadius:8,cursor:'pointer',fontSize:13}}>‚úï</button>
</div>
</div>
)}

{/* Historial de pagos */}
{(p.pagos&&p.pagos.length>0)&&(
<div style={{marginBottom:8}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:4}}>
<span style={{fontSize:10,color:'#888',fontWeight:700}}>HISTORIAL DE PAGOS ({p.pagos.length})</span>
<button onClick={()=>setShowPagosIdx(showPagosIdx===vi?null:vi)} style={{background:'none',border:'none',color:'#00897b',fontSize:10,cursor:'pointer',fontWeight:700}}>{showPagosIdx===vi?'‚ñ≤ Ocultar':'‚ñº Ver detalle'}</button>
</div>
{showPagosIdx===vi&&p.pagos.map((pg,pi)=>(
<div key={pi} style={{display:'flex',alignItems:'center',gap:8,padding:'6px 8px',background:pi%2===0?'#f9f9f9':'#fff',borderRadius:6,marginBottom:2,fontSize:12}}>
<span style={{width:24,height:24,borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:14,fontWeight:700,background:pg.metodo==='cash'?'#fff3e0':'#e3f2fd',color:pg.metodo==='cash'?'#ff9800':'#1976d2'}}>{pg.metodo==='cash'?'$':'T'}</span>
<span style={{flex:1,fontWeight:600}}>{pg.cantidad.toLocaleString('es-ES')} ‚Ç¨</span>
<span style={{color:'#888',fontSize:11}}>{pg.fecha}</span>
{isViajeAdmin&&<button onClick={()=>removePagoViajero(vi,pi)} style={{background:'none',border:'none',color:'#e57373',fontSize:14,cursor:'pointer',padding:2}}>‚úï</button>}
</div>
))}
</div>
)}

<div style={{display:'flex',justifyContent:'space-between',paddingTop:8,borderTop:'2px dashed #ccc'}}>
<span style={{color:pendiente>0?'#c62828':'#2e7d32',fontWeight:700}}>üìã Pendiente:</span>
<span style={{fontWeight:700,fontSize:18,color:pendiente>0?'#c62828':'#2e7d32'}}>{pendiente>0?`${pendiente.toLocaleString('es-ES')} ‚Ç¨`:'‚úì Completo'}</span>
</div>
</div>
<div style={{marginTop:10,background:'#e0e0e0',borderRadius:10,height:8,overflow:'hidden'}}>
<div style={{width:`${Math.min(pct,100)}%`,height:'100%',background:pct>=100?'#4caf50':pct>=50?'#ff9800':'#f44336',borderRadius:10,transition:'width 0.3s'}}></div>
</div>
<div style={{textAlign:'center',fontSize:10,color:'#888',marginTop:4}}>{pct}% pagado</div>
</div>
</div>
);})}
</div>

{/* SECCI√ìN 3: RESUMEN TOTAL */}
<div className="sec" style={{paddingTop:0}}>
<div style={{background:'linear-gradient(135deg,#1a472a,#2d5a3f)',borderRadius:12,padding:20,color:'#fff'}}>
<div style={{fontSize:14,fontWeight:700,marginBottom:15,textAlign:'center'}}>üìä RESUMEN TOTAL DEL VIAJE</div>
<div style={{display:'flex',justifyContent:'space-between',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.2)'}}>
<span>Total gastos previstos</span>
<strong>{totalGastos.toLocaleString('es-ES')} ‚Ç¨</strong>
</div>
<div style={{display:'flex',justifyContent:'space-between',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.2)'}}>
<span>Total a pagar viajeros</span>
<strong>{totalViajeros.toLocaleString('es-ES')} ‚Ç¨</strong>
</div>
<div style={{display:'flex',justifyContent:'space-between',padding:'10px 0',borderBottom:'1px solid rgba(255,255,255,.2)',color:'#81c784'}}>
<span>‚úì Total ya pagado</span>
<strong>{totalPagado.toLocaleString('es-ES')} ‚Ç¨</strong>
</div>
<div style={{display:'flex',justifyContent:'space-between',padding:'15px 0',fontSize:20}}>
<span style={{color:'#ffcdd2'}}>üìã PENDIENTE TOTAL</span>
<strong style={{color:'#ffcdd2'}}>{totalPendiente.toLocaleString('es-ES')} ‚Ç¨</strong>
</div>
{viajeRemanentes&&viajeRemanentes.length>0&&(
<div style={{background:'rgba(255,255,255,.1)',borderRadius:8,padding:10,marginTop:10}}>
<div style={{fontSize:11,marginBottom:6}}>üíµ Remanentes (efectivo en caja):</div>
{viajeRemanentes.map((r,i)=>{
const saldo=getRemanenteSaldo(r);
const gastosTotal=(r.gastos||[]).reduce((s,g)=>s+g.cantidad,0);
return(
<div key={i} style={{marginBottom:i<viajeRemanentes.length-1?6:0}}>
<div style={{fontSize:12,display:'flex',justifyContent:'space-between'}}><span>{r.concepto}</span><span>+{r.cantidad.toLocaleString('es-ES')} ‚Ç¨</span></div>
{gastosTotal>0&&<div style={{fontSize:11,display:'flex',justifyContent:'space-between',color:'#ffcdd2',paddingLeft:10}}><span>Gastos realizados</span><span>-{gastosTotal.toLocaleString('es-ES',{minimumFractionDigits:2})} ‚Ç¨</span></div>}
{gastosTotal>0&&<div style={{fontSize:12,display:'flex',justifyContent:'space-between',fontWeight:600,paddingLeft:10,color:saldo>=0?'#a5d6a7':'#ffcdd2'}}><span>Saldo</span><span>{saldo.toLocaleString('es-ES',{minimumFractionDigits:2})} ‚Ç¨</span></div>}
</div>
);})}
<div style={{borderTop:'1px solid rgba(255,255,255,.2)',marginTop:8,paddingTop:8,display:'flex',justifyContent:'space-between',fontWeight:700,fontSize:13}}>
<span>Total efectivo disponible</span>
<span>{viajeRemanentes.reduce((s,r)=>s+getRemanenteSaldo(r),0).toLocaleString('es-ES',{minimumFractionDigits:2})} ‚Ç¨</span>
</div>
</div>
)}
</div>
{isViajeAdmin&&(<>
{cambiosPendientes&&(
<button onClick={guardarTodo} style={{width:'100%',marginTop:15,background:'linear-gradient(135deg,#4caf50,#2e7d32)',border:'none',padding:16,borderRadius:10,color:'#fff',cursor:'pointer',fontSize:16,fontWeight:700,boxShadow:'0 4px 15px rgba(76,175,80,.4)'}}>
üíæ GUARDAR CAMBIOS
</button>
)}
{!cambiosPendientes&&(
<div style={{width:'100%',marginTop:15,background:'#e8f5e9',border:'none',padding:14,borderRadius:10,color:'#2e7d32',textAlign:'center',fontSize:14}}>
‚úì Todos los cambios guardados
</div>
)}
<div style={{display:'flex',gap:10,marginTop:10}}>
<button onClick={exportarDatos} style={{flex:1,background:'#e3f2fd',border:'none',padding:12,borderRadius:8,color:'#1565c0',cursor:'pointer',fontSize:12}}>üì§ Exportar Backup</button>
<label style={{flex:1,background:'#fff3e0',border:'none',padding:12,borderRadius:8,color:'#e65100',cursor:'pointer',fontSize:12,textAlign:'center'}}>
üì• Importar Backup
<input type="file" accept=".json" onChange={importarDatos} style={{display:'none'}}/>
</label>
</div>
<button onClick={()=>salirConVerificacion('admin',()=>setIsViajeAdmin(false))} style={{width:'100%',marginTop:10,background:'#f5f5f5',border:'none',padding:12,borderRadius:8,color:'#888',cursor:'pointer'}}>üö™ Cerrar sesi√≥n admin viaje</button>
</>)}
</div>
</div>
);};

// Modal login viaje
const ViajeLoginModal=()=>{
const[pwd,setPwd]=useState('');
return(
<div className="modal-overlay" onClick={()=>setShowViajeLogin(false)}>
<div className="modal" onClick={e=>e.stopPropagation()}>
<div className="modal-hdr"><span className="modal-title">üîê Admin Viaje</span><button className="modal-close" onClick={()=>setShowViajeLogin(false)}>√ó</button></div>
<div className="modal-body">
<p style={{fontSize:13,color:'#666',marginBottom:15}}>Introduce la contrase√±a de administrador del viaje para editar pagos y gastos.</p>
<div className="form-group"><label className="form-label">Contrase√±a</label><input type="password" className="form-input" value={pwd} onChange={e=>setPwd(e.target.value)} placeholder="Contrase√±a admin viaje" onKeyDown={e=>e.key==='Enter'&&loginViaje(pwd)}/></div>
</div>
<div className="modal-footer"><button className="btn btn-pri" onClick={()=>loginViaje(pwd)}>Acceder</button></div>
</div>
</div>
);};

const ClasifScr=()=>{
const data=tab==='general'?CLASIF:CLASIF_LIV;
const clickJug=(nombre)=>{const j=jugadores.find(x=>x.nombre===nombre);if(j){setSelJug(j);setScr('jugador-detalle');}};
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>Clasificaci√≥n</h1></header>
<div className="tabs">
<button className={`tab ${tab==='general'?'active':''}`} onClick={()=>setTab('general')}>üèÜ General</button>
<button className={`tab ${tab==='liv'?'liv':''}`} onClick={()=>setTab('liv')}>‚ö° LIV</button>
</div>
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:10}}>üëÜ Toca un jugador para ver su historial{tab==='liv'?' LIV':''}</p>
{data.map(j=>(
<div key={j.nombre} className={`rank-item ${pc(j.pos)}`} onClick={()=>clickJug(j.nombre)}>
<div className={`rank-pos ${pc(j.pos)}`}>{j.pos}</div>
<div className="rank-info"><div className="rank-name">{j.nombre} {(()=>{const jg=jugadores.find(x=>x.nombre===j.nombre);if(!jg)return'';const hcpJ=jg.esR?Math.floor(jg.hcp):Math.ceil(jg.hcp);return`${jg.hcp} (${hcpJ})`;})()}</div></div>
<div className={`rank-total ${tab==='liv'?'liv':''}`}>{j.total}</div>
</div>
))}
</div>
</div>
);};

const JugadoresScr=()=>{
const getTotal=(n)=>{const j=CLASIF.find(x=>x.nombre===n);return j?j.total:0;};
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>Jugadores</h1></header>
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:10}}>üëÜ Toca para ver historial completo</p>
{jugadores.map(j=>(
<div key={j.id} className="card" onClick={()=>{setSelJug(j);setScr('jugador-detalle');}}>
<div style={{display:'flex',alignItems:'center'}}>
<div style={{width:40,height:40,borderRadius:'50%',background:'linear-gradient(135deg,var(--pri),var(--pri-l))',color:'#fff',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,marginRight:12}}>{j.nombre.charAt(0)}</div>
<div style={{flex:1}}><div style={{fontWeight:700}}>{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</div><div style={{fontSize:11,color:'#888'}}>{getTotal(j.nombre)} pts</div></div>
<span style={{color:'#888'}}>‚Üí</span>
</div>
</div>
))}
</div>
</div>
);};

const JugadorDetalleScr=()=>{
const[dtab,setDtab]=useState('general');
if(!selJug)return null;
const cg=CLASIF.find(x=>x.nombre===selJug.nombre)||{};
const cl=CLASIF_LIV.find(x=>x.nombre===selJug.nombre)||{};
const pruebasJug=PRUEBAS_HIST.filter(p=>p.res.some(r=>r.nombre===selJug.nombre)).length;
const historial=PRUEBAS_HIST.map(p=>{const r=p.res.find(x=>x.nombre===selJug.nombre);const pos=r?p.res.findIndex(x=>x.nombre===selJug.nombre)+1:null;return{...p,participo:!!r,pos,stb:r?.stb||0,pts:r?.pts||'0'};}).reverse();
const livHist=getLIVHist(selJug.nombre);
const hcpJuego=selJug.esR?Math.floor(selJug.hcp):Math.ceil(selJug.hcp);
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('jugadores')}>‚Üê</button><h1>{selJug.nombre}</h1></header>
<div className="jug-header">
<div className="jug-avatar">{selJug.nombre.charAt(0)}</div>
<div className="jug-nombre">{selJug.nombre}</div>
<div className="jug-hcp">Handicap {selJug.esR?'+':''}{selJug.hcp} ‚Ä¢ Juega con {selJug.esR?'+':''}{hcpJuego}</div>
</div>
<div className="stats-grid">
<div className="stat-item"><div className="stat-value">{cg.pos||'-'}¬∫</div><div className="stat-label">Pos. General</div></div>
<div className="stat-item"><div className="stat-value">{cg.total||0}</div><div className="stat-label">Puntos</div></div>
<div className="stat-item"><div className="stat-value liv">{cl.pos||'-'}¬∫</div><div className="stat-label">Pos. LIV</div></div>
</div>
<div className="tabs" style={{marginTop:20}}>
<button className={`tab ${dtab==='general'?'active':''}`} onClick={()=>setDtab('general')}>üèÜ Individual</button>
<button className={`tab ${dtab==='liv'?'liv':''}`} onClick={()=>setDtab('liv')}>‚ö° Historial LIV</button>
</div>
<div className="sec">
{dtab==='general'?(<>
<div className="section-title">üìä Historial Individual ({pruebasJug} pruebas)</div>
{historial.map(h=>{const fecha=new Date(h.fecha);const posC=h.pos===1?'p1':h.pos===2?'p2':h.pos===3?'p3':'def';return(
<div key={h.id} className={`hist-item ${!h.participo?'no-part':''}`}>
<div className="hist-fecha"><div className="hist-dia">{fecha.getDate()}</div><div className="hist-mes">{fecha.toLocaleDateString('es-ES',{month:'short'})}</div></div>
<div className="hist-info"><div className="hist-nombre">{h.nombre}</div><div className="hist-campo">{h.campo}</div></div>
<div className="hist-res">{h.participo?(<><div className={`hist-pos ${posC}`}>{h.pos}¬∫</div><div className="hist-pts"><span className="hist-stb">{h.stb} stb</span> ‚Ä¢ {h.pts}</div></>):(<div style={{color:'#999',fontSize:12}}>No particip√≥</div>)}</div>
</div>);})}
</>):(<>
<div className="section-title">‚ö° Puntos LIV por Prueba ({livHist.length})</div>
{livHist.length===0?<div className="empty-state"><div className="empty-icon">‚ö°</div><p>Sin participaciones LIV</p></div>:livHist.map((h,i)=>(
<div key={i} className="liv-hist-item">
<div className="liv-hist-prueba">
<div className="liv-hist-name">{h.prueba}</div>
<div className="liv-hist-date">{new Date(h.fecha).toLocaleDateString('es-ES',{day:'numeric',month:'short'})}</div>
<div className="liv-hist-team">Con: {h.equipo.filter(x=>x!==selJug.nombre).join(', ')} = {h.total}</div>
</div>
<div className="liv-hist-pts">
<div className="liv-hist-pos">{h.pos}¬∫ puesto</div>
<div className="liv-hist-val">+{h.ptsLIV}</div>
</div>
</div>
))}
<div style={{background:'#fff',borderRadius:12,padding:15,marginTop:10}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<div style={{fontWeight:700}}>Total LIV</div>
<div style={{fontSize:28,fontWeight:700,color:'var(--danger)'}}>{cl.total||0}</div>
</div>
</div>
</>)}
</div>
</div>
);};

const HistoricoScr=()=>(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>Hist√≥rico</h1></header>
<div className="sec">
{PRUEBAS_HIST.slice().reverse().map(p=>{const gan=p.res[0];return(
<div key={p.id} className="prueba-card" onClick={()=>{setSelPr(p);setScr('detalle');}}>
<div className="prueba-hdr"><span className="prueba-name">{p.nombre}</span><span style={{fontSize:11}}>{new Date(p.fecha).toLocaleDateString('es-ES',{day:'numeric',month:'short'})}</span></div>
<div className="prueba-winner"><span style={{fontSize:24}}>ü•á</span><div><div className="winner-name">{gan.nombre}</div><div style={{fontSize:12,color:'#888'}}>{gan.stb} stb ‚Ä¢ {gan.pts}</div></div></div>
</div>
);})}
</div>
</div>
);

const StatsScr=()=>{
const[stab,setStab]=useState('media');
// Calcular estad√≠sticas para cada jugador
// Usar JUG_INI como base para garantizar que est√°n los 13 jugadores
const statsData=useMemo(()=>{
const es9h=(p)=>p.nombre.includes('9 hoyos');
return JUG_INI.map(j=>{
let totalStb=0,count=0,mejor=0,peor=999,victorias=0;
PRUEBAS_HIST.forEach(p=>{
const r=p.res.find(x=>x.nombre===j.nombre);
if(r){
const stbAdj=es9h(p)?r.stb*2:r.stb;
totalStb+=stbAdj;count++;
if(stbAdj>mejor)mejor=stbAdj;
if(stbAdj<peor)peor=stbAdj;
if(p.res[0].nombre===j.nombre)victorias++;
}
});
const media=count>0?(totalStb/count):0;
const cg=CLASIF.find(x=>x.nombre===j.nombre)||{pos:99,total:0};
const cl=CLASIF_LIV.find(x=>x.nombre===j.nombre)||{pos:99,total:0};
const hcpJuego=j.esR?Math.floor(j.hcp):Math.ceil(j.hcp);
return{...j,media:Math.round(media*10)/10,count,mejor,peor:peor===999?0:peor,victorias,ptsGen:cg.total,posGen:cg.pos,ptsLiv:cl.total,posLiv:cl.pos,hcpJuego};
}).filter(j=>j.count>0);
},[]); // JUG_INI es constante, no necesita dependencia
// Calcular probabilidades
const probData=useMemo(()=>{
const maxPtsGen=Math.max(...statsData.map(j=>j.ptsGen),1);
const maxPtsLiv=Math.max(...statsData.map(j=>j.ptsLiv),1);
const maxMedia=Math.max(...statsData.map(j=>j.media),1);
const maxHcp=21;
// Scores brutos
const withScores=statsData.map(j=>{
const fPos=j.ptsGen/maxPtsGen;
const fForma=j.media/36;
const fHcp=1-(j.hcpJuego/maxHcp);
const scoreGen=0.45*fPos+0.30*fForma+0.25*Math.max(0,fHcp);
const fPosLiv=j.ptsLiv/maxPtsLiv;
const scoreLiv=0.45*fPosLiv+0.30*fForma+0.25*Math.max(0,fHcp);
return{...j,scoreGen,scoreLiv};
});
const totalGen=withScores.reduce((s,j)=>s+j.scoreGen,0)||1;
const totalLiv=withScores.reduce((s,j)=>s+j.scoreLiv,0)||1;
return withScores.map(j=>({
...j,
probGen:Math.round(j.scoreGen/totalGen*1000)/10,
probLiv:Math.round(j.scoreLiv/totalLiv*1000)/10
}));
},[statsData]);
const byMedia=[...statsData].sort((a,b)=>b.media-a.media);
const byProbGen=[...probData].sort((a,b)=>b.probGen-a.probGen);
const byProbLiv=[...probData].sort((a,b)=>b.probLiv-a.probLiv);
const topMedia=byMedia[0]?.media||0;
const topProbGen=byProbGen[0]?.probGen||0;
const topProbLiv=byProbLiv[0]?.probLiv||0;
return(
<div className="scroll">
<header className="hdr" style={{background:'linear-gradient(135deg,#6a1b9a,#9c27b0)'}}><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>üìà Estad√≠sticas</h1></header>
<div className="tabs">
<button className={`tab ${stab==='media'?'active':''}`} style={stab==='media'?{background:'#6a1b9a',color:'#fff'}:{}} onClick={()=>setStab('media')}>‚õ≥ Media Stb</button>
<button className={`tab ${stab==='prob'?'active':''}`} style={stab==='prob'?{background:'var(--pri)',color:'#fff'}:{}} onClick={()=>setStab('prob')}>üèÜ Prob. Maniac</button>
<button className={`tab ${stab==='probliv'?'active':''}`} style={stab==='probliv'?{background:'var(--danger)',color:'#fff'}:{}} onClick={()=>setStab('probliv')}>‚ö° Prob. LIV</button>
</div>
{stab==='media'&&(
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:12}}>Media de puntuaci√≥n Stableford por jugador (Marbella 9h √ó2)</p>
{byMedia.map((j,i)=>{
const pct=topMedia>0?(j.media/topMedia*100):0;
return(
<div key={j.id} style={{background:i===0?'linear-gradient(135deg,#f3e5f9,#fff)':'#fff',borderRadius:12,padding:14,marginBottom:10,borderLeft:i<3?`4px solid ${['#c9a227','#a8a8a8','#cd7f32'][i]}`:'4px solid transparent'}}>
<div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
<div style={{width:28,height:28,borderRadius:'50%',background:i===0?'#c9a227':i===1?'#a8a8a8':i===2?'#cd7f32':'#e0e0e0',color:i<3?'#fff':'#666',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:12}}>{i+1}</div>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:14}}>{j.nombre} <span style={{fontWeight:400,fontSize:12,color:'#888'}}>{j.hcp} ({j.hcpJuego})</span></div>
<div style={{fontSize:11,color:'#888'}}>{j.count} pruebas ‚Ä¢ {j.victorias>0?`${j.victorias} victoria${j.victorias>1?'s':''}`:''}</div>
</div>
<div style={{textAlign:'right'}}>
<div style={{fontSize:22,fontWeight:700,color:'#6a1b9a'}}>{j.media}</div>
<div style={{fontSize:10,color:'#888'}}>media stb</div>
</div>
</div>
<div style={{background:'#f0f0f0',borderRadius:6,height:6,overflow:'hidden',marginBottom:6}}>
<div style={{width:`${pct}%`,height:'100%',background:'linear-gradient(90deg,#6a1b9a,#9c27b0)',borderRadius:6}}></div>
</div>
<div style={{display:'flex',justifyContent:'space-between',fontSize:11,color:'#888'}}>
<span>Mejor: <strong style={{color:'#2e7d32'}}>{j.mejor}</strong></span>
<span>Peor: <strong style={{color:'#c62828'}}>{j.peor}</strong></span>
<span>Rango: <strong>{j.mejor-j.peor}</strong></span>
</div>
</div>
);})}
</div>
)}
{stab==='prob'&&(
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:6}}>Probabilidad de ganar el Maniac Tour 2025-26</p>
<p style={{fontSize:10,color:'#aaa',marginBottom:12}}>Basado en: puntos acumulados (45%) + forma/media stb (30%) + handicap (25%)</p>
{byProbGen.map((j,i)=>(
<div key={j.id} style={{background:i===0?'linear-gradient(135deg,#e8f5e9,#fff)':'#fff',borderRadius:12,padding:14,marginBottom:10,borderLeft:i<3?`4px solid ${['#c9a227','#a8a8a8','#cd7f32'][i]}`:'4px solid transparent'}}>
<div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
<div style={{width:28,height:28,borderRadius:'50%',background:i===0?'#c9a227':i===1?'#a8a8a8':i===2?'#cd7f32':'#e0e0e0',color:i<3?'#fff':'#666',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:12}}>{i+1}</div>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:14}}>{j.nombre} <span style={{fontWeight:400,fontSize:12,color:'#888'}}>{j.hcp} ({j.hcpJuego})</span></div>
<div style={{fontSize:11,color:'#888'}}>#{j.posGen} clasificaci√≥n ‚Ä¢ {j.ptsGen} pts</div>
</div>
<div style={{textAlign:'right'}}>
<div style={{fontSize:22,fontWeight:700,color:'var(--pri)'}}>{j.probGen}%</div>
</div>
</div>
<div style={{background:'#f0f0f0',borderRadius:6,height:8,overflow:'hidden'}}>
<div style={{width:`${j.probGen/topProbGen*100}%`,height:'100%',background:'linear-gradient(90deg,var(--pri),var(--pri-l))',borderRadius:6}}></div>
</div>
</div>
))}
</div>
)}
{stab==='probliv'&&(
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:6}}>Probabilidad de ganar el LIV Maniac 2025-26</p>
<p style={{fontSize:10,color:'#aaa',marginBottom:12}}>Basado en: puntos LIV acumulados (45%) + forma/media stb (30%) + handicap (25%)</p>
{byProbLiv.map((j,i)=>(
<div key={j.id} style={{background:i===0?'linear-gradient(135deg,#ffebee,#fff)':'#fff',borderRadius:12,padding:14,marginBottom:10,borderLeft:i<3?`4px solid ${['#c9a227','#a8a8a8','#cd7f32'][i]}`:'4px solid transparent'}}>
<div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
<div style={{width:28,height:28,borderRadius:'50%',background:i===0?'#c9a227':i===1?'#a8a8a8':i===2?'#cd7f32':'#e0e0e0',color:i<3?'#fff':'#666',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:12}}>{i+1}</div>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:14}}>{j.nombre} <span style={{fontWeight:400,fontSize:12,color:'#888'}}>{j.hcp} ({j.hcpJuego})</span></div>
<div style={{fontSize:11,color:'var(--danger)'}}>#{j.posLiv} LIV ‚Ä¢ {j.ptsLiv} pts</div>
</div>
<div style={{textAlign:'right'}}>
<div style={{fontSize:22,fontWeight:700,color:'var(--danger)'}}>{j.probLiv}%</div>
</div>
</div>
<div style={{background:'#f0f0f0',borderRadius:6,height:8,overflow:'hidden'}}>
<div style={{width:`${j.probLiv/topProbLiv*100}%`,height:'100%',background:'linear-gradient(90deg,var(--danger),#ef5350)',borderRadius:6}}></div>
</div>
</div>
))}
</div>
)}
</div>
);
};

const DetalleScr=()=>{
const[dtab,setDtab]=useState('ind');
if(!selPr)return null;
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('historico')}>‚Üê</button><h1>{selPr.nombre}</h1></header>
<div className="detail-hdr"><div className="detail-name">{selPr.nombre}</div><div className="detail-campo">{selPr.campo}</div><div className="detail-date">{new Date(selPr.fecha).toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long'})}</div></div>
<div className="tabs">
<button className={`tab ${dtab==='ind'?'active':''}`} onClick={()=>setDtab('ind')}>üèÜ Individual</button>
<button className={`tab ${dtab==='liv'?'liv':''}`} onClick={()=>setDtab('liv')}>‚ö° LIV</button>
</div>
<div className="sec">
{dtab==='ind'?<div style={{background:'#fff',borderRadius:12,overflow:'hidden'}}>{selPr.res.map((r,i)=>(
<div key={r.nombre} className="resultado-row"><span className={`resultado-pos ${i<3?'p'+(i+1):''}`}>{i+1}¬∫</span><span className="resultado-name">{r.nombre}</span><span className="resultado-stb">{r.stb}</span><span className="resultado-pts">{r.pts}</span></div>
))}</div>:selPr.liv.map((eq,i)=>(
<div key={i} className={`equipo-card ${i===0?'gold':''}`}><div className="equipo-hdr"><span style={{fontWeight:700}}>{eq.pos}¬∫</span><span className="equipo-pts-liv">+{eq.pLIV} pts</span></div><div style={{fontSize:14,color:'#666'}}>{eq.jug.map((j,idx)=>`${j} (${eq.pts[idx]})`).join(' + ')} = <strong>{eq.tot}</strong></div></div>
))}
</div>
</div>
);};

const LiveScr=()=>{
if(!liveOn||!pruebaActiva||!partidaActiva)return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>En Vivo</h1></header>
<div className="empty-state"><div className="empty-icon">üì∫</div><p>No hay prueba en directo</p><p style={{fontSize:12,marginTop:5}}>Cuando un admin de partida comience, aparecer√° aqu√≠</p></div>
</div>
);
const pr=getPrueba(pruebaActiva.id);
return(
<div className="scroll">
<header className="hdr" style={{background:'linear-gradient(135deg,var(--danger),#b71c1c)'}}><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><div><h1>{pr?.nombre}</h1><p>Hoyo {hole}</p></div><span className="live-dot"></span></header>
<div className="sec">
<div className="lb"><div className="lb-hdr"><span className="lb-title"><span className="live-dot"></span> LEADERBOARD GLOBAL</span><span style={{fontSize:10,opacity:.7}}>{lbGlobal.length} jugadores</span></div>
{lbGlobal.length>0?lbGlobal.map((j,i)=>{
const esDeEstaPartida=partidaActiva?.jug?.find(x=>x.id===j.id);
return(<div key={j.id} className="lb-row" style={{background:esDeEstaPartida?'rgba(198,40,40,0.1)':'transparent'}}><span className={`lb-pos ${i<3?'p'+(i+1):''}`}>{i+1}</span><span className="lb-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)}){esDeEstaPartida&&<span style={{marginLeft:4,fontSize:10}}>‚óè</span>}</span><span className="lb-thru">Thru {j.hoyosJugados||'-'}</span><span className="lb-score">{j.totalPts}</span></div>);
}):<div className="lb-row" style={{justifyContent:'center',color:'#888'}}>Esperando datos...</div>}
</div>
</div>
</div>
);};

// ADMIN SCREENS
const AdminScr=()=>(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setScr('home')}>‚Üê</button><h1>Administraci√≥n</h1><span className="admin-tag">ADMIN</span></header>
<div className="sec">
<div className="section-title">üìã Gesti√≥n de Pruebas</div>
<div className="admin-menu-item" onClick={()=>setAdmScr('jugadores')}><div className="admin-menu-icon" style={{background:'#9c27b015'}}>‚úèÔ∏è</div><div className="admin-menu-info"><div className="admin-menu-title">Editar Jugadores</div><div className="admin-menu-desc">Modificar nombre y handicap</div></div><span>‚Üí</span></div>
<div className="admin-menu-item" onClick={()=>setAdmScr('inscritos')}><div className="admin-menu-icon" style={{background:'#1a472a15'}}>üë•</div><div className="admin-menu-info"><div className="admin-menu-title">Inscribir Jugadores</div><div className="admin-menu-desc">Registrar en pr√≥ximas pruebas</div></div><span>‚Üí</span></div>
<div className="admin-menu-item" onClick={()=>setAdmScr('partidas')}><div className="admin-menu-icon" style={{background:'#2196f315'}}>üéØ</div><div className="admin-menu-info"><div className="admin-menu-title">Organizar Partidas</div><div className="admin-menu-desc">Crear grupos y asignar admin</div></div><span>‚Üí</span></div>
<div className="admin-menu-item" onClick={()=>setAdmScr('liv')}><div className="admin-menu-icon" style={{background:'#c6282815'}}>‚ö°</div><div className="admin-menu-info"><div className="admin-menu-title">Equipos LIV</div><div className="admin-menu-desc">Formar parejas LIV</div></div><span>‚Üí</span></div>
<div className="admin-menu-item" onClick={()=>setAdmScr('ryder')}><div className="admin-menu-icon" style={{background:'#ff980015'}}>üèÜ</div><div className="admin-menu-info"><div className="admin-menu-title">Ryder Cup</div><div className="admin-menu-desc">Gestionar equipos y partidos</div></div><span>‚Üí</span></div>
<div className="admin-menu-item" onClick={()=>setAdmScr('editscores')}><div className="admin-menu-icon" style={{background:'#e91e6315'}}>üìù</div><div className="admin-menu-info"><div className="admin-menu-title">Editar Puntuaciones</div><div className="admin-menu-desc">Corregir datos de partidas</div></div><span>‚Üí</span></div>
<div className="admin-menu-item" onClick={()=>setAdmScr('campos')}><div className="admin-menu-icon" style={{background:'#4caf5015'}}>‚õ≥</div><div className="admin-menu-info"><div className="admin-menu-title">Asignar Campos</div><div className="admin-menu-desc">Elegir campos para pruebas</div></div><span>‚Üí</span></div>
</div>
<div className="sec">
<div style={{background:'#fff3e0',borderRadius:12,padding:14,marginBottom:15}}>
<div style={{fontSize:12,color:'#e65100',marginBottom:8}}>üíæ <strong>Datos Guardados</strong></div>
<p style={{fontSize:11,color:'#666',marginBottom:10}}>Los datos se guardan autom√°ticamente en tu navegador.</p>
<button className="btn btn-sec" style={{fontSize:12}} onClick={()=>mostrarConfirm('¬øBorrar TODOS los datos guardados y volver a los valores iniciales?',()=>{localStorage.clear();location.reload();})}>üóëÔ∏è Restablecer Datos</button>
</div>
<button className="btn btn-sec" onClick={()=>{setIsAdmin(false);setScr('home');}}>üö™ Cerrar Sesi√≥n</button>
</div>
</div>
);

const AdminInsScr=()=>{
const prs=cal.filter(p=>!p.done);
const formatFecha=(f)=>{const d=new Date(f);return d.toLocaleDateString('es-ES',{day:'numeric',month:'short'});};
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setAdmScr(null)}>‚Üê</button><h1>Inscribir Jugadores</h1></header>
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:15}}>üìÖ Calendario completo de pruebas</p>
{prs.map(p=>{
const iconoTipo=p.esRyder?'üèÜ':p.esFinal?'ü•á':p.esDoble?'üìç':'‚õ≥';
const colorFondo=p.esRyder?'#fff3e0':p.esFinal?'#e8f5e9':'#fff';
return(
<div key={p.id} className="card" style={{background:colorFondo}} onClick={()=>{setSelPrueba(p);setAdmScr('conf-ins');}}>
<div style={{display:'flex',alignItems:'center',gap:12}}>
<div style={{minWidth:50,textAlign:'center'}}>
<div style={{fontSize:18,fontWeight:700,color:'var(--pri)'}}>{new Date(p.fecha).getDate()}</div>
<div style={{fontSize:10,color:'#888',textTransform:'uppercase'}}>{new Date(p.fecha).toLocaleDateString('es-ES',{month:'short'})}</div>
</div>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:14}}>{iconoTipo} {p.nombre}</div>
<div style={{fontSize:11,color:'#888',marginTop:2}}>{(p.ins||[]).length} inscritos ‚Ä¢ {CAMPOS.find(c=>c.id===p.campoId)?.nombre||'Por confirmar'}</div>
</div>
<span style={{color:'#888'}}>‚Üí</span>
</div>
</div>
);})}
</div>
</div>
);};

const ConfInsScr=()=>{
const pr=selPrueba?getPrueba(selPrueba.id):null;
if(!pr)return null;
const ins=pr.ins||[];
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>{setSelPrueba(null);setAdmScr('inscritos');}}>‚Üê</button><div><h1>{pr.nombre}</h1><p>Inscripciones</p></div></header>
<div className="sec">
<div className="section-title">‚úÖ Inscritos ({ins.length})</div>
{ins.length===0?<p style={{color:'#888',fontSize:13,marginBottom:15}}>No hay jugadores inscritos</p>:ins.map(j=>(
<div key={j.id} className="inscrito-row">
<div className="inscrito-avatar">{j.nombre.charAt(0)}</div>
<span className="inscrito-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</span>
<span className="inscrito-remove" onClick={()=>remIns(pr.id,j.id)}>‚úï</span>
</div>
))}
<div className="section-title" style={{marginTop:20}}>‚ûï A√±adir Jugadores</div>
{jugadores.filter(j=>!ins.find(i=>i.id===j.id)).map(j=>(
<div key={j.id} className="checkbox-item" onClick={()=>addIns(pr.id,j)}>
<div className="checkbox">+</div>
<div style={{flex:1}}><div style={{fontWeight:700}}>{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</div></div>
</div>
))}
</div>
</div>
);};

const AdminPartScr=()=>{
const prs=cal.filter(p=>!p.done&&(p.ins||[]).length>0);
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setAdmScr(null)}>‚Üê</button><h1>Organizar Partidas</h1></header>
<div className="sec">
{!prs.length?<div className="empty-state"><div className="empty-icon">üéØ</div><p>Primero inscribe jugadores</p></div>:prs.map(p=>(
<div key={p.id} className="card" onClick={()=>{setSelPrueba(p);setAdmScr('conf-part');}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<div><div style={{fontWeight:700}}>{p.nombre}</div><div style={{fontSize:11,color:'#888'}}>{(p.grp||[]).length} grupos ‚Ä¢ {(p.ins||[]).length} jugadores</div></div>
<span>‚Üí</span>
</div>
</div>
))}
</div>
</div>
);};

const ConfPartScr=()=>{
const pr=selPrueba?getPrueba(selPrueba.id):null;
if(!pr)return null;
const grupos=pr.grp||[];const ins=pr.ins||[];
const asig=grupos.flatMap(g=>g.jug.map(j=>j.id));const sinA=ins.filter(j=>!asig.includes(j.id));
const prIdx=cal.findIndex(p=>p.id===pr.id);
const esPrimera=prIdx===0;
const tipoGen=pr.esFinal?'Por Clasificaci√≥n':esPrimera?'Aleatorio':'Aleatorio (evita repetir)';
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>{setSelPrueba(null);setAdmScr('partidas');}}>‚Üê</button><div><h1>{pr.nombre}</h1><p>Partidas</p></div></header>
<div className="sec">
<div style={{background:'#e3f2fd',borderRadius:10,padding:12,marginBottom:15}}>
<div style={{fontSize:12,color:'#1565c0',marginBottom:8}}>üé≤ <strong>Sugerencia Autom√°tica</strong></div>
<p style={{fontSize:11,color:'#666',marginBottom:10}}>Modo: {tipoGen}</p>
<button className="btn btn-pri" onClick={()=>generarPartidasAleatorias(pr.id)}>‚ú® Generar Partidas Sugeridas</button>
</div>
<button className="btn btn-pri" style={{marginBottom:15}} onClick={()=>addGrp(pr.id)}>+ Nuevo Grupo</button>
{grupos.map((g,idx)=>{
const admin=g.adminId?g.jug.find(j=>j.id===g.adminId):null;
return(
<div key={g.id} className={`grupo-card ${admin?'has-admin':''}`}>
<div className="grupo-title">
<span>‚õ≥ Grupo {idx+1}</span>
<span style={{marginLeft:'auto',color:'#c62828',cursor:'pointer',fontSize:12}} onClick={()=>remGrp(pr.id,g.id)}>Eliminar</span>
</div>
{g.code&&<div className="grupo-admin">
<div style={{marginBottom:5}}>üì± <strong>C√≥digo de acceso:</strong><span className="grupo-admin-code">{g.code}</span></div>
{admin?<div>üë§ Admin: <strong>{admin.nombre}</strong></div>:<div style={{color:'#888'}}>Sin admin asignado (selecciona uno abajo)</div>}
</div>}
<div className="grupo-jugadores">
{g.jug.map(j=>(
<div key={j.id} className={`jugador-chip ${g.adminId===j.id?'is-admin':''}`}>
{g.adminId===j.id&&'üë§ '}{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})
<span className="remove" onClick={()=>remJG(pr.id,g.id,j.id)}>√ó</span>
</div>
))}
{g.jug.length<4&&sinA.length>0&&<select className="form-select" style={{width:'auto',padding:'6px 10px',fontSize:12}} onChange={e=>{const jug=ins.find(j=>j.id===e.target.value);if(jug)addJG(pr.id,g.id,jug);e.target.value='';}}><option value="">+ A√±adir</option>{sinA.map(j=><option key={j.id} value={j.id}>{j.nombre}</option>)}</select>}
</div>
{g.jug.length>0&&!admin&&<div style={{marginTop:10}}>
<select className="form-select" style={{fontSize:12}} onChange={e=>{if(e.target.value)setGrpAdmin(pr.id,g.id,e.target.value);e.target.value='';}}>
<option value="">üë§ Seleccionar Admin de Partida...</option>
{g.jug.map(j=><option key={j.id} value={j.id}>{j.nombre}</option>)}
</select>
</div>}
</div>
);})}
{sinA.length>0&&<><div className="section-title" style={{marginTop:20}}>Sin asignar ({sinA.length})</div>{sinA.map(j=><div key={j.id} className="inscrito-row"><div className="inscrito-avatar">{j.nombre.charAt(0)}</div><span className="inscrito-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</span></div>)}</>}
</div>
</div>
);};

const AdminLIVScr=()=>{
const prs=cal.filter(p=>!p.done&&(p.ins||[]).length>0&&!p.esRyder);
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setAdmScr(null)}>‚Üê</button><h1>Equipos LIV</h1></header>
<div className="sec">
{!prs.length?<div className="empty-state"><div className="empty-icon">‚ö°</div><p>Primero inscribe jugadores</p></div>:prs.map(p=>(
<div key={p.id} className="card" onClick={()=>{setSelPrueba(p);setAdmScr('conf-liv');}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<div><div style={{fontWeight:700}}>{p.nombre}</div><div style={{fontSize:11,color:'var(--danger)'}}>{(p.eqLIV||[]).length} equipos LIV</div></div>
<span>‚Üí</span>
</div>
</div>
))}
</div>
</div>
);};

const AdminRyderScr=()=>{
const ryder=cal.find(p=>p.esRyder);
if(!ryder)return(<div className="scroll"><header className="hdr"><button className="hdr-back" onClick={()=>setAdmScr(null)}>‚Üê</button><h1>Ryder Cup</h1></header><div className="empty-state"><div className="empty-icon">üèÜ</div><p>No hay Ryder Cup configurada</p></div></div>);
const ins=ryder.ins||[];
const eqA=ryder.equipoA||{nombre:'Equipo A',jug:[],parejas:[]};
const eqB=ryder.equipoB||{nombre:'Equipo B',jug:[],parejas:[]};
const partidos=ryder.partidos||[];
const ptsA=partidos.filter(p=>p.resultado==='A').length;
const ptsB=partidos.filter(p=>p.resultado==='B').length;
const empates=partidos.filter(p=>p.resultado==='E').length;
return(
<div className="scroll">
<header className="hdr" style={{background:'linear-gradient(135deg,#ff9800,#f57c00)'}}><button className="hdr-back" onClick={()=>setAdmScr(null)}>‚Üê</button><h1>üèÜ Ryder Cup Maniac</h1></header>
<div className="sec">
<div style={{background:'#fff',borderRadius:12,padding:16,marginBottom:15,textAlign:'center'}}>
<div style={{display:'flex',justifyContent:'space-around',alignItems:'center'}}>
<div><div style={{fontSize:32,fontWeight:700,color:eqA.color||'#1565c0'}}>{ptsA}</div><div style={{fontSize:12}}>{eqA.nombre}</div></div>
<div style={{fontSize:14,color:'#888'}}>vs</div>
<div><div style={{fontSize:32,fontWeight:700,color:eqB.color||'#c62828'}}>{ptsB}</div><div style={{fontSize:12}}>{eqB.nombre}</div></div>
</div>
{empates>0&&<div style={{fontSize:11,color:'#888',marginTop:8}}>Empates: {empates}</div>}
</div>
<div className="section-title">üë• Inscritos ({ins.length}/12)</div>
{ins.length<12?(<>
<p style={{fontSize:12,color:'#888',marginBottom:10}}>Necesitas 12 jugadores para formar equipos</p>
{jugadores.filter(j=>!ins.find(i=>i.id===j.id)).slice(0,6).map(j=>(
<div key={j.id} className="checkbox-item" onClick={()=>addIns(ryder.id,j)}>
<div className="checkbox">+</div>
<div style={{flex:1}}><div style={{fontWeight:700}}>{j.nombre}</div><div style={{fontSize:11,color:'#888'}}>Hcp {j.hcp}</div></div>
</div>
))}
</>):(<>
{eqA.jug.length===0?(<button className="btn btn-pri" style={{marginBottom:15}} onClick={()=>generarEquiposRyder(ryder.id)}>‚ú® Generar Equipos Equilibrados</button>):(<>
<div style={{background:eqA.color||'#1565c0',color:'#fff',borderRadius:10,padding:12,marginBottom:10}}>
<div style={{fontWeight:700,marginBottom:8}}>{eqA.nombre} ({eqA.jug.length})</div>
{eqA.parejas.map((p,i)=>(<div key={i} style={{background:'rgba(255,255,255,0.2)',borderRadius:6,padding:8,marginBottom:6,fontSize:13}}>Pareja {i+1}: {p.jug.map(j=>j.nombre).join(' & ')}</div>))}
</div>
<div style={{background:eqB.color||'#c62828',color:'#fff',borderRadius:10,padding:12,marginBottom:10}}>
<div style={{fontWeight:700,marginBottom:8}}>{eqB.nombre} ({eqB.jug.length})</div>
{eqB.parejas.map((p,i)=>(<div key={i} style={{background:'rgba(255,255,255,0.2)',borderRadius:6,padding:8,marginBottom:6,fontSize:13}}>Pareja {i+1}: {p.jug.map(j=>j.nombre).join(' & ')}</div>))}
</div>
<div className="section-title" style={{marginTop:20}}>‚õ≥ Partidos Matchplay</div>
{partidos.map((m,i)=>(<div key={m.id} style={{background:'#fff',borderRadius:10,padding:12,marginBottom:8}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<div style={{flex:1,textAlign:'center'}}><div style={{fontWeight:700,color:eqA.color}}>{m.parejaA.jug.map(j=>j.nombre).join(' & ')}</div></div>
<div style={{padding:'0 10px'}}>
<select className="form-select" style={{width:80,padding:6,fontSize:12,textAlign:'center'}} value={m.resultado||''} onChange={e=>setResultadoPartido(ryder.id,m.id,e.target.value)}>
<option value="">-</option>
<option value="A">Gana A</option>
<option value="B">Gana B</option>
<option value="E">Empate</option>
</select>
</div>
<div style={{flex:1,textAlign:'center'}}><div style={{fontWeight:700,color:eqB.color}}>{m.parejaB.jug.map(j=>j.nombre).join(' & ')}</div></div>
</div>
</div>))}
<button className="btn btn-sec" style={{marginTop:15}} onClick={()=>generarEquiposRyder(ryder.id)}>üîÑ Regenerar Equipos</button>
</>)}
</>)}
</div>
</div>
);};

const AdminCamposScr=()=>{
const[filtroZona,setFiltroZona]=useState('todas');
const prsPendientes=cal.filter(p=>!p.done);
const camposAndalucia=CAMPOS.filter(c=>c.zona==='Andaluc√≠a');
const camposMallorca=CAMPOS.filter(c=>c.zona==='Mallorca');
const camposOtros=CAMPOS.filter(c=>!c.zona);
const camposFiltrados=filtroZona==='todas'?CAMPOS:filtroZona==='andalucia'?camposAndalucia:filtroZona==='mallorca'?camposMallorca:camposOtros;
const asignarCampo=(pruebaId,campoId)=>{
const campoNombre=CAMPOS.find(c=>c.id===campoId)?.nombre||campoId;
setCal(prev=>{
const newCal=prev.map(p=>p.id===pruebaId?{...p,campoId}:p);
if(isAdmin){autoGuardar({viajeGastos,viajeViajeros,viajeRemanentes,cal:newCal,scores,jugadores});}
return newCal;
});
};
return(
<div className="scroll">
<header className="hdr" style={{background:'linear-gradient(135deg,#4caf50,#2e7d32)'}}><button className="hdr-back" onClick={()=>salirConVerificacion('admin',()=>setAdmScr(null))}>‚Üê</button><h1>‚õ≥ Asignar Campos</h1></header>
<div className="sec">
<p style={{fontSize:12,color:'#666',marginBottom:15}}>Selecciona el campo para cada prueba. Los cambios se guardan con el bot√≥n GUARDAR.</p>
{prsPendientes.map(p=>{
const campoActual=CAMPOS.find(c=>c.id===p.campoId);
const iconoTipo=p.esRyder?'üèÜ':p.esFinal?'ü•á':p.esDoble?'üìç':'‚õ≥';
return(
<div key={p.id} style={{background:'#fff',borderRadius:12,padding:14,marginBottom:12}}>
<div style={{display:'flex',alignItems:'center',gap:10,marginBottom:12}}>
<span style={{fontSize:20}}>{iconoTipo}</span>
<div style={{flex:1}}>
<div style={{fontWeight:700,fontSize:14}}>{p.nombre}</div>
<div style={{fontSize:11,color:'#888'}}>{new Date(p.fecha).toLocaleDateString('es-ES',{day:'numeric',month:'short',year:'numeric'})}</div>
</div>
</div>
<div style={{marginBottom:8}}>
<label style={{fontSize:11,color:'#666',marginBottom:4,display:'block'}}>Campo asignado:</label>
<select value={p.campoId||'pendiente'} onChange={e=>asignarCampo(p.id,e.target.value)} style={{width:'100%',padding:12,border:'2px solid #4caf50',borderRadius:8,fontSize:14,background:'#fff'}}>
<optgroup label="üìç Campos Actuales">
{camposOtros.map(c=><option key={c.id} value={c.id}>{c.nombre} (Par {c.par})</option>)}
</optgroup>
<optgroup label="üá™üá∏ Andaluc√≠a">
{camposAndalucia.map(c=><option key={c.id} value={c.id}>{c.nombre} (Par {c.par})</option>)}
</optgroup>
<optgroup label="üèùÔ∏è Mallorca">
{camposMallorca.map(c=><option key={c.id} value={c.id}>{c.nombre} (Par {c.par})</option>)}
</optgroup>
</select>
</div>
{campoActual&&campoActual.id!=='pendiente'&&(
<div style={{background:'#e8f5e9',borderRadius:8,padding:10,fontSize:12}}>
<strong>{campoActual.nombre}</strong> ‚Ä¢ Par {campoActual.par} ‚Ä¢ 18 hoyos
{campoActual.zona&&<span style={{marginLeft:8,background:'#4caf50',color:'#fff',padding:'2px 6px',borderRadius:4,fontSize:10}}>{campoActual.zona}</span>}
</div>
)}
</div>
);})}
{cambiosPendientes&&(
<button onClick={guardarTodo} style={{width:'100%',marginTop:15,background:'linear-gradient(135deg,#4caf50,#2e7d32)',border:'none',padding:16,borderRadius:10,color:'#fff',cursor:'pointer',fontSize:16,fontWeight:700}}>
üíæ GUARDAR CAMBIOS
</button>
)}
{!cambiosPendientes&&(
<div style={{width:'100%',marginTop:15,background:'#e8f5e9',padding:14,borderRadius:10,color:'#2e7d32',textAlign:'center',fontSize:14}}>
‚úì Todos los cambios guardados
</div>
)}
</div>
</div>
);};

const AdminEditScoresScr=()=>{
const[selPrEdit,setSelPrEdit]=useState(null);
const[editHole,setEditHole]=useState(1);
const prsConGrupos=cal.filter(p=>(p.grp||[]).length>0);
const campo=selPrEdit?.campoId?CAMPOS.find(c=>c.id===selPrEdit.campoId):null;
const hoyo=campo?.hoyos.find(h=>h.n===editHole);
if(!selPrEdit)return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>salirConVerificacion('admin',()=>setAdmScr(null))}>‚Üê</button><h1>Editar Puntuaciones</h1></header>
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:15}}>Selecciona una prueba con partidas para editar puntuaciones</p>
{prsConGrupos.length===0?<div className="empty-state"><div className="empty-icon">üìù</div><p>No hay pruebas con partidas creadas</p></div>:
prsConGrupos.map(p=>(
<div key={p.id} className="card" onClick={()=>setSelPrEdit(p)}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
<div><div style={{fontWeight:700}}>{p.nombre}</div><div style={{fontSize:11,color:'#888'}}>{(p.grp||[]).length} grupos ‚Ä¢ {(p.ins||[]).length} jugadores</div></div>
<span>‚Üí</span>
</div>
</div>
))}
</div>
</div>
);
const allJugadores=(selPrEdit.grp||[]).flatMap(g=>g.jug);
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>salirConVerificacion('editscores',()=>setSelPrEdit(null))}>‚Üê</button><div><h1>{selPrEdit.nombre}</h1><p>Editar Puntuaciones</p></div></header>
{campo&&(
<div className="hole-hdr">
<button className="hole-nav-btn" disabled={editHole<=1} onClick={()=>setEditHole(h=>h-1)}>‚óÄ</button>
<div className="hole-center"><div className="hole-num">HOYO</div><div className="hole-big">{editHole}</div><div className="hole-details">Par {hoyo?.p} ‚Ä¢ Idx {hoyo?.i}</div></div>
<button className="hole-nav-btn" disabled={editHole>=18} onClick={()=>setEditHole(h=>h+1)}>‚ñ∂</button>
</div>
)}
<div className="sec">
<p style={{fontSize:11,color:'#888',marginBottom:15}}>Modifica los golpes de cada jugador. Los cambios se guardan autom√°ticamente.</p>
{allJugadores.map(j=>{
const key=`${j.id}-${editHole}`;
const golpes=scores[key]||0;
const hcp=hcpJ(j.hcp,j.esR);
const extra=hoyo?gE(hcp,hoyo.i):0;
const pts=hoyo?stb(golpes,hoyo.p,extra):0;
return(
<div key={j.id} style={{background:'#fff',borderRadius:10,padding:14,marginBottom:10}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
<div><span style={{fontWeight:700}}>{j.nombre}</span><span style={{fontSize:11,color:'#888',marginLeft:8}}>Hcp {j.hcp}{extra>0?` (+${extra})`:''}</span></div>
<div style={{fontSize:12,color:'var(--pri)',fontWeight:700}}>{pts} pts</div>
</div>
<div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:15}}>
<button onClick={()=>setScore(j.id,editHole,golpes-1)} disabled={golpes<=0} style={{width:44,height:44,borderRadius:'50%',border:'none',background:'#ffebee',color:'#c62828',fontSize:20,fontWeight:700,cursor:'pointer'}}>‚àí</button>
<div style={{width:60,height:50,background:'#f5f5f5',borderRadius:8,display:'flex',alignItems:'center',justifyContent:'center',fontSize:24,fontWeight:700,color:'var(--pri)'}}>{golpes||'-'}</div>
<button onClick={()=>setScore(j.id,editHole,golpes+1)} style={{width:44,height:44,borderRadius:'50%',border:'none',background:'#e8f5e9',color:'#2e7d32',fontSize:20,fontWeight:700,cursor:'pointer'}}>+</button>
</div>
</div>
);})}
<div style={{display:'flex',gap:10,marginTop:20}}>
{editHole>1&&<button className="btn btn-sec" style={{flex:1}} onClick={()=>setEditHole(h=>h-1)}>‚Üê Hoyo {editHole-1}</button>}
{editHole<18&&<button className="btn btn-pri" style={{flex:1}} onClick={()=>setEditHole(h=>h+1)}>Hoyo {editHole+1} ‚Üí</button>}
</div>
<div style={{marginTop:20,padding:15,background:cambiosPendientes?'#fff3e0':'#e8f5e9',borderRadius:12}}>
{cambiosPendientes?(
<button onClick={guardarTodo} style={{width:'100%',background:'linear-gradient(135deg,#4caf50,#2e7d32)',border:'none',padding:14,borderRadius:10,color:'#fff',cursor:'pointer',fontSize:15,fontWeight:700}}>
üíæ GUARDAR CAMBIOS
</button>
):(
<div style={{textAlign:'center',color:'#2e7d32',fontWeight:600}}>‚úì Cambios guardados</div>
)}
</div>
</div>
</div>
);};

const ConfLIVScr=()=>{
const pr=selPrueba?getPrueba(selPrueba.id):null;
if(!pr)return null;
const eqs=pr.eqLIV||[];const ins=pr.ins||[];
const asig=eqs.flatMap(e=>e.jug.map(j=>j.id));const sinA=ins.filter(j=>!asig.includes(j.id));
return(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>{setSelPrueba(null);setAdmScr('liv');}}>‚Üê</button><div><h1>{pr.nombre}</h1><p>Equipos LIV</p></div></header>
<div className="sec">
<button className="btn btn-danger" style={{marginBottom:15}} onClick={()=>addEL(pr.id)}>+ Nuevo Equipo LIV</button>
{eqs.map((eq,idx)=>(
<div key={eq.id} className="liv-pair">
<div className="liv-pair-num">{idx+1}</div>
<div className="liv-pair-players">
{eq.jug.map(j=><div key={j.id} className="liv-player">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)}) <span style={{cursor:'pointer'}} onClick={()=>remJL(pr.id,eq.id,j.id)}>√ó</span></div>)}
{eq.jug.length<2&&sinA.length>0&&<select className="form-select" style={{width:'auto',padding:'6px 10px',fontSize:12,background:'#ffebee'}} onChange={e=>{const jug=ins.find(j=>j.id===e.target.value);if(jug)addJL(pr.id,eq.id,jug);e.target.value='';}}><option value="">+ A√±adir</option>{sinA.map(j=><option key={j.id} value={j.id}>{j.nombre}</option>)}</select>}
</div>
<span style={{color:'#c62828',cursor:'pointer'}} onClick={()=>remEL(pr.id,eq.id)}>üóë</span>
</div>
))}
{sinA.length>0&&<><div className="section-title" style={{marginTop:20}}>Sin equipo ({sinA.length})</div>{sinA.map(j=><div key={j.id} className="inscrito-row"><div className="inscrito-avatar">{j.nombre.charAt(0)}</div><span className="inscrito-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</span></div>)}</>}
</div>
</div>
);};

const AdminJugadoresScr=()=>(
<div className="scroll">
<header className="hdr"><button className="hdr-back" onClick={()=>setAdmScr(null)}>‚Üê</button><h1>Editar Jugadores</h1></header>
<div className="sec">
<p style={{fontSize:12,color:'#888',marginBottom:15}}>Toca un jugador para editar su nombre o handicap</p>
{jugadores.map(j=>(
<div key={j.id} className="card" onClick={()=>openEditJug(j)}>
<div style={{display:'flex',alignItems:'center'}}>
<div style={{width:40,height:40,borderRadius:'50%',background:'linear-gradient(135deg,var(--pri),var(--pri-l))',color:'#fff',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,marginRight:12}}>{j.nombre.charAt(0)}</div>
<div style={{flex:1}}><div style={{fontWeight:700}}>{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</div></div>
<span style={{color:'var(--pri)',fontSize:18}}>‚úèÔ∏è</span>
</div>
</div>
))}
</div>
</div>
);

const EditJugadorModal=()=>{
if(!editJug)return null;
return(
<div className="modal-overlay" onClick={()=>{setShowEditModal(false);setEditJug(null);}}>
<div className="modal" onClick={e=>e.stopPropagation()}>
<div className="modal-hdr"><span className="modal-title">‚úèÔ∏è Editar Jugador</span><button className="modal-close" onClick={()=>{setShowEditModal(false);setEditJug(null);}}>√ó</button></div>
<div className="modal-body">
<div className="form-group"><label className="form-label">Nombre</label><input type="text" className="form-input" value={editJug.nombre} onChange={e=>setEditJug({...editJug,nombre:e.target.value})} placeholder="Nombre del jugador"/></div>
<div className="form-group"><label className="form-label">Handicap</label><input type="number" step="0.1" className="form-input" value={editJug.hcp} onChange={e=>setEditJug({...editJug,hcp:parseFloat(e.target.value)||0})} placeholder="Ej: 12.5"/></div>
<div className="toggle-row"><span>Handicap Rojo (bajo cero)</span><div className={`toggle ${editJug.esR?'on':''}`} onClick={()=>setEditJug({...editJug,esR:!editJug.esR})}></div></div>
</div>
<div className="modal-footer"><button className="btn btn-sec" onClick={()=>{setShowEditModal(false);setEditJug(null);}}>Cancelar</button><button className="btn btn-pri" onClick={saveEditJug}>Guardar</button></div>
</div>
</div>
);};

// Funci√≥n para guardar y avanzar al siguiente hoyo
const confirmarHoyo=()=>{
guardarTodo();
if(hole<18){
setTimeout(()=>setHole(h=>h+1),500);
}
};

// Funci√≥n para finalizar partida - muestra pantalla de resultados
const finalizarPartida=()=>{
guardarTodo();
// Inicializar asistencia a comida (todos marcados por defecto)
const jugadores_p=partidaActiva?.jug||[];
const asistenciaInicial={};
jugadores_p.forEach(j=>{asistenciaInicial[j.id]=true;});
setAsistenciaComida(asistenciaInicial);
setModoResultados(true);
};

// Funci√≥n para confirmar resultados con comida y pasar a edici√≥n
const confirmarResultados=()=>{
guardarTodo();
setModoResultados(false);
setModoEdicion(true);
};

// Funci√≥n para salir del scoring
const salirScoring=()=>{
setLiveOn(false);
setPartidaActiva(null);
setPruebaActiva(null);
setModoEdicion(false);
setModoResultados(false);
setAsistenciaComida({});
setHole(1);
setScr('home');
};

const ScoringScr=()=>{
if(!campoAct||!hoyoAct||!partidaActiva)return null;

// Verificar si todos los jugadores tienen score en el hoyo actual
const jugadores_partida=partidaActiva.jug||[];
const todosConScore=jugadores_partida.every(j=>{const g=scores[`${j.id}-${hole}`]||0;return g>0;});

// Verificar si es el √∫ltimo hoyo
const esUltimoHoyo=hole===18;

// Funci√≥n local para cambiar score
const cambiarScore=(jid,h,g)=>{
const newG=Math.max(0,g);
setScores(prev=>({...prev,[`${jid}-${h}`]:newG}));
};

// Valor especial para "levantar bola" (pick up ball) = 0 pts stableford
const PICK_UP=99;

// Activar score: si no tiene score, poner par como base; si ya tiene, sumar delta
const ajustarScore=(jid,h,delta,par)=>{
const actual=scores[`${jid}-${h}`]||0;
if(actual===PICK_UP){
// Si ten√≠a levantar bola, volver a par y aplicar delta
cambiarScore(jid,h,Math.max(1,par+delta));
}else if(actual===0){
// Primera pulsaci√≥n: partir de par
cambiarScore(jid,h,Math.max(1,par+delta));
}else{
cambiarScore(jid,h,Math.max(1,actual+delta));
}
};

// Levantar bola
const levantarBola=(jid,h)=>{
setScores(prev=>({...prev,[`${jid}-${h}`]:PICK_UP}));
};

// Quitar levantar bola (volver a sin score)
const quitarLevantarBola=(jid,h)=>{
setScores(prev=>({...prev,[`${jid}-${h}`]:0}));
};

// Label relativo al par
const labelVsPar=(golpes,par)=>{
if(!golpes||golpes===PICK_UP)return'-';
const diff=golpes-par;
if(diff===0)return'PAR';
if(diff===-3)return'-3 (Albatros)';
if(diff===-2)return'-2 (Eagle)';
if(diff===-1)return'-1 (Birdie)';
if(diff===1)return'+1 (Bogey)';
if(diff===2)return'+2 (Dbl Bogey)';
if(diff>=3)return'+'+diff;
return diff.toString();
};

// Color seg√∫n resultado vs par
const colorVsPar=(golpes,par)=>{
if(!golpes||golpes===PICK_UP)return'#999';
const diff=golpes-par;
if(diff<=-2)return'#f9a825';
if(diff===-1)return'#4caf50';
if(diff===0)return'#333';
if(diff===1)return'#ff9800';
return'#c62828';
};

// MODO RESULTADOS - Pantalla final con asistencia a comida
if(modoResultados){
// Ordenar por puntos stableford
const ranking=[...lb].sort((a,b)=>b.totalPts-a.totalPts);
return(
<div className="scroll" style={{paddingBottom:20}}>
<div style={{background:'linear-gradient(135deg,#4caf50,#2e7d32)',padding:20,color:'#fff',textAlign:'center'}}>
<span style={{fontSize:40}}>üèÜ</span>
<h2 style={{fontFamily:'Georgia,serif',fontSize:22,margin:'10px 0 5px'}}>¬°Partida Finalizada!</h2>
<p style={{fontSize:13,opacity:.9}}>Marca qui√©n asiste a la comida</p>
</div>
<div className="sec">
<div style={{background:'#fff',borderRadius:12,overflow:'hidden',marginBottom:15}}>
<div style={{background:'var(--pri)',color:'#fff',padding:12,fontWeight:700,fontSize:14,display:'flex',justifyContent:'space-between'}}>
<span>Jugador</span>
<div style={{display:'flex',gap:20}}>
<span style={{width:50,textAlign:'center'}}>Stb</span>
<span style={{width:60,textAlign:'center'}}>Pts</span>
<span style={{width:50,textAlign:'center'}}>üçΩÔ∏è</span>
</div>
</div>
{ranking.map((j,i)=>{
const pos=i+1;
const ptosPosicion=getPuntosPosicion(pos);
const asiste=asistenciaComida[j.id]||false;
const ptosComida=asiste?1:0;
const ptosTotal=ptosPosicion+ptosComida;
const ptosStr=asiste?`${ptosPosicion}+1`:`${ptosPosicion}`;
return(
<div key={j.id} style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'12px 14px',borderBottom:'1px solid #eee',background:i<3?['#fff9e6','#f5f5f5','#fff5ee'][i]:'#fff'}}>
<div style={{display:'flex',alignItems:'center',gap:10}}>
<span style={{width:24,height:24,borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:12,background:i===0?'var(--gold)':i===1?'var(--silver)':i===2?'var(--bronze)':'#e0e0e0',color:i<3?'#fff':'#666'}}>{pos}</span>
<span style={{fontWeight:600}}>{j.nombre}</span>
</div>
<div style={{display:'flex',alignItems:'center',gap:20}}>
<span style={{width:50,textAlign:'center',fontWeight:700,color:'var(--pri)'}}>{j.totalPts}</span>
<span style={{width:60,textAlign:'center',fontWeight:700,color:'#333'}}>{ptosStr}</span>
<div style={{width:50,display:'flex',justifyContent:'center'}}>
<div onClick={()=>setAsistenciaComida(prev=>({...prev,[j.id]:!prev[j.id]}))} style={{width:28,height:28,borderRadius:6,border:'2px solid '+(asiste?'#4caf50':'#ccc'),background:asiste?'#4caf50':'#fff',display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer',color:'#fff',fontSize:16}}>{asiste?'‚úì':''}</div>
</div>
</div>
</div>
);})}
</div>
<div style={{background:'#e8f5e9',borderRadius:10,padding:14,marginBottom:15}}>
<p style={{fontSize:13,color:'#2e7d32',margin:0}}><b>üìã Resumen de puntos:</b></p>
<p style={{fontSize:12,color:'#666',margin:'8px 0 0'}}>‚Ä¢ Puntos por posici√≥n: 1¬∫=15, 2¬∫=12, 3¬∫=10, 4¬∫=9... hasta 12¬∫=1</p>
<p style={{fontSize:12,color:'#666',margin:'4px 0 0'}}>‚Ä¢ Asistencia a comida: +1 punto adicional</p>
</div>
<button className="btn btn-pri" style={{marginBottom:10}} onClick={()=>mostrarConfirm('¬øConfirmar resultados y asistencia a comida?',confirmarResultados)}>‚úÖ CONFIRMAR RESULTADOS</button>
<button className="btn btn-sec" onClick={()=>setModoResultados(false)}>‚Üê Volver a revisar scores</button>
</div>
</div>
);
}

// MODO EDICI√ìN POST-PARTIDA
if(modoEdicion){
const hoyoEdit=campoAct.hoyos.find(h=>h.n===hoyoEdicion);
return(
<div className="scroll" style={{paddingBottom:20}}>
<div style={{background:'linear-gradient(135deg,#ff9800,#f57c00)',padding:16,color:'#fff'}}>
<div style={{display:'flex',alignItems:'center',gap:10}}>
<span style={{fontSize:28}}>‚úèÔ∏è</span>
<div>
<h2 style={{fontFamily:'Georgia,serif',fontSize:18,margin:0}}>Modo Edici√≥n</h2>
<p style={{fontSize:12,opacity:.9,margin:0}}>Corrige cualquier error en los scores</p>
</div>
</div>
</div>
<div className="sec">
<div style={{marginBottom:15}}>
<label style={{fontSize:12,fontWeight:600,marginBottom:6,display:'block'}}>Selecciona el hoyo a editar:</label>
<select value={hoyoEdicion} onChange={e=>setHoyoEdicion(parseInt(e.target.value))} style={{width:'100%',padding:12,border:'2px solid #ff9800',borderRadius:8,fontSize:16,fontWeight:700}}>
{campoAct.hoyos.map(h=><option key={h.n} value={h.n}>Hoyo {h.n} (Par {h.p})</option>)}
</select>
</div>
{hoyoEdit&&<p style={{fontSize:12,color:'#666',marginBottom:10}}>Par {hoyoEdit.p} ‚Ä¢ Index {hoyoEdit.i}</p>}
{jugadores_partida.map(j=>{
const golpes=scores[`${j.id}-${hoyoEdicion}`]||0;
const hcp=hcpJ(j.hcp,j.esR);
const extra=hoyoEdit?gE(hcp,hoyoEdit.i):0;
const esPickUp=golpes===PICK_UP;
const pts=hoyoEdit?(esPickUp?0:stb(golpes,hoyoEdit.p,extra)):0;
const parHoyo=hoyoEdit?hoyoEdit.p:4;
return(
<div key={j.id} style={{background:esPickUp?'#f5f5f5':'#fff',borderRadius:10,padding:14,marginBottom:10,border:esPickUp?'2px solid #9e9e9e':'2px solid transparent'}}>
<div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}}>
<div><span style={{fontWeight:700}}>{j.nombre}</span>{extra!==0&&<span style={{fontSize:11,color:'var(--pri)',marginLeft:6}}>{extra>0?'+':''}{extra}</span>}</div>
<div style={{fontSize:12,color:esPickUp?'#9e9e9e':'var(--pri)',fontWeight:700}}>{esPickUp?'üè≥Ô∏è 0':pts} pts</div>
</div>
{esPickUp?(
<div style={{textAlign:'center',padding:'8px 0'}}>
<div style={{fontSize:14,fontWeight:700,color:'#9e9e9e'}}>üè≥Ô∏è BOLA LEVANTADA</div>
<button onClick={()=>quitarLevantarBola(j.id,hoyoEdicion)} style={{marginTop:8,padding:'5px 14px',borderRadius:8,border:'1px solid #ccc',background:'#fff',color:'#666',fontSize:12,cursor:'pointer'}}>‚Ü© Deshacer</button>
</div>
):(
<div>
<div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:15}}>
<button onClick={()=>ajustarScore(j.id,hoyoEdicion,-1,parHoyo)} disabled={golpes>0&&golpes<=1} style={{width:44,height:44,borderRadius:'50%',border:'none',background:'#ffebee',color:'#c62828',fontSize:20,fontWeight:700,cursor:'pointer'}}>‚àí</button>
<div style={{textAlign:'center',minWidth:80}}>
<div style={{fontSize:24,fontWeight:700,color:colorVsPar(golpes,parHoyo)}}>{golpes?golpes:parHoyo}</div>
<div style={{fontSize:10,fontWeight:700,color:colorVsPar(golpes,parHoyo)}}>{golpes?labelVsPar(golpes,parHoyo):'Par'}</div>
</div>
<button onClick={()=>ajustarScore(j.id,hoyoEdicion,1,parHoyo)} style={{width:44,height:44,borderRadius:'50%',border:'none',background:'#e8f5e9',color:'#2e7d32',fontSize:20,fontWeight:700,cursor:'pointer'}}>+</button>
</div>
<div style={{display:'flex',justifyContent:'center',gap:8,marginTop:6}}>
{!golpes&&<button onClick={()=>cambiarScore(j.id,hoyoEdicion,parHoyo)} style={{padding:'4px 12px',borderRadius:8,border:'2px solid #4caf50',background:'#e8f5e9',color:'#2e7d32',fontSize:11,fontWeight:700,cursor:'pointer'}}>‚úì Par</button>}
<button onClick={()=>levantarBola(j.id,hoyoEdicion)} style={{padding:'4px 12px',borderRadius:8,border:'1px solid #e0e0e0',background:'#fafafa',color:'#999',fontSize:11,cursor:'pointer'}}>üè≥Ô∏è Levantar bola</button>
</div>
</div>
)}
</div>
);})}
<button className="btn btn-pri" style={{marginTop:15}} onClick={()=>mostrarConfirm('¬øGuardar correcciones?',guardarTodo)}>üíæ GUARDAR CORRECCIONES</button>
<button className="btn btn-sec" style={{marginTop:10}} onClick={salirScoring}>‚úÖ TERMINAR Y SALIR</button>
</div>
<div className="sec">
<div className="lb"><div className="lb-hdr"><span className="lb-title">üèÜ RESULTADO FINAL GLOBAL</span></div>
{lbGlobal.map((j,i)=><div key={j.id} className="lb-row"><span className={`lb-pos ${i<3?'p'+(i+1):''}`}>{i+1}</span><span className="lb-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</span><span className="lb-thru">{j.hoyosJugados} hoyos</span><span className="lb-score">{j.totalPts}</span></div>)}
</div>
</div>
</div>
);
}

// MODO SCORING NORMAL
return(
<div className="scroll" style={{paddingBottom:20}}>
<div className="hole-hdr">
<button className="hole-nav-btn" disabled={hole<=1} onClick={()=>setHole(h=>h-1)}>‚Üê</button>
<div className="hole-center"><div className="hole-num">HOYO</div><div className="hole-big">{hole}</div><div className="hole-details">Par {hoyoAct.p} ‚Ä¢ Index {hoyoAct.i}</div></div>
<button className="hole-nav-btn" disabled={hole>=18} onClick={()=>setHole(h=>h+1)}>‚Üí</button>
</div>
<div className="sec">
<p style={{fontSize:11,color:'#666',marginBottom:12,textAlign:'center'}}>Pulsa +/‚àí para ajustar desde par. Usa üè≥Ô∏è si el jugador levanta bola.</p>
{jugadores_partida.map(j=>{
const hcp=hcpJ(j.hcp,j.esR);const extra=gE(hcp,hoyoAct.i);const golpes=scores[`${j.id}-${hole}`]||0;
const esPickUp=golpes===PICK_UP;
const pts=esPickUp?0:stb(golpes,hoyoAct.p,extra);
let tot=0;for(let h=1;h<=18;h++){const g=scores[`${j.id}-${h}`];if(g>0){const ho=campoAct.hoyos.find(x=>x.n===h);if(ho)tot+=stb(g,ho.p,gE(hcp,ho.i));}}
const tieneScore=golpes>0;
const parHoyo=hoyoAct.p;
return(
<div key={j.id} className="player-score" style={{border:esPickUp?'2px solid #9e9e9e':tieneScore?'2px solid #4caf50':'2px solid #ffcc80',background:esPickUp?'#f5f5f5':tieneScore?'#e8f5e9':'#fff'}}>
<div className="player-row">
<div><span className="player-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)})</span>{extra!==0&&<span className="player-extra">{extra>0?'+':''}{extra} golpe{Math.abs(extra)>1?'s':''}</span>}{tieneScore&&!esPickUp&&<span style={{marginLeft:8,color:'#4caf50'}}>‚úì</span>}{esPickUp&&<span style={{marginLeft:8,color:'#9e9e9e'}}>üè≥Ô∏è</span>}</div>
<span className="player-total">{tot}</span>
</div>
{esPickUp?(
<div style={{textAlign:'center',padding:'12px 0'}}>
<div style={{fontSize:16,fontWeight:700,color:'#9e9e9e',marginBottom:4}}>üè≥Ô∏è BOLA LEVANTADA</div>
<div style={{fontSize:12,color:'#999'}}>0 pts stableford</div>
<button onClick={()=>quitarLevantarBola(j.id,hole)} style={{marginTop:8,padding:'6px 16px',borderRadius:8,border:'1px solid #ccc',background:'#fff',color:'#666',fontSize:12,cursor:'pointer'}}>‚Ü© Deshacer</button>
</div>
):(
<div>
<div className="stroke-row">
<button className="stroke-btn minus" onClick={()=>ajustarScore(j.id,hole,-1,parHoyo)} disabled={golpes>0&&golpes<=1}>‚àí</button>
<div style={{textAlign:'center',minWidth:90}}>
<div className="stroke-val" style={{color:colorVsPar(golpes,parHoyo),fontSize:golpes?20:16}}>{golpes?golpes:parHoyo}</div>
<div style={{fontSize:11,fontWeight:700,color:colorVsPar(golpes,parHoyo),marginTop:2}}>{golpes?labelVsPar(golpes,parHoyo):'Par (sin confirmar)'}</div>
<div className="stroke-pts">{golpes>0?<><b>{pts}</b> pts stb</>:<span style={{color:'#bbb'}}>‚Äî</span>}</div>
</div>
<button className="stroke-btn plus" onClick={()=>ajustarScore(j.id,hole,1,parHoyo)}>+</button>
</div>
<div style={{display:'flex',justifyContent:'center',gap:8,marginTop:6,marginBottom:4}}>
{!golpes&&<button onClick={()=>cambiarScore(j.id,hole,parHoyo)} style={{padding:'5px 14px',borderRadius:8,border:'2px solid #4caf50',background:'#e8f5e9',color:'#2e7d32',fontSize:12,fontWeight:700,cursor:'pointer'}}>‚úì Par</button>}
<button onClick={()=>levantarBola(j.id,hole)} style={{padding:'5px 14px',borderRadius:8,border:'1px solid #e0e0e0',background:'#fafafa',color:'#999',fontSize:11,cursor:'pointer'}}>üè≥Ô∏è Levantar bola</button>
</div>
</div>
)}
</div>
);})}

{/* Bot√≥n de confirmar hoyo - solo aparece cuando todos tienen score */}
{todosConScore?(
<div style={{marginTop:16}}>
{esUltimoHoyo?(
<button className="btn btn-danger" style={{display:'flex',alignItems:'center',justifyContent:'center',gap:8,animation:'pulse 1.5s infinite'}} onClick={()=>mostrarConfirm('¬øConfirmar scores del HOYO 18 y FINALIZAR la partida?',finalizarPartida)}>
<span style={{fontSize:20}}>üèÅ</span> CONFIRMAR HOYO 18 Y FINALIZAR
</button>
):(
<button className="btn btn-pri" style={{display:'flex',alignItems:'center',justifyContent:'center',gap:8,background:'linear-gradient(135deg,#4caf50,#2e7d32)'}} onClick={()=>mostrarConfirm(`¬øConfirmar scores del HOYO ${hole}? Tras confirmar se guardar√° y pasar√° al hoyo ${hole+1}.`,confirmarHoyo)}>
<span style={{fontSize:18}}>‚úÖ</span> CONFIRMAR HOYO {hole} ‚Üí Siguiente
</button>
)}
</div>
):(
<div style={{marginTop:16,padding:14,background:'#fff3e0',borderRadius:10,textAlign:'center'}}>
<span style={{fontSize:24}}>‚è≥</span>
<p style={{fontSize:13,color:'#e65100',margin:'8px 0 0',fontWeight:600}}>Falta el score de {jugadores_partida.filter(j=>!(scores[`${j.id}-${hole}`]>0)).map(j=>j.nombre).join(', ')}</p>
</div>
)}

<div style={{marginTop:16}}>
<div className="lb"><div className="lb-hdr"><span className="lb-title"><span className="live-dot"></span> LEADERBOARD GLOBAL</span><span style={{fontSize:10,opacity:.7}}>{lbGlobal.length} jugadores</span></div>
{lbGlobal.length>0?lbGlobal.map((j,i)=>{
const esDeEstaPartida=partidaActiva?.jug?.find(x=>x.id===j.id);
return(<div key={j.id} className="lb-row" style={{background:esDeEstaPartida?'rgba(198,40,40,0.1)':'transparent'}}><span className={`lb-pos ${i<3?'p'+(i+1):''}`}>{i+1}</span><span className="lb-name">{j.nombre} {j.hcp} ({j.esR?Math.floor(j.hcp):Math.ceil(j.hcp)}){esDeEstaPartida&&<span style={{marginLeft:4,fontSize:10}}>‚óè</span>}</span><span className="lb-thru">Thru {j.hoyosJugados||'-'}</span><span className="lb-score">{j.totalPts}</span></div>);
}):<div className="lb-row" style={{justifyContent:'center',color:'#888'}}>Sin datos</div>}
</div>
</div>
<button className="btn btn-sec" style={{marginTop:12}} onClick={()=>mostrarConfirm('¬øSalir sin guardar? Los datos del hoyo actual se perder√°n si no confirmas.',salirScoring)}>‚Üê Salir</button>
</div>
</div>
);};

// MODALS

// Modal de confirmaci√≥n NO BLOQUEANTE (reemplaza confirm() nativo que congelaba toda la app)
const ConfirmModal=()=>{
if(!confirmModal)return null;
return(
<div className="modal-overlay" onClick={cerrarConfirm}>
<div className="modal" onClick={e=>e.stopPropagation()} style={{maxWidth:340}}>
<div className="modal-hdr"><span className="modal-title">‚ö†Ô∏è Confirmar</span><button className="modal-close" onClick={cerrarConfirm}>√ó</button></div>
<div className="modal-body"><p style={{fontSize:14,color:'#333',lineHeight:1.5,margin:0}}>{confirmModal.msg}</p></div>
<div className="modal-footer" style={{display:'flex',gap:10}}>
<button className="btn btn-sec" style={{flex:1}} onClick={cerrarConfirm}>Cancelar</button>
<button className="btn btn-pri" style={{flex:1}} onClick={()=>{cerrarConfirm();confirmModal.onOk();}}>Confirmar</button>
</div>
</div>
</div>
);};

const LoginModal=()=>{
const[pwd,setPwd]=useState('');const[err,setErr]=useState(false);
return(
<div className="modal-overlay" onClick={()=>setShowLogin(false)}>
<div className="modal" onClick={e=>e.stopPropagation()}>
<div className="modal-hdr"><span className="modal-title">üîê Admin General</span><button className="modal-close" onClick={()=>setShowLogin(false)}>√ó</button></div>
<div className="modal-body">
<div className="form-group"><label className="form-label">Contrase√±a</label><input type="password" className="form-input" value={pwd} onChange={e=>{setPwd(e.target.value);setErr(false);}} placeholder="Introduce contrase√±a"/>{err&&<p style={{color:'red',fontSize:11,marginTop:5}}>Contrase√±a incorrecta</p>}</div>
</div>
<div className="modal-footer"><button className="btn btn-pri" onClick={()=>pwd==='maniac2025'?login(pwd):setErr(true)}>Entrar</button></div>
</div>
</div>
);};

const PartidaLoginModal=()=>{
const[code,setCode]=useState('');const[err,setErr]=useState(false);
const tryAccess=()=>{
if(accessByCode(code.toUpperCase())){setShowPartidaLogin(false);setCode('');}
else setErr(true);
};
return(
<div className="modal-overlay" onClick={()=>setShowPartidaLogin(false)}>
<div className="modal" onClick={e=>e.stopPropagation()}>
<div className="modal-hdr"><span className="modal-title">üéØ Acceso Admin Partida</span><button className="modal-close" onClick={()=>setShowPartidaLogin(false)}>√ó</button></div>
<div className="modal-body">
<p style={{fontSize:13,color:'#666',marginBottom:15}}>Introduce el c√≥digo de 4 letras que te dio el organizador</p>
<div className="form-group"><label className="form-label">C√≥digo de Partida</label><input type="text" className="form-input" value={code} onChange={e=>{setCode(e.target.value.toUpperCase());setErr(false);}} placeholder="XXXX" maxLength={4} style={{textAlign:'center',fontSize:24,letterSpacing:8,fontFamily:'monospace'}}/>{err&&<p style={{color:'red',fontSize:11,marginTop:5}}>C√≥digo no v√°lido o partida sin jugadores</p>}</div>
</div>
<div className="modal-footer"><button className="btn btn-pri" onClick={tryAccess}>Acceder</button></div>
</div>
</div>
);};

// RENDER
const showNav=!['jugador-detalle','detalle','scoring'].includes(scr)&&!admScr;
return(
<div className="app">
{scr==='home'&&!admScr&&<HomeScr/>}
{scr==='calendario'&&!admScr&&<CalendarioScr/>}
{scr==='viaje'&&!admScr&&<ViajeScr/>}
{scr==='clasificacion'&&!admScr&&<ClasifScr/>}
{scr==='jugadores'&&!admScr&&<JugadoresScr/>}
{scr==='jugador-detalle'&&<JugadorDetalleScr/>}
{scr==='historico'&&!admScr&&<HistoricoScr/>}
{scr==='stats'&&!admScr&&<StatsScr/>}
{scr==='detalle'&&<DetalleScr/>}
{scr==='live'&&!admScr&&<LiveScr/>}
{scr==='admin'&&!admScr&&<AdminScr/>}
{scr==='scoring'&&<ScoringScr/>}
{admScr==='inscritos'&&!selPrueba&&<AdminInsScr/>}
{admScr==='conf-ins'&&selPrueba&&<ConfInsScr/>}
{admScr==='partidas'&&!selPrueba&&<AdminPartScr/>}
{admScr==='conf-part'&&selPrueba&&<ConfPartScr/>}
{admScr==='liv'&&!selPrueba&&<AdminLIVScr/>}
{admScr==='conf-liv'&&selPrueba&&<ConfLIVScr/>}
{admScr==='jugadores'&&<AdminJugadoresScr/>}
{admScr==='ryder'&&<AdminRyderScr/>}
{admScr==='editscores'&&<AdminEditScoresScr/>}
{admScr==='campos'&&<AdminCamposScr/>}
{showNav&&<nav className="nav">
<button className={`nav-btn ${scr==='home'?'active':''}`} onClick={()=>{setAdmScr(null);setSelPrueba(null);setScr('home');}}><span className="nav-icon">üè†</span><span className="nav-label">Inicio</span></button>
<button className={`nav-btn ${scr==='calendario'?'active':''}`} onClick={()=>{setAdmScr(null);setSelPrueba(null);setScr('calendario');}}><span className="nav-icon">üìÖ</span><span className="nav-label">Calendario</span></button>
<button className={`nav-btn ${scr==='clasificacion'?'active':''}`} onClick={()=>{setAdmScr(null);setSelPrueba(null);setScr('clasificacion');}}><span className="nav-icon">üèÜ</span><span className="nav-label">Ranking</span></button>
<button className={`nav-btn ${scr==='stats'?'active':''}`} onClick={()=>{setAdmScr(null);setSelPrueba(null);setScr('stats');}}><span className="nav-icon">üìà</span><span className="nav-label">Stats</span></button>
<button className={`nav-btn ${scr==='admin'||admScr?'active':''}`} onClick={()=>{setSelPrueba(null);isAdmin?setScr('admin'):setShowLogin(true);}}><span className="nav-icon">{isAdmin?'‚öôÔ∏è':'üîê'}</span><span className="nav-label">Admin</span></button>
</nav>}
{showLogin&&<LoginModal/>}
{showPartidaLogin&&<PartidaLoginModal/>}
{showEditModal&&<EditJugadorModal/>}
{showViajeLogin&&<ViajeLoginModal/>}
<ConfirmModal/>
{guardado&&<div className="toast success">Guardado</div>}
{guardandoFirebase&&!guardado&&<div className="toast" style={{background:'#ff9800'}}>Guardando...</div>}
</div>
);};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
